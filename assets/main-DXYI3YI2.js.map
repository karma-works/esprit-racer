{"version":3,"file":"main-DXYI3YI2.js","sources":["../../src/engine/constants.ts","../../src/engine/utils/math.ts","../../src/engine/segments.ts","../../src/engine/camera.ts","../../src/engine/world.ts","../../src/engine/renderer/canvas.ts","../../src/engine/renderer/sprite.ts","../../src/assets/svg-loader.ts","../../src/audio/mod-player.ts","../../src/game/modes/time-challenge.ts","../../src/game/modes/race.ts","../../src/engine/input.ts","../../src/engine/collision.ts","../../src/ui/screens/screens.ts","../../src/ui/hud/hud.ts","../../src/main.ts"],"sourcesContent":["import type {\n  Sprite,\n  BackgroundLayer,\n  SegmentColor,\n  KeyCode,\n  LevelTheme,\n} from \"./types\";\n\nexport const KEY = {\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n  A: 65,\n  D: 68,\n  S: 83,\n  W: 87,\n  P: 80,\n  F: 70,\n  SPACE: 32,\n} as const satisfies Record<string, KeyCode>;\n\nexport const COLORS = {\n  SKY: \"#72D7EE\",\n  TREE: \"#005108\",\n  FOG: \"#005108\",\n  LIGHT: {\n    road: \"#6B6B6B\",\n    grass: \"#10AA10\",\n    rumble: \"#555555\",\n    lane: \"#CCCCCC\",\n  },\n  DARK: { road: \"#696969\", grass: \"#009A00\", rumble: \"#BBBBBB\" },\n  START: { road: \"white\", grass: \"white\", rumble: \"white\" },\n  CHECKPOINT: { road: \"#FFFF88\", grass: \"#FFFF88\", rumble: \"#FFFF88\" },\n  FINISH: { road: \"black\", grass: \"black\", rumble: \"black\" },\n} as const satisfies Record<string, SegmentColor | string>;\n\nexport const BACKGROUND = {\n  HILLS: { x: 5, y: 5, w: 1280, h: 480 },\n  SKY: { x: 5, y: 495, w: 1280, h: 480 },\n  TREES: { x: 5, y: 985, w: 1280, h: 480 },\n} as const satisfies Record<string, BackgroundLayer>;\n\nexport const SPRITES = {\n  CHECKPOINT_BANNER: { x: 5, y: 5, w: 400, h: 120 },\n  FINISH_BANNER: { x: 410, y: 5, w: 400, h: 120 },\n  PALM_TREE: { x: 5, y: 5, w: 215, h: 540 },\n  BILLBOARD08: { x: 230, y: 5, w: 385, h: 265 },\n  TREE1: { x: 625, y: 5, w: 360, h: 360 },\n  DEAD_TREE1: { x: 5, y: 555, w: 135, h: 332 },\n  BILLBOARD09: { x: 150, y: 555, w: 328, h: 282 },\n  BOULDER3: { x: 230, y: 280, w: 320, h: 220 },\n  COLUMN: { x: 995, y: 5, w: 200, h: 315 },\n  BILLBOARD01: { x: 625, y: 375, w: 300, h: 170 },\n  BILLBOARD06: { x: 488, y: 555, w: 298, h: 190 },\n  BILLBOARD05: { x: 5, y: 897, w: 298, h: 190 },\n  BILLBOARD07: { x: 313, y: 897, w: 298, h: 190 },\n  BOULDER2: { x: 621, y: 897, w: 298, h: 140 },\n  TREE2: { x: 1205, y: 5, w: 282, h: 295 },\n  BILLBOARD04: { x: 1205, y: 310, w: 268, h: 170 },\n  DEAD_TREE2: { x: 1205, y: 490, w: 150, h: 260 },\n  BOULDER1: { x: 1205, y: 760, w: 168, h: 248 },\n  BUSH1: { x: 5, y: 1097, w: 240, h: 155 },\n  CACTUS: { x: 929, y: 897, w: 235, h: 118 },\n  BUSH2: { x: 255, y: 1097, w: 232, h: 152 },\n  BILLBOARD03: { x: 5, y: 1262, w: 230, h: 220 },\n  BILLBOARD02: { x: 245, y: 1262, w: 215, h: 220 },\n  STUMP: { x: 995, y: 330, w: 195, h: 140 },\n  SEMI: { x: 1365, y: 490, w: 122, h: 144 },\n  TRUCK: { x: 1365, y: 644, w: 100, h: 78 },\n  CAR03: { x: 1383, y: 760, w: 88, h: 55 },\n  CAR02: { x: 1383, y: 825, w: 80, h: 59 },\n  CAR04: { x: 1383, y: 894, w: 80, h: 57 },\n  CAR01: { x: 1205, y: 1018, w: 80, h: 56 },\n  PLAYER_UPHILL_LEFT: { x: 1383, y: 961, w: 80, h: 45 },\n  PLAYER_UPHILL_STRAIGHT: { x: 1295, y: 1018, w: 80, h: 45 },\n  PLAYER_UPHILL_RIGHT: { x: 1385, y: 1018, w: 80, h: 45 },\n  PLAYER_LEFT: { x: 995, y: 480, w: 80, h: 41 },\n  PLAYER_STRAIGHT: { x: 1085, y: 480, w: 80, h: 41 },\n  PLAYER_RIGHT: { x: 995, y: 531, w: 80, h: 41 },\n} as const satisfies Record<string, Sprite>;\n\nexport const SPRITE_SCALE = 0.3 * (1 / SPRITES.PLAYER_STRAIGHT.w);\n\nexport const SPRITE_GROUPS = {\n  BILLBOARDS: [\n    SPRITES.BILLBOARD01,\n    SPRITES.BILLBOARD02,\n    SPRITES.BILLBOARD03,\n    SPRITES.BILLBOARD04,\n    SPRITES.BILLBOARD05,\n    SPRITES.BILLBOARD06,\n    SPRITES.BILLBOARD07,\n    SPRITES.BILLBOARD08,\n    SPRITES.BILLBOARD09,\n  ] as const,\n  PLANTS: [\n    SPRITES.TREE1,\n    SPRITES.TREE2,\n    SPRITES.DEAD_TREE1,\n    SPRITES.DEAD_TREE2,\n    SPRITES.PALM_TREE,\n    SPRITES.BUSH1,\n    SPRITES.BUSH2,\n    SPRITES.CACTUS,\n    SPRITES.STUMP,\n    SPRITES.BOULDER1,\n    SPRITES.BOULDER2,\n    SPRITES.BOULDER3,\n  ] as const,\n  CARS: [\n    SPRITES.CAR01,\n    SPRITES.CAR02,\n    SPRITES.CAR03,\n    SPRITES.CAR04,\n    SPRITES.SEMI,\n    SPRITES.TRUCK,\n  ] as const,\n} as const;\n\nexport const ROAD = {\n  LENGTH: { NONE: 0, SHORT: 25, MEDIUM: 50, LONG: 100 },\n  HILL: { NONE: 0, LOW: 20, MEDIUM: 40, HIGH: 60 },\n  CURVE: { NONE: 0, EASY: 2, MEDIUM: 4, HARD: 6 },\n} as const;\n\nexport const THEMES: Record<string, LevelTheme> = {\n  night: {\n    id: \"night\",\n    name: \"Night\",\n    description: \"Moody and fast. Manhattan-style skyline with neon accents.\",\n    colors: {\n      sky: \"#0a0a1a\",\n      fog: \"#001122\",\n      road: {\n        road: \"#1a1a2e\",\n        grass: \"#0d1117\",\n        rumble: \"#2d2d44\",\n        lane: \"#ffdd00\",\n      },\n    },\n    effects: { fogDensity: 4, fogStart: 0.6 },\n    physics: {\n      grip: 1.0,\n      offRoadGrip: 0.8,\n      maxSpeed: 1.0,\n      acceleration: 1.0,\n      brakeForce: 1.0,\n    },\n    filters: {\n      global: \"brightness(0.7) saturate(0.9)\",\n      background: \"brightness(0.5)\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  fog: {\n    id: \"fog\",\n    name: \"Fog\",\n    description: \"Tense and claustrophobic. Visibility severely reduced.\",\n    colors: {\n      sky: \"#9e9e9e\",\n      fog: \"#7a8a7a\",\n      road: {\n        road: \"#5a5a5a\",\n        grass: \"#4a5d4a\",\n        rumble: \"#6a6a6a\",\n        lane: \"#888888\",\n      },\n    },\n    effects: { fogDensity: 8, fogStart: 0.3 },\n    physics: {\n      grip: 1.0,\n      offRoadGrip: 0.9,\n      maxSpeed: 0.95,\n      acceleration: 1.0,\n      brakeForce: 1.0,\n    },\n    filters: {\n      global: \"blur(0.3px) contrast(0.9) brightness(0.9)\",\n      background: \"\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  snow: {\n    id: \"snow\",\n    name: \"Snow\",\n    description: \"Slippery and bright. Car skids on ice patches.\",\n    colors: {\n      sky: \"#e8f4fc\",\n      fog: \"#d0e8f0\",\n      road: {\n        road: \"#e8e8e8\",\n        grass: \"#f5f5f5\",\n        rumble: \"#cccccc\",\n        lane: \"#333333\",\n      },\n    },\n    effects: {\n      fogDensity: 3,\n      fogStart: 0.7,\n      snow: { density: 50, speed: 2, direction: 0.1, sprite: \"snowflake.svg\" },\n    },\n    physics: {\n      grip: 0.6,\n      offRoadGrip: 0.3,\n      maxSpeed: 0.85,\n      acceleration: 0.8,\n      brakeForce: 0.5,\n      slippery: true,\n    },\n    filters: {\n      global: \"saturate(0.7) brightness(1.05)\",\n      background: \"\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  storm: {\n    id: \"storm\",\n    name: \"Storm\",\n    description: \"Intense and chaotic. Lightning and heavy rain.\",\n    colors: {\n      sky: \"#2d1b4e\",\n      fog: \"#1a1a2e\",\n      road: {\n        road: \"#4a4a5a\",\n        grass: \"#2a3a2a\",\n        rumble: \"#5a5a6a\",\n        lane: \"#8a8a9a\",\n      },\n    },\n    effects: {\n      fogDensity: 6,\n      fogStart: 0.5,\n      rain: { density: 100, speed: 8, direction: 0.2, sprite: \"raindrop.svg\" },\n      lightning: { interval: 8000, duration: 150, flashIntensity: 0.4 },\n    },\n    physics: {\n      grip: 0.85,\n      offRoadGrip: 0.6,\n      maxSpeed: 0.9,\n      acceleration: 0.95,\n      brakeForce: 0.9,\n      slippery: true,\n    },\n    filters: {\n      global: \"saturate(0.8) brightness(0.85) contrast(1.1)\",\n      background: \"\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  desert: {\n    id: \"desert\",\n    name: \"Desert\",\n    description: \"Hot and hazardous. Sand slows you down.\",\n    colors: {\n      sky: \"#f4a460\",\n      fog: \"#daa520\",\n      road: {\n        road: \"#d2691e\",\n        grass: \"#f4a460\",\n        rumble: \"#8b4513\",\n        lane: \"#ffdead\",\n      },\n    },\n    effects: { fogDensity: 3, fogStart: 0.7, heatHaze: true },\n    physics: {\n      grip: 0.95,\n      offRoadGrip: 0.4,\n      maxSpeed: 1.0,\n      acceleration: 0.9,\n      brakeForce: 1.0,\n    },\n    filters: {\n      global: \"saturate(1.2) sepia(0.15) brightness(1.05)\",\n      background: \"\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  future: {\n    id: \"future\",\n    name: \"Future\",\n    description: \"Sci-fi vibe. Turbo zones and laser obstacles.\",\n    colors: {\n      sky: \"#0d0d2a\",\n      fog: \"#1a1a3e\",\n      road: {\n        road: \"#1a1a3e\",\n        grass: \"#0d0d2a\",\n        rumble: \"#00ffff\",\n        lane: \"#ff00ff\",\n      },\n    },\n    effects: { fogDensity: 2, fogStart: 0.8 },\n    physics: {\n      grip: 1.0,\n      offRoadGrip: 0.8,\n      maxSpeed: 1.2,\n      acceleration: 1.1,\n      brakeForce: 1.0,\n      turboZones: true,\n    },\n    filters: {\n      global: \"contrast(1.2) saturate(1.2) hue-rotate(10deg)\",\n      background: \"\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  marsh: {\n    id: \"marsh\",\n    name: \"Marsh\",\n    description: \"Slippery and dirty. Oil and water make handling difficult.\",\n    colors: {\n      sky: \"#4a5d4a\",\n      fog: \"#3d4d3d\",\n      road: {\n        road: \"#5d4037\",\n        grass: \"#2e7d32\",\n        rumble: \"#4a3a2a\",\n        lane: \"#8a8a7a\",\n      },\n    },\n    effects: { fogDensity: 4, fogStart: 0.6 },\n    physics: {\n      grip: 0.7,\n      offRoadGrip: 0.3,\n      maxSpeed: 0.85,\n      acceleration: 0.7,\n      brakeForce: 0.8,\n      slippery: true,\n    },\n    filters: {\n      global: \"saturate(0.8) brightness(0.9)\",\n      background: \"\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  mountains: {\n    id: \"mountains\",\n    name: \"Mountains\",\n    description: \"Precarious. Narrow roads with sheer drops.\",\n    colors: {\n      sky: \"#87ceeb\",\n      fog: \"#a0a0a0\",\n      road: {\n        road: \"#6b4423\",\n        grass: \"#4a7c4a\",\n        rumble: \"#808080\",\n        lane: \"#cccccc\",\n      },\n    },\n    effects: { fogDensity: 4, fogStart: 0.5 },\n    physics: {\n      grip: 1.0,\n      offRoadGrip: 0.5,\n      maxSpeed: 0.9,\n      acceleration: 0.95,\n      brakeForce: 1.1,\n    },\n    filters: {\n      global: \"saturate(0.9) brightness(0.95)\",\n      background: \"\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  lakes: {\n    id: \"lakes\",\n    name: \"Lakes\",\n    description: \"Scenic but tricky. Jump across rivers.\",\n    colors: {\n      sky: \"#87ceeb\",\n      fog: \"#a0d0e0\",\n      road: {\n        road: \"#4a4a4a\",\n        grass: \"#4caf50\",\n        rumble: \"#3a8a3a\",\n        lane: \"#ffffff\",\n      },\n    },\n    effects: { fogDensity: 2, fogStart: 0.8 },\n    physics: {\n      grip: 0.9,\n      offRoadGrip: 0.6,\n      maxSpeed: 1.0,\n      acceleration: 1.0,\n      brakeForce: 0.9,\n      jumpZones: true,\n    },\n    filters: {\n      global: \"saturate(1.2) brightness(1.05)\",\n      background: \"\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  country: {\n    id: \"country\",\n    name: \"Country\",\n    description: \"Relaxed but winding. Logs, rocks, and fords.\",\n    colors: {\n      sky: \"#87ceeb\",\n      fog: \"#a0c0a0\",\n      road: {\n        road: \"#5a5a5a\",\n        grass: \"#4caf50\",\n        rumble: \"#8b4513\",\n        lane: \"#ffffff\",\n      },\n    },\n    effects: { fogDensity: 2, fogStart: 0.8 },\n    physics: {\n      grip: 1.0,\n      offRoadGrip: 0.7,\n      maxSpeed: 1.0,\n      acceleration: 1.0,\n      brakeForce: 1.0,\n    },\n    filters: {\n      global: \"saturate(1.2) brightness(1.1)\",\n      background: \"\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  city: {\n    id: \"city\",\n    name: \"City\",\n    description: \"Urban and busy. Wide motorway with oncoming traffic.\",\n    colors: {\n      sky: \"#4a6080\",\n      fog: \"#3a4a5a\",\n      road: {\n        road: \"#4a4a4a\",\n        grass: \"#2a2a2a\",\n        rumble: \"#1a1a1a\",\n        lane: \"#ffffff\",\n      },\n    },\n    effects: { fogDensity: 3, fogStart: 0.7 },\n    physics: {\n      grip: 1.0,\n      offRoadGrip: 0.3,\n      maxSpeed: 1.1,\n      acceleration: 1.0,\n      brakeForce: 1.0,\n    },\n    filters: {\n      global: \"saturate(0.9) brightness(0.95)\",\n      background: \"\",\n      road: \"\",\n    },\n    background: \"background-level-1.svg\",\n  },\n\n  roadworks: {\n    id: \"roadworks\",\n    name: \"Roadworks\",\n    description: \"Frantic. Bollards and signs everywhere.\",\n    colors: {\n      sky: \"#708090\",\n      fog: \"#5a6a7a\",\n      road: {\n        road: \"#4a4a4a\",\n        grass: \"#3a3a3a\",\n        rumble: \"#ff6600\",\n        lane: \"#ffffff\",\n      },\n    },\n    effects: { fogDensity: 3, fogStart: 0.7 },\n    physics: {\n      grip: 1.0,\n      offRoadGrip: 0.5,\n      maxSpeed: 0.85,\n      acceleration: 0.9,\n      brakeForce: 1.2,\n    },\n    filters: { global: \"\", background: \"\", road: \"\" },\n    background: \"background-level-1.svg\",\n  },\n\n  windy: {\n    id: \"windy\",\n    name: \"Windy\",\n    description: \"Open and quirky. Tumbleweeds and strong gusts.\",\n    colors: {\n      sky: \"#fffacd\",\n      fog: \"#e8d8b8\",\n      road: {\n        road: \"#c4a06a\",\n        grass: \"#d2b48c\",\n        rumble: \"#8b7355\",\n        lane: \"#ffffff\",\n      },\n    },\n    effects: {\n      fogDensity: 2,\n      fogStart: 0.8,\n      wind: {\n        baseForce: 0.1,\n        gustInterval: 8000,\n        gustDuration: 1500,\n        maxGustForce: 0.2,\n        direction: 0,\n      },\n    },\n    physics: {\n      grip: 0.95,\n      offRoadGrip: 0.7,\n      maxSpeed: 1.0,\n      acceleration: 1.0,\n      brakeForce: 1.0,\n      windForce: 0.3,\n    },\n    filters: { global: \"sepia(0.1) saturate(0.9)\", background: \"\", road: \"\" },\n    background: \"background-level-1.svg\",\n    spriteOverrides: {\n      PALM_TREE: \"CACTUS\",\n      TREE1: \"DEAD_TREE1\",\n      TREE2: \"DEAD_TREE2\",\n    },\n  },\n};\n\nexport const THEME_ORDER = [\n  \"night\",\n  \"fog\",\n  \"snow\",\n  \"storm\",\n  \"desert\",\n  \"future\",\n  \"marsh\",\n  \"mountains\",\n  \"lakes\",\n  \"country\",\n  \"city\",\n  \"roadworks\",\n  \"windy\",\n] as const;\n","export const timestamp = (): number => new Date().getTime();\n\nexport const toInt = (obj: unknown, def: number): number => {\n  if (obj !== null && obj !== undefined) {\n    const x = parseInt(String(obj), 10);\n    if (!isNaN(x)) return x;\n  }\n  return def;\n};\n\nexport const toFloat = (obj: unknown, def: number): number => {\n  if (obj !== null && obj !== undefined) {\n    const x = parseFloat(String(obj));\n    if (!isNaN(x)) return x;\n  }\n  return def;\n};\n\nexport const limit = (value: number, min: number, max: number): number =>\n  Math.max(min, Math.min(value, max));\n\nexport const randomInt = (min: number, max: number): number =>\n  Math.round(interpolate(min, max, Math.random()));\n\nexport const randomChoice = <T>(options: readonly T[]): T =>\n  options[randomInt(0, options.length - 1)]!;\n\nexport const percentRemaining = (n: number, total: number): number =>\n  (n % total) / total;\n\nexport const accelerate = (v: number, accel: number, dt: number): number =>\n  v + accel * dt;\n\nexport const interpolate = (a: number, b: number, percent: number): number =>\n  a + (b - a) * percent;\n\nexport const easeIn = (a: number, b: number, percent: number): number =>\n  a + (b - a) * Math.pow(percent, 2);\n\nexport const easeOut = (a: number, b: number, percent: number): number =>\n  a + (b - a) * (1 - Math.pow(1 - percent, 2));\n\nexport const easeInOut = (a: number, b: number, percent: number): number =>\n  a + (b - a) * (-Math.cos(percent * Math.PI) / 2 + 0.5);\n\nexport const exponentialFog = (distance: number, density: number): number =>\n  1 / Math.pow(Math.E, distance * distance * density);\n\nexport const increase = (\n  start: number,\n  increment: number,\n  max: number,\n): number => {\n  let result = start + increment;\n  while (result >= max) result -= max;\n  while (result < 0) result += max;\n  return result;\n};\n\nexport interface ProjectablePoint {\n  world: { x?: number; y?: number; z?: number };\n  camera: { x: number; y: number; z: number };\n  screen: { x: number; y: number; scale: number; w?: number };\n}\n\nexport const project = (\n  p: ProjectablePoint,\n  cameraX: number,\n  cameraY: number,\n  cameraZ: number,\n  cameraDepth: number,\n  width: number,\n  height: number,\n  roadWidth: number,\n): void => {\n  p.camera.x = (p.world.x ?? 0) - cameraX;\n  p.camera.y = (p.world.y ?? 0) - cameraY;\n  p.camera.z = (p.world.z ?? 0) - cameraZ;\n  p.screen.scale = cameraDepth / p.camera.z;\n  p.screen.x = Math.round(\n    width / 2 + (p.screen.scale * p.camera.x * width) / 2,\n  );\n  p.screen.y = Math.round(\n    height / 2 - (p.screen.scale * p.camera.y * height) / 2,\n  );\n  p.screen.w = Math.round((p.screen.scale * roadWidth * width) / 2);\n};\n\nexport const overlap = (\n  x1: number,\n  w1: number,\n  x2: number,\n  w2: number,\n  percent: number = 1,\n): boolean => {\n  const half = percent / 2;\n  const min1 = x1 - w1 * half;\n  const max1 = x1 + w1 * half;\n  const min2 = x2 - w2 * half;\n  const max2 = x2 + w2 * half;\n  return !(max1 < min2 || min1 > max2);\n};\n","import type { Segment, SegmentSprite, Sprite } from \"./types\";\nimport {\n  COLORS,\n  ROAD,\n  SPRITES,\n  SPRITE_SCALE,\n  SPRITE_GROUPS,\n} from \"./constants\";\nimport * as Util from \"./utils/math\";\n\nlet segments: Segment[] = [];\n\nexport const getSegments = (): Segment[] => segments;\nexport const setSegments = (s: Segment[]): void => {\n  segments = s;\n};\n\nexport const findSegment = (z: number, segmentLength: number): Segment => {\n  const index = Math.floor(z / segmentLength) % segments.length;\n  return segments[index]!;\n};\n\nexport const getLastY = (): number => {\n  if (segments.length === 0) return 0;\n  return segments[segments.length - 1]!.p2.world.y;\n};\n\nexport const addSegment = (\n  curve: number,\n  y: number,\n  segmentLength: number,\n  rumbleLength: number,\n): void => {\n  const n = segments.length;\n  segments.push({\n    index: n,\n    p1: {\n      world: { x: 0, y: getLastY(), z: n * segmentLength },\n      camera: { x: 0, y: 0, z: 0 },\n      screen: { x: 0, y: 0, scale: 0, w: 0 },\n    },\n    p2: {\n      world: { x: 0, y, z: (n + 1) * segmentLength },\n      camera: { x: 0, y: 0, z: 0 },\n      screen: { x: 0, y: 0, scale: 0, w: 0 },\n    },\n    curve,\n    sprites: [],\n    cars: [],\n    color: Math.floor(n / rumbleLength) % 2 ? COLORS.DARK : COLORS.LIGHT,\n  });\n};\n\nexport const addSprite = (n: number, sprite: Sprite, offset: number): void => {\n  if (segments[n]) {\n    segments[n]!.sprites.push({ source: sprite, offset });\n  }\n};\n\nexport const addRoad = (\n  enter: number,\n  hold: number,\n  leave: number,\n  curve: number,\n  y: number,\n  segmentLength: number,\n  rumbleLength: number,\n): void => {\n  const startY = getLastY();\n  const endY = startY + Util.toInt(y, 0) * segmentLength;\n  const total = enter + hold + leave;\n\n  for (let n = 0; n < enter; n++) {\n    addSegment(\n      Util.easeIn(0, curve, n / enter),\n      Util.easeInOut(startY, endY, n / total),\n      segmentLength,\n      rumbleLength,\n    );\n  }\n  for (let n = 0; n < hold; n++) {\n    addSegment(\n      curve,\n      Util.easeInOut(startY, endY, (enter + n) / total),\n      segmentLength,\n      rumbleLength,\n    );\n  }\n  for (let n = 0; n < leave; n++) {\n    addSegment(\n      Util.easeInOut(curve, 0, n / leave),\n      Util.easeInOut(startY, endY, (enter + hold + n) / total),\n      segmentLength,\n      rumbleLength,\n    );\n  }\n};\n\nexport const addStraight = (\n  num: number,\n  segmentLength: number,\n  rumbleLength: number,\n): void => {\n  const n = num || ROAD.LENGTH.MEDIUM;\n  addRoad(n, n, n, 0, 0, segmentLength, rumbleLength);\n};\n\nexport const addHill = (\n  num: number,\n  height: number,\n  segmentLength: number,\n  rumbleLength: number,\n): void => {\n  const n = num || ROAD.LENGTH.MEDIUM;\n  const h = height || ROAD.HILL.MEDIUM;\n  addRoad(n, n, n, 0, h, segmentLength, rumbleLength);\n};\n\nexport const addCurve = (\n  num: number,\n  curve: number,\n  height: number,\n  segmentLength: number,\n  rumbleLength: number,\n): void => {\n  const n = num || ROAD.LENGTH.MEDIUM;\n  const c = curve || ROAD.CURVE.MEDIUM;\n  const h = height || ROAD.HILL.NONE;\n  addRoad(n, n, n, c, h, segmentLength, rumbleLength);\n};\n\nexport const addLowRollingHills = (\n  segmentLength: number,\n  rumbleLength: number,\n): void => {\n  addRoad(\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    0,\n    ROAD.HILL.LOW / 2,\n    segmentLength,\n    rumbleLength,\n  );\n  addRoad(\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    0,\n    -ROAD.HILL.LOW,\n    segmentLength,\n    rumbleLength,\n  );\n  addRoad(\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    ROAD.CURVE.EASY,\n    ROAD.HILL.LOW,\n    segmentLength,\n    rumbleLength,\n  );\n  addRoad(\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    0,\n    0,\n    segmentLength,\n    rumbleLength,\n  );\n  addRoad(\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    -ROAD.CURVE.EASY,\n    ROAD.HILL.LOW / 2,\n    segmentLength,\n    rumbleLength,\n  );\n  addRoad(\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    ROAD.LENGTH.SHORT,\n    0,\n    0,\n    segmentLength,\n    rumbleLength,\n  );\n};\n\nexport const addSCurves = (\n  segmentLength: number,\n  rumbleLength: number,\n): void => {\n  addRoad(\n    ROAD.LENGTH.MEDIUM,\n    ROAD.LENGTH.MEDIUM,\n    ROAD.LENGTH.MEDIUM,\n    -ROAD.CURVE.EASY,\n    ROAD.HILL.NONE,\n    segmentLength,\n    rumbleLength,\n  );\n  addRoad(\n    ROAD.LENGTH.MEDIUM,\n    ROAD.LENGTH.MEDIUM,\n    ROAD.LENGTH.MEDIUM,\n    ROAD.CURVE.MEDIUM,\n    ROAD.HILL.MEDIUM,\n    segmentLength,\n    rumbleLength,\n  );\n  addRoad(\n    ROAD.LENGTH.MEDIUM,\n    ROAD.LENGTH.MEDIUM,\n    ROAD.LENGTH.MEDIUM,\n    ROAD.CURVE.EASY,\n    -ROAD.HILL.LOW,\n    segmentLength,\n    rumbleLength,\n  );\n  addRoad(\n    ROAD.LENGTH.MEDIUM,\n    ROAD.LENGTH.MEDIUM,\n    ROAD.LENGTH.MEDIUM,\n    -ROAD.CURVE.EASY,\n    ROAD.HILL.MEDIUM,\n    segmentLength,\n    rumbleLength,\n  );\n  addRoad(\n    ROAD.LENGTH.MEDIUM,\n    ROAD.LENGTH.MEDIUM,\n    ROAD.LENGTH.MEDIUM,\n    -ROAD.CURVE.MEDIUM,\n    -ROAD.HILL.MEDIUM,\n    segmentLength,\n    rumbleLength,\n  );\n};\n\nexport const addBumps = (segmentLength: number, rumbleLength: number): void => {\n  addRoad(10, 10, 10, 0, 5, segmentLength, rumbleLength);\n  addRoad(10, 10, 10, 0, -2, segmentLength, rumbleLength);\n  addRoad(10, 10, 10, 0, -5, segmentLength, rumbleLength);\n  addRoad(10, 10, 10, 0, 8, segmentLength, rumbleLength);\n  addRoad(10, 10, 10, 0, 5, segmentLength, rumbleLength);\n  addRoad(10, 10, 10, 0, -7, segmentLength, rumbleLength);\n  addRoad(10, 10, 10, 0, 5, segmentLength, rumbleLength);\n  addRoad(10, 10, 10, 0, -2, segmentLength, rumbleLength);\n};\n\nexport const addDownhillToEnd = (\n  segmentLength: number,\n  rumbleLength: number,\n): void => {\n  addRoad(\n    200,\n    200,\n    200,\n    -ROAD.CURVE.EASY,\n    -getLastY() / segmentLength,\n    segmentLength,\n    rumbleLength,\n  );\n};\n\nexport const resetSprites = (): void => {\n  addSprite(20, SPRITES.BILLBOARD07, -1);\n  addSprite(40, SPRITES.BILLBOARD06, -1);\n  addSprite(60, SPRITES.BILLBOARD08, -1);\n  addSprite(80, SPRITES.BILLBOARD09, -1);\n  addSprite(100, SPRITES.BILLBOARD01, -1);\n  addSprite(120, SPRITES.BILLBOARD02, -1);\n  addSprite(140, SPRITES.BILLBOARD03, -1);\n  addSprite(160, SPRITES.BILLBOARD04, -1);\n  addSprite(180, SPRITES.BILLBOARD05, -1);\n\n  addSprite(240, SPRITES.BILLBOARD07, -1.2);\n  addSprite(240, SPRITES.BILLBOARD06, 1.2);\n  addSprite(segments.length - 25, SPRITES.BILLBOARD07, -1.2);\n  addSprite(segments.length - 25, SPRITES.BILLBOARD06, 1.2);\n\n  for (let n = 10; n < 200; n += 4 + Math.floor(n / 100)) {\n    addSprite(n, SPRITES.PALM_TREE, 0.5 + Math.random() * 0.5);\n    addSprite(n, SPRITES.PALM_TREE, 1 + Math.random() * 2);\n  }\n\n  for (let n = 250; n < 1000; n += 5) {\n    addSprite(n, SPRITES.COLUMN, 1.1);\n    addSprite(n + Util.randomInt(0, 5), SPRITES.TREE1, -1 - Math.random() * 2);\n    addSprite(n + Util.randomInt(0, 5), SPRITES.TREE2, -1 - Math.random() * 2);\n  }\n\n  for (let n = 200; n < segments.length; n += 3) {\n    addSprite(\n      n,\n      Util.randomChoice(SPRITE_GROUPS.PLANTS),\n      Util.randomChoice([1, -1]) * (2 + Math.random() * 5),\n    );\n  }\n\n  for (let n = 1000; n < segments.length - 50; n += 100) {\n    const side = Util.randomChoice([1, -1]);\n    addSprite(\n      n + Util.randomInt(0, 50),\n      Util.randomChoice(SPRITE_GROUPS.BILLBOARDS),\n      -side,\n    );\n    for (let i = 0; i < 20; i++) {\n      const sprite = Util.randomChoice(SPRITE_GROUPS.PLANTS);\n      const offset = side * (1.5 + Math.random());\n      addSprite(n + Util.randomInt(0, 50), sprite, offset);\n    }\n  }\n};\n\nexport const CHECKPOINTS_PER_LAP = 4;\n\nexport const resetRoad = (\n  segmentLength: number,\n  rumbleLength: number,\n  playerZ: number,\n): number => {\n  segments = [];\n\n  addStraight(ROAD.LENGTH.SHORT, segmentLength, rumbleLength);\n  addLowRollingHills(segmentLength, rumbleLength);\n  addSCurves(segmentLength, rumbleLength);\n  addCurve(\n    ROAD.LENGTH.MEDIUM,\n    ROAD.CURVE.MEDIUM,\n    ROAD.HILL.LOW,\n    segmentLength,\n    rumbleLength,\n  );\n  addBumps(segmentLength, rumbleLength);\n  addCurve(\n    ROAD.LENGTH.LONG,\n    ROAD.CURVE.MEDIUM,\n    ROAD.HILL.MEDIUM,\n    segmentLength,\n    rumbleLength,\n  );\n  addStraight(ROAD.LENGTH.MEDIUM, segmentLength, rumbleLength);\n  addHill(ROAD.LENGTH.MEDIUM, ROAD.HILL.HIGH, segmentLength, rumbleLength);\n  addCurve(\n    ROAD.LENGTH.MEDIUM,\n    -ROAD.CURVE.MEDIUM,\n    ROAD.HILL.NONE,\n    segmentLength,\n    rumbleLength,\n  );\n  addDownhillToEnd(segmentLength, rumbleLength);\n\n  resetSprites();\n\n  const playerSegment = findSegment(playerZ, segmentLength);\n  segments[playerSegment.index + 2]!.color = COLORS.START;\n  segments[playerSegment.index + 3]!.color = COLORS.START;\n\n  const totalSegments = segments.length;\n  const segmentsPerCheckpoint = Math.floor(\n    totalSegments / (CHECKPOINTS_PER_LAP + 1),\n  );\n\n  for (let i = 1; i <= CHECKPOINTS_PER_LAP; i++) {\n    const checkpointIndex = segmentsPerCheckpoint * i;\n    if (checkpointIndex < totalSegments - rumbleLength) {\n      segments[checkpointIndex]!.color = COLORS.CHECKPOINT;\n      addSprite(checkpointIndex, SPRITES.CHECKPOINT_BANNER, 0);\n    }\n  }\n\n  for (let n = 0; n < rumbleLength; n++) {\n    segments[segments.length - 1 - n]!.color = COLORS.FINISH;\n  }\n  addSprite(segments.length - rumbleLength - 5, SPRITES.FINISH_BANNER, 0);\n\n  return segments.length * segmentLength;\n};\n","import type { CameraConfig } from \"./types\";\n\nexport const createCamera = (\n  fieldOfView: number,\n  height: number,\n): CameraConfig => {\n  const depth = 1 / Math.tan(((fieldOfView / 2) * Math.PI) / 180);\n  return {\n    height,\n    depth,\n    fieldOfView,\n  };\n};\n\nexport const getPlayerZ = (\n  cameraHeight: number,\n  cameraDepth: number,\n): number => {\n  return cameraHeight * cameraDepth;\n};\n\nexport const calculateResolution = (\n  height: number,\n  baseHeight: number = 480,\n): number => {\n  return height / baseHeight;\n};\n","import type {\n  GameConfig,\n  PlayerState,\n  InputState,\n  Car,\n  Segment,\n  LevelTheme,\n  WindState,\n  JumpState,\n  Particle,\n  Tumbleweed,\n  ThemePhysics,\n} from \"./types\";\nimport { SPRITE_SCALE, SPRITE_GROUPS, KEY } from \"./constants\";\nimport * as Util from \"./utils/math\";\nimport * as Segments from \"./segments\";\nimport * as Render from \"./renderer/canvas\";\nimport * as Camera from \"./camera\";\n\nexport interface WorldState {\n  config: GameConfig;\n  baseConfig: GameConfig;\n  player: PlayerState;\n  input: InputState;\n  players: PlayerState[];\n  inputs: InputState[];\n  cars: Car[];\n  segments: Segment[];\n  trackLength: number;\n  skyOffset: number;\n  hillOffset: number;\n  treeOffset: number;\n  currentLapTime: number;\n  lastLapTime: number | null;\n  fastLapTime: number | null;\n  currentTheme: LevelTheme | null;\n  windState: WindState;\n  jumpState: JumpState;\n  particles: Particle[];\n  tumbleweeds: Tumbleweed[];\n  slideVelocity: number;\n  lightningActive: boolean;\n  lightningTimer: number;\n  playerCount: number;\n  onCollision?: (intensity: number) => void;\n}\n\nexport const createDefaultConfig = (): GameConfig => ({\n  fps: 60,\n  width: 1024,\n  height: 768,\n  lanes: 3,\n  roadWidth: 2000,\n  segmentLength: 200,\n  rumbleLength: 3,\n  drawDistance: 300,\n  fogDensity: 5,\n  centrifugal: 0.3,\n  maxSpeed: (200 / (1 / 60)) * 1.5, // 50% faster\n  accel: (200 / (1 / 60) / 5) * 1.5,\n  braking: -(200 / (1 / 60)) * 1.5,\n  decel: -(200 / (1 / 60) / 5) * 1.5,\n  offRoadDecel: -(200 / (1 / 60) / 2) * 1.5,\n  offRoadLimit: (200 / (1 / 60) / 4) * 1.5,\n});\n\nexport const createDefaultPlayer = (playerZ: number): PlayerState => ({\n  x: 0,\n  z: playerZ,\n  position: 0,\n  speed: 0,\n});\n\nexport const applyThemePhysics = (\n  baseConfig: GameConfig,\n  physics: ThemePhysics,\n): GameConfig => {\n  return {\n    ...baseConfig,\n    maxSpeed: baseConfig.maxSpeed * physics.maxSpeed,\n    accel: baseConfig.accel * physics.acceleration,\n    braking: baseConfig.braking * physics.brakeForce,\n    offRoadDecel: baseConfig.offRoadDecel * physics.offRoadGrip,\n    centrifugal: baseConfig.centrifugal * physics.grip,\n  };\n};\n\nexport const setTheme = (world: WorldState, theme: LevelTheme): void => {\n  world.currentTheme = theme;\n  world.config = applyThemePhysics(world.baseConfig, theme.physics);\n  world.windState = createDefaultWindState();\n  world.jumpState = createDefaultJumpState();\n  world.particles = [];\n  world.tumbleweeds = [];\n  world.slideVelocity = 0;\n  world.lightningActive = false;\n  world.lightningTimer = 0;\n};\n\nexport const updateWind = (\n  world: WorldState,\n  dt: number,\n  speedPercent: number,\n): void => {\n  const theme = world.currentTheme;\n  if (!theme?.effects.wind) return;\n\n  const wind = world.windState;\n  const config = theme.effects.wind;\n\n  wind.gustTimer += dt * 1000;\n\n  if (!wind.gusting && wind.gustTimer > config.gustInterval) {\n    // Variable gust duration (1.5-3s) and random direction\n    if (Math.random() < 0.7) {\n      wind.gusting = true;\n      wind.gustDuration = config.gustDuration + Math.random() * 1500;\n      wind.currentDirection = Math.random() > 0.5 ? 1 : -1;\n      wind.currentForce =\n        config.baseForce +\n        Math.random() * (config.maxGustForce - config.baseForce);\n    }\n    wind.gustTimer = 0;\n  }\n\n  if (wind.gusting && wind.gustTimer > wind.gustDuration) {\n    wind.gusting = false;\n    wind.currentForce = 0;\n    wind.currentDirection = 0;\n    wind.gustTimer = 0;\n  }\n\n  // Apply wind force only during active gusts and only when moving\n  // Wind doesn't affect stationary cars\n  if (wind.gusting && speedPercent > 0) {\n    world.player.x +=\n      wind.currentForce * wind.currentDirection * dt * 0.5 * speedPercent;\n  }\n};\n\nexport const updateJump = (world: WorldState, dt: number): void => {\n  const jump = world.jumpState;\n  if (!jump.active) return;\n\n  const elapsed = (performance.now() - jump.startTime) / 1000;\n  const progress = elapsed / jump.duration;\n\n  if (progress >= 1) {\n    jump.active = false;\n    jump.peakHeight = 0;\n    spawnWaterSplash(world, world.player.x);\n  } else {\n    jump.peakHeight = 4 * jump.peakHeight * (progress - progress * progress);\n  }\n};\n\nexport const spawnWaterSplash = (world: WorldState, x: number): void => {\n  for (let i = 0; i < 8; i++) {\n    world.particles.push({\n      x,\n      y: 0,\n      vx: (Math.random() - 0.5) * 3,\n      vy: -Math.random() * 5,\n      life: 0.5,\n      sprite: \"water-splash.svg\",\n      size: 3 + Math.random() * 4,\n    });\n  }\n};\n\nexport const updateParticles = (world: WorldState, dt: number): void => {\n  const theme = world.currentTheme;\n  const windX = world.windState.currentForce * world.windState.currentDirection;\n\n  for (const p of world.particles) {\n    p.x += (p.vx + windX * 50) * dt;\n    p.y += p.vy * dt;\n    p.life -= dt * 0.8;\n  }\n\n  world.particles = world.particles.filter(\n    (p) => p.life > 0 && p.y < world.config.height,\n  );\n\n  if (theme?.effects.snow && Math.random() < theme.effects.snow.density * dt) {\n    world.particles.push({\n      x: Math.random() * world.config.width,\n      y: -10,\n      vx: theme.effects.snow.direction * 30,\n      vy: theme.effects.snow.speed * 80,\n      life: 1,\n      sprite: \"snowflake.svg\",\n      size: 2 + Math.random() * 3,\n    });\n  }\n\n  if (theme?.effects.rain && Math.random() < theme.effects.rain.density * dt) {\n    world.particles.push({\n      x: Math.random() * world.config.width,\n      y: -10,\n      vx: theme.effects.rain.direction * 50,\n      vy: theme.effects.rain.speed * 200,\n      life: 0.8,\n      sprite: \"raindrop.svg\",\n      size: 1 + Math.random() * 2,\n    });\n  }\n};\n\nexport const updateTumbleweeds = (world: WorldState, dt: number): void => {\n  if (!world.currentTheme?.effects.wind) return;\n\n  for (const weed of world.tumbleweeds) {\n    weed.x += weed.speed * weed.direction * dt;\n    weed.rotation += weed.speed * 3 * dt;\n  }\n\n  world.tumbleweeds = world.tumbleweeds.filter(\n    (w) => Math.abs(w.x) < 4 && w.z > world.player.position - 500,\n  );\n\n  if (Math.random() < 0.015) {\n    const direction =\n      world.windState.currentDirection || (Math.random() > 0.5 ? 1 : -1);\n    world.tumbleweeds.push({\n      x: direction > 0 ? -3.5 : 3.5,\n      z:\n        world.player.position +\n        world.config.drawDistance * world.config.segmentLength,\n      rotation: 0,\n      speed: 0.5 + Math.random() * 0.5,\n      direction,\n    });\n  }\n\n  for (const weed of world.tumbleweeds) {\n    if (Math.abs(world.player.x - weed.x) < 0.15) {\n      world.player.x += weed.direction * 0.02;\n      world.player.speed *= 0.995;\n    }\n  }\n};\n\nexport const updateLightning = (world: WorldState, dt: number): void => {\n  const theme = world.currentTheme;\n  if (!theme?.effects.lightning) return;\n\n  const config = theme.effects.lightning;\n  world.lightningTimer += dt * 1000;\n\n  if (world.lightningActive) {\n    if (world.lightningTimer > config.duration) {\n      world.lightningActive = false;\n      world.lightningTimer = 0;\n    }\n  } else if (world.lightningTimer > config.interval && Math.random() < 0.05) {\n    world.lightningActive = true;\n    world.lightningTimer = 0;\n  }\n};\n\nexport const updateSlidePhysics = (world: WorldState, dt: number): void => {\n  const theme = world.currentTheme;\n  if (!theme?.physics.slippery) {\n    world.slideVelocity *= 0.9;\n    return;\n  }\n\n  const { input, player } = world;\n\n  if (input.left) {\n    world.slideVelocity -= 0.02 * (1 - theme.physics.grip);\n  } else if (input.right) {\n    world.slideVelocity += 0.02 * (1 - theme.physics.grip);\n  }\n\n  player.x += world.slideVelocity * dt * 20;\n  world.slideVelocity *= 0.98;\n  world.slideVelocity = Util.limit(world.slideVelocity, -0.3, 0.3);\n};\n\nexport const createDefaultInput = (): InputState => ({\n  left: false,\n  right: false,\n  faster: false,\n  slower: false,\n});\n\nexport const createDefaultWindState = (): WindState => ({\n  currentForce: 0,\n  currentDirection: 0,\n  gustTimer: 0,\n  gusting: false,\n  gustDuration: 0,\n  extremeWindTimer: 0,\n  extremeWindActive: false,\n});\n\nexport const createDefaultJumpState = (): JumpState => ({\n  active: false,\n  startTime: 0,\n  duration: 0,\n  peakHeight: 0,\n});\n\nexport const createWorld = (playerCount: number = 1): WorldState => {\n  const config = createDefaultConfig();\n  const cameraDepth = 1 / Math.tan(((100 / 2) * Math.PI) / 180);\n  const playerZ = Camera.getPlayerZ(1000, cameraDepth);\n\n  const trackLength = Segments.resetRoad(\n    config.segmentLength,\n    config.rumbleLength,\n    playerZ,\n  );\n  const segments = Segments.getSegments();\n\n  const players: PlayerState[] = [];\n  const inputs: InputState[] = [];\n\n  for (let i = 0; i < playerCount; i++) {\n    players.push(createDefaultPlayer(playerZ));\n    inputs.push(createDefaultInput());\n  }\n\n  const player = players[0] ?? createDefaultPlayer(playerZ);\n  const input = inputs[0] ?? createDefaultInput();\n\n  return {\n    config,\n    baseConfig: { ...config },\n    player,\n    input,\n    players,\n    inputs,\n    cars: [],\n    segments,\n    trackLength,\n    skyOffset: 0,\n    hillOffset: 0,\n    treeOffset: 0,\n    currentLapTime: 0,\n    lastLapTime: null,\n    fastLapTime: null,\n    currentTheme: null,\n    windState: createDefaultWindState(),\n    jumpState: createDefaultJumpState(),\n    particles: [],\n    tumbleweeds: [],\n    slideVelocity: 0,\n    lightningActive: false,\n    lightningTimer: 0,\n    playerCount,\n  };\n};\n\nexport const resetCars = (world: WorldState, totalCars: number): void => {\n  world.cars = [];\n  for (let n = 0; n < totalCars; n++) {\n    const offset = Math.random() * Util.randomChoice([-0.8, 0.8]);\n    const z =\n      Math.floor(Math.random() * world.segments.length) *\n      world.config.segmentLength;\n    const sprite = Util.randomChoice(SPRITE_GROUPS.CARS);\n    const maxSpeed = world.config.maxSpeed;\n    const speed =\n      maxSpeed / 4 +\n      (Math.random() * maxSpeed) / (sprite === SPRITE_GROUPS.CARS[4] ? 4 : 2);\n\n    const car: Car = { offset, z, sprite, speed };\n    const segment = Segments.findSegment(car.z, world.config.segmentLength);\n    segment.cars.push(car);\n    world.cars.push(car);\n  }\n};\n\nexport const updateCarOffset = (\n  car: Car,\n  carSegment: Segment,\n  playerSegment: Segment,\n  playerX: number,\n  playerW: number,\n  speed: number,\n  maxSpeed: number,\n  drawDistance: number,\n  segments: Segment[],\n): number => {\n  const lookahead = 20;\n  const carW = car.sprite.w * SPRITE_SCALE;\n\n  if (carSegment.index - playerSegment.index > drawDistance) return 0;\n\n  for (let i = 1; i < lookahead; i++) {\n    const segmentIndex = (carSegment.index + i) % segments.length;\n    const segment = segments[segmentIndex];\n    if (!segment) continue;\n\n    if (segment === playerSegment && car.speed > speed) {\n      if (Util.overlap(playerX, playerW, car.offset, carW, 1.2)) {\n        const dir =\n          playerX > 0.5\n            ? -1\n            : playerX < -0.5\n              ? 1\n              : car.offset > playerX\n                ? 1\n                : -1;\n        return dir * (1 / i) * ((car.speed - speed) / maxSpeed);\n      }\n    }\n\n    for (const otherCar of segment.cars) {\n      const otherCarW = otherCar.sprite.w * SPRITE_SCALE;\n      if (\n        car.speed > otherCar.speed &&\n        Util.overlap(car.offset, carW, otherCar.offset, otherCarW, 1.2)\n      ) {\n        const dir =\n          otherCar.offset > 0.5\n            ? -1\n            : otherCar.offset < -0.5\n              ? 1\n              : car.offset > otherCar.offset\n                ? 1\n                : -1;\n        return dir * (1 / i) * ((car.speed - otherCar.speed) / maxSpeed);\n      }\n    }\n  }\n\n  if (car.offset < -0.9) return 0.1;\n  if (car.offset > 0.9) return -0.1;\n  return 0;\n};\n\nexport const updateCars = (\n  world: WorldState,\n  playerSegment: Segment,\n  playerW: number,\n): void => {\n  const { segmentLength, drawDistance, maxSpeed } = world.config;\n\n  for (const car of world.cars) {\n    const oldSegment = Segments.findSegment(car.z, segmentLength);\n    car.offset += updateCarOffset(\n      car,\n      oldSegment,\n      playerSegment,\n      world.player.x,\n      playerW,\n      world.player.speed,\n      maxSpeed,\n      drawDistance,\n      world.segments,\n    );\n    car.z = Util.increase(\n      car.z,\n      (1 / world.config.fps) * car.speed,\n      world.trackLength,\n    );\n    car.percent = Util.percentRemaining(car.z, segmentLength);\n\n    const newSegment = Segments.findSegment(car.z, segmentLength);\n    if (oldSegment !== newSegment) {\n      const index = oldSegment.cars.indexOf(car);\n      if (index >= 0) oldSegment.cars.splice(index, 1);\n      newSegment.cars.push(car);\n    }\n  }\n};\n\nexport const update = (world: WorldState, dt: number): void => {\n  const { config, player, input } = world;\n  const {\n    segmentLength,\n    maxSpeed,\n    accel,\n    braking,\n    decel,\n    offRoadDecel,\n    offRoadLimit,\n    centrifugal,\n    lanes,\n  } = config;\n\n  const playerSegment = Segments.findSegment(\n    player.position + player.z,\n    segmentLength,\n  );\n  const playerW = SPRITE_GROUPS.CARS[0]!.w * SPRITE_SCALE;\n  const speedPercent = player.speed / maxSpeed;\n  const dx = dt * 2 * speedPercent;\n  const startPosition = player.position;\n\n  updateCars(world, playerSegment, playerW);\n\n  player.position = Util.increase(\n    player.position,\n    dt * player.speed,\n    world.trackLength,\n  );\n\n  if (input.left) player.x -= dx;\n  else if (input.right) player.x += dx;\n\n  player.x -= dx * speedPercent * playerSegment.curve * centrifugal;\n\n  if (input.faster) player.speed = Util.accelerate(player.speed, accel, dt);\n  else if (input.slower)\n    player.speed = Util.accelerate(player.speed, braking, dt);\n  else player.speed = Util.accelerate(player.speed, decel, dt);\n\n  if (player.x < -1 || player.x > 1) {\n    if (player.speed > offRoadLimit) {\n      player.speed = Util.accelerate(player.speed, offRoadDecel, dt);\n    }\n\n    for (const sprite of playerSegment.sprites) {\n      const spriteW = sprite.source.w * SPRITE_SCALE;\n      const spriteOffset =\n        sprite.offset + (spriteW / 2) * (sprite.offset > 0 ? 1 : -1);\n      if (Util.overlap(player.x, playerW, spriteOffset, spriteW)) {\n        player.speed = maxSpeed / 5;\n        player.position = Util.increase(\n          playerSegment.p1.world.z,\n          -player.z,\n          world.trackLength,\n        );\n        break;\n      }\n    }\n  }\n\n  for (const car of playerSegment.cars) {\n    const carW = car.sprite.w * SPRITE_SCALE;\n    if (\n      player.speed > car.speed &&\n      Util.overlap(player.x, playerW, car.offset, carW, 0.8)\n    ) {\n      player.speed = car.speed * (car.speed / player.speed);\n      player.position = Util.increase(car.z, -player.z, world.trackLength);\n      // Trigger collision event for sound\n      if (world.onCollision) {\n        world.onCollision(0.7);\n      }\n      break;\n    }\n  }\n\n  player.x = Util.limit(player.x, -3, 3);\n  player.speed = Util.limit(player.speed, 0, maxSpeed);\n\n  const positionDelta = (player.position - startPosition) / segmentLength;\n  world.skyOffset = Util.increase(\n    world.skyOffset,\n    0.001 * playerSegment.curve * positionDelta,\n    1,\n  );\n  world.hillOffset = Util.increase(\n    world.hillOffset,\n    0.002 * playerSegment.curve * positionDelta,\n    1,\n  );\n  world.treeOffset = Util.increase(\n    world.treeOffset,\n    0.003 * playerSegment.curve * positionDelta,\n    1,\n  );\n\n  if (player.position > player.z) {\n    if (world.currentLapTime > 0 && startPosition < player.z) {\n      world.lastLapTime = world.currentLapTime;\n      world.currentLapTime = 0;\n    } else {\n      world.currentLapTime += dt;\n    }\n  }\n};\n\nexport const formatTime = (dt: number): string => {\n  const minutes = Math.floor(dt / 60);\n  const seconds = Math.floor(dt - minutes * 60);\n  const tenths = Math.floor(10 * (dt - Math.floor(dt)));\n  if (minutes > 0) {\n    return `${minutes}.${seconds < 10 ? \"0\" : \"\"}${seconds}.${tenths}`;\n  }\n  return `${seconds}.${tenths}`;\n};\n\nexport const handleKeyDown = (world: WorldState, keyCode: number): void => {\n  if (keyCode === KEY.LEFT || keyCode === KEY.A) world.input.left = true;\n  if (keyCode === KEY.RIGHT || keyCode === KEY.D) world.input.right = true;\n  if (keyCode === KEY.UP || keyCode === KEY.W) world.input.faster = true;\n  if (keyCode === KEY.DOWN || keyCode === KEY.S) world.input.slower = true;\n};\n\nexport const handleKeyUp = (world: WorldState, keyCode: number): void => {\n  if (keyCode === KEY.LEFT || keyCode === KEY.A) world.input.left = false;\n  if (keyCode === KEY.RIGHT || keyCode === KEY.D) world.input.right = false;\n  if (keyCode === KEY.UP || keyCode === KEY.W) world.input.faster = false;\n  if (keyCode === KEY.DOWN || keyCode === KEY.S) world.input.slower = false;\n};\n\nexport interface MirrorCar {\n  offset: number;\n  distance: number;\n  color: string;\n}\n\nexport const getMirrorCars = (\n  cars: Car[],\n  playerPosition: number,\n  trackLength: number,\n  mirrorRange: number,\n  maxCars: number = 3,\n): MirrorCar[] => {\n  const carColors = [\"#dc2626\", \"#3b82f6\", \"#f59e0b\", \"#10b981\"];\n  const mirrorCars: MirrorCar[] = [];\n\n  for (const car of cars) {\n    let distanceBehind = playerPosition - car.z;\n    if (distanceBehind < 0) {\n      distanceBehind += trackLength;\n    }\n    if (distanceBehind > 0 && distanceBehind < mirrorRange) {\n      const colorIndex =\n        Math.floor(Math.abs(car.offset * 10)) % carColors.length;\n      const normalizedDistance = Math.min(1, distanceBehind / mirrorRange);\n      mirrorCars.push({\n        offset: car.offset,\n        distance: normalizedDistance,\n        color: carColors[colorIndex] ?? \"#dc2626\",\n      });\n    }\n  }\n\n  mirrorCars.sort((a, b) => b.distance - a.distance);\n  return mirrorCars.slice(0, maxCars);\n};\n","import type { Sprite, BackgroundLayer, SegmentColor, Segment } from \"../types\";\nimport { COLORS, SPRITES, SPRITE_SCALE } from \"../constants\";\nimport * as Util from \"../utils/math\";\n\nexport const polygon = (\n  ctx: CanvasRenderingContext2D,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  x3: number,\n  y3: number,\n  x4: number,\n  y4: number,\n  color: string,\n): void => {\n  ctx.fillStyle = color;\n  ctx.beginPath();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.lineTo(x3, y3);\n  ctx.lineTo(x4, y4);\n  ctx.closePath();\n  ctx.fill();\n};\n\nexport const rumbleWidth = (\n  projectedRoadWidth: number,\n  lanes: number,\n): number => projectedRoadWidth / Math.max(6, 2 * lanes);\n\nexport const laneMarkerWidth = (\n  projectedRoadWidth: number,\n  lanes: number,\n): number => projectedRoadWidth / Math.max(32, 8 * lanes);\n\nexport const segment = (\n  ctx: CanvasRenderingContext2D,\n  width: number,\n  lanes: number,\n  x1: number,\n  y1: number,\n  w1: number,\n  x2: number,\n  y2: number,\n  w2: number,\n  fog: number,\n  color: SegmentColor,\n): void => {\n  const r1 = rumbleWidth(w1, lanes);\n  const r2 = rumbleWidth(w2, lanes);\n  const l1 = laneMarkerWidth(w1, lanes);\n  const l2 = laneMarkerWidth(w2, lanes);\n\n  ctx.fillStyle = color.grass;\n  ctx.fillRect(0, y2, width, y1 - y2);\n\n  polygon(\n    ctx,\n    x1 - w1 - r1,\n    y1,\n    x1 - w1,\n    y1,\n    x2 - w2,\n    y2,\n    x2 - w2 - r2,\n    y2,\n    color.rumble,\n  );\n  polygon(\n    ctx,\n    x1 + w1 + r1,\n    y1,\n    x1 + w1,\n    y1,\n    x2 + w2,\n    y2,\n    x2 + w2 + r2,\n    y2,\n    color.rumble,\n  );\n  polygon(ctx, x1 - w1, y1, x1 + w1, y1, x2 + w2, y2, x2 - w2, y2, color.road);\n\n  if (color.lane) {\n    const lanew1 = (w1 * 2) / lanes;\n    const lanew2 = (w2 * 2) / lanes;\n    let lanex1 = x1 - w1 + lanew1;\n    let lanex2 = x2 - w2 + lanew2;\n    for (let lane = 1; lane < lanes; lane++) {\n      polygon(\n        ctx,\n        lanex1 - l1 / 2,\n        y1,\n        lanex1 + l1 / 2,\n        y1,\n        lanex2 + l2 / 2,\n        y2,\n        lanex2 - l2 / 2,\n        y2,\n        color.lane,\n      );\n      lanex1 += lanew1;\n      lanex2 += lanew2;\n    }\n  }\n\n  fogLayer(ctx, 0, y1, width, y2 - y1, fog);\n};\n\nexport const background = (\n  ctx: CanvasRenderingContext2D,\n  bgImage: HTMLImageElement,\n  width: number,\n  height: number,\n  layer: BackgroundLayer,\n  rotation: number = 0,\n  offset: number = 0,\n): void => {\n  const imageW = layer.w / 2;\n  const imageH = layer.h;\n\n  const sourceX = layer.x + Math.floor(layer.w * rotation);\n  const sourceY = layer.y;\n  const sourceW = Math.min(imageW, layer.x + layer.w - sourceX);\n  const sourceH = imageH;\n\n  const destX = 0;\n  const destY = offset;\n  const destW = Math.floor(width * (sourceW / imageW));\n  const destH = height;\n\n  ctx.drawImage(\n    bgImage,\n    sourceX,\n    sourceY,\n    sourceW,\n    sourceH,\n    destX,\n    destY,\n    destW,\n    destH,\n  );\n  if (sourceW < imageW) {\n    ctx.drawImage(\n      bgImage,\n      layer.x,\n      sourceY,\n      imageW - sourceW,\n      sourceH,\n      destW - 1,\n      destY,\n      width - destW,\n      destH,\n    );\n  }\n};\n\nexport const sprite = (\n  ctx: CanvasRenderingContext2D,\n  width: number,\n  height: number,\n  _resolution: number,\n  roadWidth: number,\n  spriteSheet: HTMLImageElement,\n  spriteData: Sprite,\n  scale: number,\n  destX: number,\n  destY: number,\n  offsetX: number = 0,\n  offsetY: number = 0,\n  clipY: number = 0,\n): void => {\n  const destW =\n    ((spriteData.w * scale * width) / 2) * (SPRITE_SCALE * roadWidth);\n  const destH =\n    ((spriteData.h * scale * width) / 2) * (SPRITE_SCALE * roadWidth);\n\n  const finalX = destX + destW * offsetX;\n  const finalY = destY + destH * offsetY;\n\n  const clipH = clipY > 0 ? Math.max(0, finalY + destH - clipY) : 0;\n  if (clipH < destH) {\n    ctx.drawImage(\n      spriteSheet,\n      spriteData.x,\n      spriteData.y,\n      spriteData.w,\n      spriteData.h - (spriteData.h * clipH) / destH,\n      finalX,\n      finalY,\n      destW,\n      destH - clipH,\n    );\n  }\n};\n\nexport const player = (\n  ctx: CanvasRenderingContext2D,\n  width: number,\n  height: number,\n  resolution: number,\n  roadWidth: number,\n  spriteSheet: HTMLImageElement,\n  speedPercent: number,\n  scale: number,\n  destX: number,\n  destY: number,\n  steer: number,\n  updown: number,\n): void => {\n  const bounce =\n    1.5 *\n    Math.random() *\n    speedPercent *\n    resolution *\n    Util.randomChoice([-1, 1]);\n  let spriteData: Sprite;\n\n  if (steer < 0) {\n    spriteData = updown > 0 ? SPRITES.PLAYER_UPHILL_LEFT : SPRITES.PLAYER_LEFT;\n  } else if (steer > 0) {\n    spriteData =\n      updown > 0 ? SPRITES.PLAYER_UPHILL_RIGHT : SPRITES.PLAYER_RIGHT;\n  } else {\n    spriteData =\n      updown > 0 ? SPRITES.PLAYER_UPHILL_STRAIGHT : SPRITES.PLAYER_STRAIGHT;\n  }\n\n  sprite(\n    ctx,\n    width,\n    height,\n    resolution,\n    roadWidth,\n    spriteSheet,\n    spriteData,\n    scale,\n    destX,\n    destY + bounce,\n    -0.5,\n    -1,\n  );\n};\n\nexport const fogLayer = (\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  fog: number,\n  fogColor: string = COLORS.FOG,\n): void => {\n  if (fog < 1) {\n    ctx.globalAlpha = 1 - fog;\n    ctx.fillStyle = fogColor;\n    ctx.fillRect(x, y, width, height);\n    ctx.globalAlpha = 1;\n  }\n};\n\nexport const lightningFlash = (\n  ctx: CanvasRenderingContext2D,\n  width: number,\n  height: number,\n  intensity: number,\n): void => {\n  ctx.globalAlpha = intensity;\n  ctx.fillStyle = \"#ffffff\";\n  ctx.fillRect(0, 0, width, height);\n  ctx.globalAlpha = 1;\n};\n\nexport const renderParticles = (\n  ctx: CanvasRenderingContext2D,\n  particles: Array<{\n    x: number;\n    y: number;\n    life: number;\n    size: number;\n    sprite?: string;\n    vx: number;\n    vy: number;\n  }>,\n  cachedSprites: Map<string, { canvas: HTMLCanvasElement }>,\n): void => {\n  for (const p of particles) {\n    ctx.globalAlpha = p.life;\n    if (p.sprite && cachedSprites.has(p.sprite)) {\n      const cached = cachedSprites.get(p.sprite)!;\n      ctx.drawImage(\n        cached.canvas,\n        p.x - p.size,\n        p.y - p.size,\n        p.size * 2,\n        p.size * 2,\n      );\n    } else {\n      ctx.fillStyle = p.sprite?.includes(\"rain\")\n        ? \"rgba(150,180,220,0.6)\"\n        : \"#ffffff\";\n      const h = p.sprite?.includes(\"rain\") ? p.size * 4 : p.size;\n      ctx.fillRect(p.x, p.y, p.size, h);\n    }\n    ctx.globalAlpha = 1;\n  }\n};\n\nexport const renderTumbleweed = (\n  ctx: CanvasRenderingContext2D,\n  tumbleweed: { x: number; y: number; rotation: number; scale: number },\n  cachedSprite: { canvas: HTMLCanvasElement } | null,\n): void => {\n  if (!cachedSprite) return;\n\n  ctx.save();\n  ctx.translate(tumbleweed.x, tumbleweed.y);\n  ctx.rotate(tumbleweed.rotation);\n  const size = 80 * tumbleweed.scale;\n  ctx.drawImage(cachedSprite.canvas, -size / 2, -size / 2, size, size);\n  ctx.restore();\n};\n\nexport interface Viewport {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  playerIndex: number;\n}\n\nexport const renderViewport = (\n  ctx: CanvasRenderingContext2D,\n  viewport: Viewport,\n  renderFn: () => void,\n): void => {\n  ctx.save();\n  ctx.beginPath();\n  ctx.rect(viewport.x, viewport.y, viewport.width, viewport.height);\n  ctx.clip();\n\n  ctx.translate(viewport.x, viewport.y);\n\n  renderFn();\n\n  ctx.restore();\n};\n\nexport const drawSplitScreenDivider = (\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  height: number,\n  color: string = \"#000000\",\n  width: number = 4,\n): void => {\n  ctx.fillStyle = color;\n  ctx.fillRect(x - width / 2, y, width, height);\n};\n","import type { CachedSprite } from \"../../assets/svg-loader\";\nimport { SPRITE_SCALE, SPRITES } from \"../constants\";\n\nexport const svgSprite = (\n  ctx: CanvasRenderingContext2D,\n  cachedSprite: CachedSprite,\n  canvasWidth: number,\n  roadWidth: number,\n  scale: number,\n  destX: number,\n  destY: number,\n  offsetX: number = 0,\n  offsetY: number = 0,\n  clipY: number = 0,\n  spriteW: number = 80,\n  spriteH: number = 80,\n): void => {\n  const destW =\n    ((spriteW * scale * canvasWidth) / 2) * (SPRITE_SCALE * roadWidth);\n  const destH =\n    ((spriteH * scale * canvasWidth) / 2) * (SPRITE_SCALE * roadWidth);\n\n  const finalX = destX + destW * offsetX;\n  const finalY = destY + destH * offsetY;\n\n  const clipH = clipY > 0 ? Math.max(0, finalY + destH - clipY) : 0;\n  if (clipH < destH) {\n    const srcH = cachedSprite.height * (1 - clipH / destH);\n    ctx.drawImage(\n      cachedSprite.canvas,\n      0,\n      0,\n      cachedSprite.width,\n      srcH,\n      finalX,\n      finalY,\n      destW,\n      destH - clipH,\n    );\n  }\n};\n\nexport const svgPlayer = (\n  ctx: CanvasRenderingContext2D,\n  cachedSprite: CachedSprite,\n  canvasWidth: number,\n  _canvasHeight: number,\n  roadWidth: number,\n  _speedPercent: number,\n  scale: number,\n  destX: number,\n  destY: number,\n  _steer: number,\n  bounce: number,\n): void => {\n  const spriteW = SPRITES.PLAYER_STRAIGHT.w;\n  const spriteH = SPRITES.PLAYER_STRAIGHT.h;\n\n  const destW =\n    ((spriteW * scale * canvasWidth) / 2) * (SPRITE_SCALE * roadWidth);\n  const destH =\n    ((spriteH * scale * canvasWidth) / 2) * (SPRITE_SCALE * roadWidth);\n\n  const finalX = destX - destW / 2;\n  const finalY = destY - destH + bounce;\n\n  ctx.drawImage(cachedSprite.canvas, finalX, finalY, destW, destH);\n};\n\nexport const svgBackground = (\n  ctx: CanvasRenderingContext2D,\n  cachedSprite: CachedSprite,\n  canvasWidth: number,\n  canvasHeight: number,\n  rotation: number = 0,\n  yOffset: number = 0,\n): void => {\n  const spriteW = cachedSprite.width;\n  const spriteH = cachedSprite.height;\n\n  const sourceX = Math.floor(spriteW * rotation) % spriteW;\n  const sourceW = Math.min(spriteW / 2, spriteW - sourceX);\n\n  const destW = Math.floor(canvasWidth * (sourceW / (spriteW / 2)));\n  const destH = canvasHeight;\n\n  ctx.drawImage(\n    cachedSprite.canvas,\n    sourceX,\n    0,\n    sourceW,\n    spriteH,\n    0,\n    yOffset,\n    destW,\n    destH,\n  );\n\n  if (sourceW < spriteW / 2) {\n    const remainingW = spriteW / 2 - sourceW;\n    const remainingDestW = canvasWidth - destW;\n    ctx.drawImage(\n      cachedSprite.canvas,\n      0,\n      0,\n      remainingW,\n      spriteH,\n      destW - 1,\n      yOffset,\n      remainingDestW,\n      destH,\n    );\n  }\n};\n","export interface CachedSprite {\n  canvas: HTMLCanvasElement;\n  width: number;\n  height: number;\n  scale: number;\n}\n\nexport interface SpriteCache {\n  get(svgPath: string, scale: number): CachedSprite | null;\n  preload(svgPath: string, scales: number[]): Promise<void>;\n  clear(): void;\n}\n\nexport interface SpriteLoaderConfig {\n  basePath: string;\n  defaultScales: number[];\n}\n\nexport const SPRITE_SVG_MAP: Record<string, string> = {\n  PALM_TREE: \"palm-tree.svg\",\n  TREE1: \"tree-deciduous.svg\",\n  TREE2: \"tree-blossom.svg\",\n  DEAD_TREE1: \"dead-tree.svg\",\n  DEAD_TREE2: \"tree-twisting.svg\",\n  BUSH1: \"bush-fern.svg\",\n  BUSH2: \"bush-flowering.svg\",\n  CACTUS: \"cactus.svg\",\n  STUMP: \"stump.svg\",\n  COLUMN: \"column.svg\",\n  BOULDER1: \"rocks-flat.svg\",\n  BOULDER2: \"rocks-flat.svg\",\n  BOULDER3: \"dead-tree.svg\",\n  BILLBOARD01: \"billboard-liquidplanner.svg\",\n  BILLBOARD02: \"billboard-icecream.svg\",\n  BILLBOARD03: \"billboard-codeincomplete.svg\",\n  BILLBOARD04: \"billboard-rim.svg\",\n  BILLBOARD05: \"billboard-danke.svg\",\n  BILLBOARD06: \"billboard-liquidplanner.svg\",\n  BILLBOARD07: \"billboard-sega.svg\",\n  BILLBOARD08: \"billboard-snakes.svg\",\n  BILLBOARD09: \"billboard-redmond.svg\",\n  CAR01: \"car-red.svg\",\n  CAR02: \"car-brown.svg\",\n  CAR03: \"car-pink.svg\",\n  CAR04: \"car-blue.svg\",\n  SEMI: \"truck-semi.svg\",\n  TRUCK: \"truck-jeep.svg\",\n  PLAYER_STRAIGHT: \"player-car.svg\",\n  PLAYER_LEFT: \"player-car-left.svg\",\n  PLAYER_RIGHT: \"player-car-right.svg\",\n  PLAYER_UPHILL_STRAIGHT: \"player-car.svg\",\n  PLAYER_UPHILL_LEFT: \"player-car-left.svg\",\n  PLAYER_UPHILL_RIGHT: \"player-car-right.svg\",\n};\n\nconst DEFAULT_CONFIG: SpriteLoaderConfig = {\n  basePath: \"./sprites/\",\n  defaultScales: [0.25, 0.5, 1, 2],\n};\n\nclass SpriteCacheImpl implements SpriteCache {\n  private cache = new Map<string, Map<number, CachedSprite>>();\n  private config: SpriteLoaderConfig;\n  private svgCache = new Map<string, string>();\n\n  constructor(config: Partial<SpriteLoaderConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  async loadSVG(path: string): Promise<string> {\n    if (this.svgCache.has(path)) {\n      return this.svgCache.get(path)!;\n    }\n\n    const response = await fetch(path);\n    if (!response.ok) {\n      throw new Error(`Failed to load SVG: ${path}`);\n    }\n\n    const svgText = await response.text();\n    this.svgCache.set(path, svgText);\n    return svgText;\n  }\n\n  async renderSVGToCanvas(\n    svgText: string,\n    scale: number,\n  ): Promise<CachedSprite> {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      const svgBlob = new Blob([svgText], {\n        type: \"image/svg+xml;charset=utf-8\",\n      });\n      const url = URL.createObjectURL(svgBlob);\n\n      img.onload = () => {\n        const width = Math.ceil(img.naturalWidth * scale);\n        const height = Math.ceil(img.naturalHeight * scale);\n\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = width;\n        canvas.height = height;\n\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) {\n          URL.revokeObjectURL(url);\n          reject(new Error(\"Failed to get canvas context\"));\n          return;\n        }\n\n        ctx.drawImage(img, 0, 0, width, height);\n        URL.revokeObjectURL(url);\n\n        resolve({ canvas, width, height, scale });\n      };\n\n      img.onerror = () => {\n        URL.revokeObjectURL(url);\n        reject(new Error(`Failed to render SVG at scale ${scale}`));\n      };\n\n      img.src = url;\n    });\n  }\n\n  async preload(svgPath: string, scales: number[]): Promise<void> {\n    const fullPath = svgPath.startsWith(\"/\")\n      ? svgPath\n      : this.config.basePath + svgPath;\n    const svgText = await this.loadSVG(fullPath);\n\n    if (!this.cache.has(svgPath)) {\n      this.cache.set(svgPath, new Map());\n    }\n\n    const scaleMap = this.cache.get(svgPath)!;\n\n    await Promise.all(\n      scales.map(async (scale) => {\n        if (!scaleMap.has(scale)) {\n          const cached = await this.renderSVGToCanvas(svgText, scale);\n          scaleMap.set(scale, cached);\n        }\n      }),\n    );\n  }\n\n  get(svgPath: string, scale: number): CachedSprite | null {\n    const scaleMap = this.cache.get(svgPath);\n    if (!scaleMap) return null;\n\n    const exactMatch = scaleMap.get(scale);\n    if (exactMatch) return exactMatch;\n\n    let closestScale = 0;\n    let closestDiff = Infinity;\n\n    for (const cachedScale of scaleMap.keys()) {\n      const diff = Math.abs(cachedScale - scale);\n      if (diff < closestDiff && cachedScale >= scale) {\n        closestDiff = diff;\n        closestScale = cachedScale;\n      }\n    }\n\n    if (closestScale > 0) {\n      return scaleMap.get(closestScale)!;\n    }\n\n    for (const cachedScale of scaleMap.keys()) {\n      const diff = Math.abs(cachedScale - scale);\n      if (diff < closestDiff) {\n        closestDiff = diff;\n        closestScale = cachedScale;\n      }\n    }\n\n    return scaleMap.get(closestScale) ?? null;\n  }\n\n  clear(): void {\n    this.cache.clear();\n  }\n}\n\nexport const createSpriteCache = (\n  config?: Partial<SpriteLoaderConfig>,\n): SpriteCache => {\n  return new SpriteCacheImpl(config);\n};\n\nexport const globalSpriteCache = createSpriteCache();\n\nexport const getSpriteByName = (\n  name: string,\n  scale: number,\n): CachedSprite | null => {\n  const svgPath = SPRITE_SVG_MAP[name];\n  if (!svgPath) return null;\n  return globalSpriteCache.get(svgPath, scale);\n};\n\nexport const preloadGameSprites = async (): Promise<void> => {\n  const baseScales = [0.5, 1, 1.5, 2, 3];\n  const largeScales = [0.5, 1, 1.5, 2, 3, 4];\n  const particleScales = [0.5, 1, 1.5, 2];\n\n  const sprites = [\n    { path: \"player-car.svg\", scales: largeScales },\n    { path: \"player-car-left.svg\", scales: largeScales },\n    { path: \"player-car-right.svg\", scales: largeScales },\n    { path: \"car-jump.svg\", scales: largeScales },\n    { path: \"background-level-1.svg\", scales: [1, 2] },\n    { path: \"background.svg\", scales: [1, 2] },\n    { path: \"main-menu.svg\", scales: [1.5, 2] },\n    { path: \"music-selection.svg\", scales: [1.5, 2] },\n    { path: \"track-builder.svg\", scales: [1, 1.5, 2] },\n    { path: \"palm-tree.svg\", scales: largeScales },\n    { path: \"tree-deciduous.svg\", scales: largeScales },\n    { path: \"tree-blossom.svg\", scales: largeScales },\n    { path: \"tree-twisting.svg\", scales: largeScales },\n    { path: \"dead-tree.svg\", scales: largeScales },\n    { path: \"bush-fern.svg\", scales: baseScales },\n    { path: \"bush-flowering.svg\", scales: baseScales },\n    { path: \"cactus.svg\", scales: baseScales },\n    { path: \"stump.svg\", scales: baseScales },\n    { path: \"column.svg\", scales: largeScales },\n    { path: \"rocks-flat.svg\", scales: baseScales },\n    { path: \"billboard-snakes.svg\", scales: largeScales },\n    { path: \"billboard-redmond.svg\", scales: largeScales },\n    { path: \"billboard-liquidplanner.svg\", scales: largeScales },\n    { path: \"billboard-sega.svg\", scales: largeScales },\n    { path: \"billboard-danke.svg\", scales: largeScales },\n    { path: \"billboard-rim.svg\", scales: baseScales },\n    { path: \"billboard-codeincomplete.svg\", scales: baseScales },\n    { path: \"billboard-icecream.svg\", scales: baseScales },\n    { path: \"car-red.svg\", scales: largeScales },\n    { path: \"car-pink.svg\", scales: largeScales },\n    { path: \"car-blue.svg\", scales: largeScales },\n    { path: \"car-brown.svg\", scales: largeScales },\n    { path: \"truck-semi.svg\", scales: largeScales },\n    { path: \"truck-jeep.svg\", scales: largeScales },\n    { path: \"snowflake.svg\", scales: particleScales },\n    { path: \"raindrop.svg\", scales: particleScales },\n    { path: \"lightning.svg\", scales: baseScales },\n    { path: \"tumbleweed.svg\", scales: baseScales },\n    { path: \"traffic-cone.svg\", scales: baseScales },\n    { path: \"barrier.svg\", scales: baseScales },\n    { path: \"oil-slick.svg\", scales: baseScales },\n    { path: \"water-splash.svg\", scales: particleScales },\n    { path: \"turbo-zone.svg\", scales: baseScales },\n    { path: \"laser-beam.svg\", scales: baseScales },\n    { path: \"theme-night.svg\", scales: [0.5, 1] },\n    { path: \"theme-fog.svg\", scales: [0.5, 1] },\n    { path: \"theme-snow.svg\", scales: [0.5, 1] },\n    { path: \"theme-storm.svg\", scales: [0.5, 1] },\n    { path: \"theme-desert.svg\", scales: [0.5, 1] },\n    { path: \"theme-future.svg\", scales: [0.5, 1] },\n    { path: \"theme-marsh.svg\", scales: [0.5, 1] },\n    { path: \"theme-mountains.svg\", scales: [0.5, 1] },\n    { path: \"theme-lakes.svg\", scales: [0.5, 1] },\n    { path: \"theme-country.svg\", scales: [0.5, 1] },\n    { path: \"theme-city.svg\", scales: [0.5, 1] },\n    { path: \"theme-roadworks.svg\", scales: [0.5, 1] },\n    { path: \"theme-windy.svg\", scales: [0.5, 1] },\n  ];\n\n  await Promise.all(\n    sprites.map((s) => globalSpriteCache.preload(s.path, s.scales)),\n  );\n};\n\nexport const drawCachedSprite = (\n  ctx: CanvasRenderingContext2D,\n  cached: CachedSprite,\n  x: number,\n  y: number,\n  targetWidth: number,\n  targetHeight: number,\n): void => {\n  ctx.drawImage(cached.canvas, x, y, targetWidth, targetHeight);\n};\n\nexport const drawCachedSpriteCentered = (\n  ctx: CanvasRenderingContext2D,\n  cached: CachedSprite,\n  centerX: number,\n  centerY: number,\n  targetWidth: number,\n  targetHeight: number,\n): void => {\n  const x = centerX - targetWidth / 2;\n  const y = centerY - targetHeight / 2;\n  ctx.drawImage(cached.canvas, x, y, targetWidth, targetHeight);\n};\n","export interface ModPlayerConfig {\n  volume: number;\n  loop: boolean;\n}\n\nconst DEFAULT_CONFIG: ModPlayerConfig = {\n  volume: 0.5,\n  loop: true,\n};\n\nclass ModPlayerImpl {\n  private audioContext: AudioContext | null = null;\n  private gainNode: GainNode | null = null;\n  private audioBuffer: AudioBuffer | null = null;\n  private sourceNode: AudioBufferSourceNode | null = null;\n  private currentUrl: string | null = null;\n  private loaded = false;\n  private playing = false;\n  private config: ModPlayerConfig;\n  private volume: number;\n\n  constructor(config: Partial<ModPlayerConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.volume = this.config.volume;\n  }\n\n  private getAudioContext(): AudioContext {\n    if (!this.audioContext) {\n      this.audioContext = new AudioContext();\n      this.gainNode = this.audioContext.createGain();\n      this.gainNode.connect(this.audioContext.destination);\n      this.gainNode.gain.value = this.volume;\n    }\n    return this.audioContext;\n  }\n\n  async load(url: string): Promise<void> {\n    if (this.currentUrl === url && this.audioBuffer) {\n      return;\n    }\n\n    const response = await fetch(url);\n    const arrayBuffer = await response.arrayBuffer();\n\n    const ctx = this.getAudioContext();\n    this.audioBuffer = await ctx.decodeAudioData(arrayBuffer);\n    this.currentUrl = url;\n    this.loaded = true;\n  }\n\n  async play(): Promise<void> {\n    if (!this.audioBuffer) return;\n\n    const ctx = this.getAudioContext();\n\n    if (ctx.state === \"suspended\") {\n      await ctx.resume();\n    }\n\n    if (this.sourceNode) {\n      this.sourceNode.stop();\n      this.sourceNode.disconnect();\n    }\n\n    this.sourceNode = ctx.createBufferSource();\n    this.sourceNode.buffer = this.audioBuffer;\n    this.sourceNode.loop = this.config.loop;\n    this.sourceNode.connect(this.gainNode!);\n    this.sourceNode.start(0);\n    this.playing = true;\n\n    this.sourceNode.onended = () => {\n      this.playing = false;\n    };\n  }\n\n  pause(): void {\n    if (this.sourceNode && this.playing) {\n      this.sourceNode.stop();\n      this.sourceNode.disconnect();\n      this.sourceNode = null;\n      this.playing = false;\n    }\n  }\n\n  stop(): void {\n    if (this.sourceNode) {\n      this.sourceNode.stop();\n      this.sourceNode.disconnect();\n      this.sourceNode = null;\n    }\n    this.playing = false;\n  }\n\n  setVolume(volume: number): void {\n    this.volume = Math.max(0, Math.min(1, volume));\n    if (this.gainNode) {\n      this.gainNode.gain.value = this.volume;\n    }\n  }\n\n  getVolume(): number {\n    return this.volume;\n  }\n\n  isPlaying(): boolean {\n    return this.playing;\n  }\n\n  isLoaded(): boolean {\n    return this.loaded;\n  }\n}\n\nexport const globalModPlayer = new ModPlayerImpl();\n\nexport const loadAndPlayTrack = async (file: string): Promise<void> => {\n  stopGameMusic();\n  await globalModPlayer.load(file);\n  await globalModPlayer.play();\n};\n\nexport const playGameMusic = async (): Promise<void> => {\n  await globalModPlayer.play();\n};\n\nexport const pauseGameMusic = (): void => {\n  globalModPlayer.pause();\n};\n\nexport const stopGameMusic = (): void => {\n  globalModPlayer.stop();\n};\n\nexport const setMusicVolume = (volume: number): void => {\n  globalModPlayer.setVolume(volume);\n};\n\n// ============================================================================\n// Sound Effects System\n// ============================================================================\n\nlet soundEnabled = true;\nlet engineAudioContext: AudioContext | null = null;\nlet engineOscillator: OscillatorNode | null = null;\nlet engineGainNode: GainNode | null = null;\nlet noiseBuffer: AudioBuffer | null = null;\nlet noiseNode: AudioBufferSourceNode | null = null;\nlet noiseGainNode: GainNode | null = null;\n\nexport const isSoundEnabled = (): boolean => soundEnabled;\n\nexport const toggleSound = (): boolean => {\n  soundEnabled = !soundEnabled;\n\n  if (!soundEnabled) {\n    // Mute everything\n    stopGameMusic();\n    stopEngineSound();\n  } else {\n    // Resume music if it was playing\n    const volume = globalModPlayer.getVolume();\n    if (volume > 0) {\n      globalModPlayer.setVolume(volume);\n    }\n  }\n\n  return soundEnabled;\n};\n\nexport const setSoundEnabled = (enabled: boolean): void => {\n  if (soundEnabled !== enabled) {\n    toggleSound();\n  }\n};\n\n// ============================================================================\n// Procedural Engine Sound\n// ============================================================================\n\nconst createEngineAudioContext = (): AudioContext => {\n  if (!engineAudioContext) {\n    engineAudioContext = new AudioContext();\n  }\n  return engineAudioContext;\n};\n\nconst createEngineNoiseBuffer = (ctx: AudioContext): AudioBuffer => {\n  const bufferSize = ctx.sampleRate * 2; // 2 seconds\n  const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n\n  for (let i = 0; i < bufferSize; i++) {\n    data[i] = Math.random() * 2 - 1;\n  }\n\n  return buffer;\n};\n\nexport const startEngineSound = (): void => {\n  if (!soundEnabled) return;\n\n  try {\n    const ctx = createEngineAudioContext();\n\n    if (ctx.state === \"suspended\") {\n      ctx.resume();\n    }\n\n    // Stop existing engine sound\n    stopEngineSound();\n\n    // Create oscillator for engine base tone\n    engineOscillator = ctx.createOscillator();\n    engineOscillator.type = \"sawtooth\";\n    engineOscillator.frequency.value = 50; // Idle frequency\n\n    engineGainNode = ctx.createGain();\n    engineGainNode.gain.value = 0.06; // Reduced by 40%\n\n    // Create noise for engine texture\n    if (!noiseBuffer) {\n      noiseBuffer = createEngineNoiseBuffer(ctx);\n    }\n\n    noiseNode = ctx.createBufferSource();\n    noiseNode.buffer = noiseBuffer;\n    noiseNode.loop = true;\n\n    // Filter the noise to make it sound more engine-like\n    const noiseFilter = ctx.createBiquadFilter();\n    noiseFilter.type = \"lowpass\";\n    noiseFilter.frequency.value = 200;\n\n    noiseGainNode = ctx.createGain();\n    noiseGainNode.gain.value = 0.03; // Reduced by 40%\n\n    // Connect nodes\n    engineOscillator.connect(engineGainNode);\n    engineGainNode.connect(ctx.destination);\n\n    noiseNode.connect(noiseFilter);\n    noiseFilter.connect(noiseGainNode);\n    noiseGainNode.connect(ctx.destination);\n\n    // Start\n    engineOscillator.start();\n    noiseNode.start();\n  } catch (err) {\n    console.error(\"Failed to start engine sound:\", err);\n  }\n};\n\nexport const stopEngineSound = (): void => {\n  try {\n    if (engineOscillator) {\n      engineOscillator.stop();\n      engineOscillator.disconnect();\n      engineOscillator = null;\n    }\n\n    if (noiseNode) {\n      noiseNode.stop();\n      noiseNode.disconnect();\n      noiseNode = null;\n    }\n\n    if (engineGainNode) {\n      engineGainNode.disconnect();\n      engineGainNode = null;\n    }\n\n    if (noiseGainNode) {\n      noiseGainNode.disconnect();\n      noiseGainNode = null;\n    }\n  } catch (err) {\n    // Ignore errors when stopping\n  }\n};\n\nexport const updateEngineSound = (speedPercent: number): void => {\n  if (!soundEnabled || !engineOscillator || !engineGainNode) return;\n\n  try {\n    const ctx = engineAudioContext;\n    if (!ctx) return;\n\n    // Map speed to frequency (50Hz idle to 200Hz max)\n    const baseFreq = 50 + speedPercent * 150;\n    engineOscillator.frequency.setValueAtTime(baseFreq, ctx.currentTime);\n\n    // Map speed to volume (reduced by 40%)\n    const volume = 0.03 + speedPercent * 0.09;\n    engineGainNode.gain.setValueAtTime(volume, ctx.currentTime);\n\n    // Update noise volume (reduced by 40%)\n    if (noiseGainNode) {\n      const noiseVol = 0.012 + speedPercent * 0.048;\n      noiseGainNode.gain.setValueAtTime(noiseVol, ctx.currentTime);\n    }\n  } catch (err) {\n    // Ignore update errors\n  }\n};\n\n// ============================================================================\n// Collision Sound\n// ============================================================================\n\nexport const playCollisionSound = (intensity: number = 1.0): void => {\n  if (!soundEnabled) return;\n\n  try {\n    const ctx = createEngineAudioContext();\n\n    if (ctx.state === \"suspended\") {\n      ctx.resume();\n    }\n\n    // Create noise burst\n    const bufferSize = ctx.sampleRate * 0.3; // 300ms\n    const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);\n    const data = buffer.getChannelData(0);\n\n    for (let i = 0; i < bufferSize; i++) {\n      const decay = 1 - i / bufferSize;\n      data[i] = (Math.random() * 2 - 1) * decay * intensity;\n    }\n\n    const source = ctx.createBufferSource();\n    source.buffer = buffer;\n\n    // Filter to make it sound like a crash\n    const filter = ctx.createBiquadFilter();\n    filter.type = \"lowpass\";\n    filter.frequency.value = 800;\n\n    const gain = ctx.createGain();\n    gain.gain.value = Math.min(0.5, 0.2 * intensity);\n\n    source.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n\n    source.start();\n\n    // Auto-cleanup\n    source.onended = () => {\n      source.disconnect();\n      filter.disconnect();\n      gain.disconnect();\n    };\n  } catch (err) {\n    console.error(\"Failed to play collision sound:\", err);\n  }\n};\n","import type { WorldState } from \"../../engine/world\";\n\nexport type GameScreen =\n  | \"main-menu\"\n  | \"music-select\"\n  | \"recs\"\n  | \"racing\"\n  | \"results\";\n\nexport type GameMode = \"time\" | \"race\";\n\nexport interface TimeChallengeState {\n  screen: GameScreen;\n  playerName: string;\n  selectedTrack: number;\n  gameMode: GameMode;\n  timeLimit: number;\n  currentTime: number;\n  score: number;\n  lap: number;\n  totalLaps: number;\n  checkpointsPassed: number;\n  totalCheckpoints: number;\n  lastCheckpointSegment: number;\n  isPaused: boolean;\n  isGameOver: boolean;\n  bestTime: number | null;\n  bestScore: number | null;\n  timeBonusFlash: number;\n}\n\nexport const DEFAULT_TIME_LIMIT = 45;\nexport const DEFAULT_LAPS = 3;\nexport const CHECKPOINT_TIME_BONUS = 3;\nexport const LAP_TIME_BONUS = 20;\nexport const CHECKPOINT_SCORE_BONUS = 25;\nexport const LAP_SCORE_BONUS = 100;\nexport const CHECKPOINTS_PER_LAP = 4;\nexport const BASE_TIME_PER_SEGMENT = 0.15;\nexport const MIN_TIME_LIMIT = 30;\n\nexport const calculateTimeLimit = (\n  trackLength: number,\n  segmentLength: number,\n): number => {\n  const totalSegments = Math.floor(trackLength / segmentLength);\n  const calculatedTime = Math.floor(totalSegments * BASE_TIME_PER_SEGMENT);\n  return Math.max(MIN_TIME_LIMIT, calculatedTime);\n};\n\nexport const createTimeChallengeState = (\n  trackLength: number = 0,\n  segmentLength: number = 200,\n): TimeChallengeState => {\n  const timeLimit =\n    trackLength > 0\n      ? calculateTimeLimit(trackLength, segmentLength)\n      : DEFAULT_TIME_LIMIT;\n\n  return {\n    screen: \"main-menu\",\n    playerName: \"PLAYER 1\",\n    selectedTrack: 0,\n    gameMode: \"time\",\n    timeLimit,\n    currentTime: timeLimit,\n    score: 0,\n    lap: 1,\n    totalLaps: DEFAULT_LAPS,\n    checkpointsPassed: 0,\n    totalCheckpoints: CHECKPOINTS_PER_LAP,\n    lastCheckpointSegment: -1,\n    isPaused: false,\n    isGameOver: false,\n    bestTime: null,\n    bestScore: null,\n    timeBonusFlash: 0,\n  };\n};\n\nexport const updateTimer = (\n  state: TimeChallengeState,\n  dt: number,\n): TimeChallengeState => {\n  if (state.isPaused || state.isGameOver || state.screen !== \"racing\") {\n    return state;\n  }\n\n  const newFlash = Math.max(0, state.timeBonusFlash - dt);\n\n  if (state.gameMode === \"race\") {\n    // Race mode: count up, no time limit\n    return {\n      ...state,\n      currentTime: state.currentTime + dt,\n      timeBonusFlash: newFlash,\n    };\n  }\n\n  // Time mode: count down with limit\n  const newTime = state.currentTime - dt;\n\n  if (newTime <= 0) {\n    return {\n      ...state,\n      currentTime: 0,\n      isGameOver: true,\n      screen: \"results\",\n      timeBonusFlash: 0,\n    };\n  }\n\n  return {\n    ...state,\n    currentTime: newTime,\n    timeBonusFlash: newFlash,\n  };\n};\n\nexport const checkCheckpoint = (\n  state: TimeChallengeState,\n  playerPosition: number,\n  trackLength: number,\n  segmentLength: number,\n): { state: TimeChallengeState; bonusAwarded: number } => {\n  if (state.isPaused || state.isGameOver) {\n    return { state, bonusAwarded: 0 };\n  }\n\n  const currentSegment = Math.floor(playerPosition / segmentLength);\n  const totalSegments = Math.floor(trackLength / segmentLength);\n  const segmentsPerCheckpoint = Math.floor(\n    totalSegments / (CHECKPOINTS_PER_LAP + 1),\n  );\n\n  const currentCheckpointIndex = Math.floor(\n    currentSegment / segmentsPerCheckpoint,\n  );\n\n  if (\n    currentCheckpointIndex > state.lastCheckpointSegment &&\n    currentCheckpointIndex <= CHECKPOINTS_PER_LAP\n  ) {\n    // No time bonus in race mode\n    const bonus = state.gameMode === \"race\" ? 0 : CHECKPOINT_TIME_BONUS;\n    return {\n      state: {\n        ...state,\n        currentTime: state.currentTime + bonus,\n        score: state.score + CHECKPOINT_SCORE_BONUS,\n        checkpointsPassed: currentCheckpointIndex,\n        lastCheckpointSegment: currentCheckpointIndex,\n        timeBonusFlash: state.gameMode === \"race\" ? 0 : 1.5,\n      },\n      bonusAwarded: bonus,\n    };\n  }\n\n  return { state, bonusAwarded: 0 };\n};\n\nexport const completeLap = (\n  state: TimeChallengeState,\n  world: WorldState,\n): TimeChallengeState => {\n  const newLap = state.lap + 1;\n\n  if (newLap > state.totalLaps) {\n    // Race complete\n    if (state.gameMode === \"race\") {\n      // Race mode: lower time is better\n      const isNewBest =\n        state.bestTime === null || world.currentLapTime < state.bestTime;\n\n      return {\n        ...state,\n        isGameOver: true,\n        screen: \"results\",\n        score: state.score,\n        bestScore: state.bestScore,\n        bestTime: isNewBest ? world.currentLapTime : state.bestTime,\n        timeBonusFlash: 0,\n      };\n    }\n\n    // Time mode: higher remaining time is better\n    const finalScore =\n      state.score + Math.floor(state.currentTime * 50) + LAP_SCORE_BONUS;\n    const isNewBest = state.bestScore === null || finalScore > state.bestScore;\n\n    return {\n      ...state,\n      isGameOver: true,\n      screen: \"results\",\n      score: finalScore,\n      bestScore: isNewBest ? finalScore : state.bestScore,\n      bestTime: isNewBest ? world.currentLapTime : state.bestTime,\n      timeBonusFlash: 0,\n    };\n  }\n\n  // Lap complete but race continues\n  if (state.gameMode === \"race\") {\n    return {\n      ...state,\n      lap: newLap,\n      checkpointsPassed: 0,\n      lastCheckpointSegment: 0,\n      timeBonusFlash: 2,\n    };\n  }\n\n  // Time mode: add time bonus\n  return {\n    ...state,\n    lap: newLap,\n    currentTime: state.currentTime + LAP_TIME_BONUS,\n    score: state.score + LAP_SCORE_BONUS,\n    checkpointsPassed: 0,\n    lastCheckpointSegment: 0,\n    timeBonusFlash: 2,\n  };\n};\n\nexport const startRace = (state: TimeChallengeState): TimeChallengeState => ({\n  ...state,\n  screen: \"racing\",\n  currentTime: state.gameMode === \"race\" ? 0 : state.timeLimit,\n  score: 0,\n  lap: 1,\n  checkpointsPassed: 0,\n  lastCheckpointSegment: 0,\n  isPaused: false,\n  isGameOver: false,\n  timeBonusFlash: 0,\n});\n\nexport const pauseGame = (state: TimeChallengeState): TimeChallengeState => ({\n  ...state,\n  isPaused: true,\n});\n\nexport const resumeGame = (state: TimeChallengeState): TimeChallengeState => ({\n  ...state,\n  isPaused: false,\n});\n\nexport const returnToMenu = (\n  state: TimeChallengeState,\n): TimeChallengeState => ({\n  ...createTimeChallengeState(),\n  bestTime: state.bestTime,\n  bestScore: state.bestScore,\n});\n\nexport const setPlayerName = (\n  state: TimeChallengeState,\n  name: string,\n): TimeChallengeState => ({\n  ...state,\n  playerName: name.slice(0, 10).toUpperCase(),\n});\n\nexport const formatTimeDisplay = (seconds: number): string => {\n  const mins = Math.floor(seconds / 60);\n  const secs = Math.floor(seconds % 60);\n  const tenths = Math.floor((seconds % 1) * 10);\n  return `${mins}:${secs.toString().padStart(2, \"0\")}.${tenths}`;\n};\n\nexport const formatScore = (score: number): string => {\n  return score.toString().padStart(6, \"0\");\n};\n\nexport const toggleGameMode = (\n  state: TimeChallengeState,\n): TimeChallengeState => ({\n  ...state,\n  gameMode: state.gameMode === \"time\" ? \"race\" : \"time\",\n});\n","import type {\n  PlayerState,\n  PlayerRaceState,\n  RaceState,\n} from \"../../engine/types\";\nimport type { WorldState } from \"../../engine/world\";\n\nexport type GameScreen =\n  | \"main-menu\"\n  | \"music-select\"\n  | \"recs\"\n  | \"racing\"\n  | \"race-results\";\n\nexport interface MultiplayerRaceState {\n  screen: GameScreen;\n  isPaused: boolean;\n  isGameOver: boolean;\n  raceState: RaceState;\n  playerCount: number;\n  totalLaps: number;\n}\n\nexport const DEFAULT_LAPS = 3;\nexport const RACE_START_COUNTDOWN = 3;\n\nexport const createPlayerRaceState = (playerId: number): PlayerRaceState => ({\n  playerId,\n  position: 0,\n  lap: 1,\n  lastLapTime: null,\n  finished: false,\n  finishTime: null,\n  rank: 0,\n});\n\nexport const createRaceState = (playerCount: number): RaceState => ({\n  playerStates: Array.from({ length: playerCount }, (_, i) =>\n    createPlayerRaceState(i),\n  ),\n  winner: null,\n  isPaused: false,\n  countdown: RACE_START_COUNTDOWN,\n  countdownTimer: 0,\n});\n\nexport const createMultiplayerRaceState = (\n  playerCount: number = 1,\n): MultiplayerRaceState => ({\n  screen: \"main-menu\",\n  isPaused: false,\n  isGameOver: false,\n  raceState: createRaceState(playerCount),\n  playerCount,\n  totalLaps: DEFAULT_LAPS,\n});\n\nexport const updateRaceCountdown = (\n  state: MultiplayerRaceState,\n  dt: number,\n): MultiplayerRaceState => {\n  if (state.screen !== \"racing\" || state.isPaused) {\n    return state;\n  }\n\n  const raceState = state.raceState;\n  if (raceState.countdown > 0) {\n    raceState.countdownTimer += dt;\n    if (raceState.countdownTimer >= 1) {\n      raceState.countdown--;\n      raceState.countdownTimer = 0;\n    }\n    return { ...state };\n  }\n\n  return state;\n};\n\nexport const checkLapComplete = (\n  state: MultiplayerRaceState,\n  playerIndex: number,\n  world: WorldState,\n): MultiplayerRaceState => {\n  if (state.screen !== \"racing\" || state.isPaused || state.isGameOver) {\n    return state;\n  }\n\n  const playerState = state.raceState.playerStates[playerIndex];\n  if (!playerState || playerState.finished) {\n    return state;\n  }\n\n  const player = world.players[playerIndex];\n  if (!player) return state;\n\n  const prevPosition = playerState.position;\n  playerState.position = player.position;\n\n  if (\n    prevPosition > world.trackLength * 0.8 &&\n    player.position < world.player.z\n  ) {\n    playerState.lap++;\n    playerState.lastLapTime = world.currentLapTime;\n\n    if (playerState.lap > state.totalLaps) {\n      playerState.finished = true;\n      playerState.finishTime = Date.now();\n\n      const finishedPlayers = state.raceState.playerStates.filter(\n        (p) => p.finished,\n      ).length;\n      playerState.rank = finishedPlayers;\n\n      if (state.raceState.winner === null) {\n        state.raceState.winner = playerIndex;\n      }\n\n      const allFinished = state.raceState.playerStates.every((p) => p.finished);\n      if (allFinished) {\n        state.isGameOver = true;\n        state.screen = \"race-results\";\n      }\n    }\n  }\n\n  return { ...state };\n};\n\nexport const checkRaceComplete = (\n  state: MultiplayerRaceState,\n): { complete: boolean; winner: number | null } => {\n  if (state.raceState.winner !== null) {\n    const allFinished = state.raceState.playerStates.every((p) => p.finished);\n    return { complete: allFinished, winner: state.raceState.winner };\n  }\n  return { complete: false, winner: null };\n};\n\nexport const getPlayerRankings = (\n  state: MultiplayerRaceState,\n  world: WorldState,\n): Array<{ playerId: number; rank: number; lap: number; position: number }> => {\n  const players = state.raceState.playerStates.map((ps, idx) => {\n    const player = world.players[idx];\n    const totalProgress =\n      (ps.lap - 1) * world.trackLength + (player?.position ?? 0);\n    return {\n      playerId: idx,\n      rank: ps.rank,\n      lap: ps.lap,\n      position: player?.position ?? 0,\n      totalProgress,\n      finished: ps.finished,\n      finishTime: ps.finishTime,\n    };\n  });\n\n  players.sort((a, b) => {\n    if (a.finished && b.finished) {\n      return (a.finishTime ?? 0) - (b.finishTime ?? 0);\n    }\n    if (a.finished) return -1;\n    if (b.finished) return 1;\n    return b.totalProgress - a.totalProgress;\n  });\n\n  return players.map((p, idx) => ({\n    playerId: p.playerId,\n    rank: p.finished ? p.rank : idx + 1,\n    lap: p.lap,\n    position: p.position,\n  }));\n};\n\nexport const startRace = (\n  state: MultiplayerRaceState,\n  playerCount: number = 1,\n): MultiplayerRaceState => ({\n  ...state,\n  screen: \"racing\",\n  isPaused: false,\n  isGameOver: false,\n  raceState: createRaceState(playerCount),\n  playerCount,\n});\n\nexport const pauseRace = (\n  state: MultiplayerRaceState,\n): MultiplayerRaceState => ({\n  ...state,\n  isPaused: true,\n  raceState: { ...state.raceState, isPaused: true },\n});\n\nexport const resumeRace = (\n  state: MultiplayerRaceState,\n): MultiplayerRaceState => ({\n  ...state,\n  isPaused: false,\n  raceState: { ...state.raceState, isPaused: false },\n});\n\nexport const returnToMenu = (\n  state: MultiplayerRaceState,\n): MultiplayerRaceState => ({\n  ...createMultiplayerRaceState(state.playerCount),\n});\n\nexport const isRaceActive = (state: MultiplayerRaceState): boolean => {\n  return state.screen === \"racing\" && !state.isPaused && !state.isGameOver;\n};\n\nexport const isCountdownActive = (state: MultiplayerRaceState): boolean => {\n  return state.raceState.countdown > 0;\n};\n\nexport const getCountdownDisplay = (state: MultiplayerRaceState): string => {\n  const count = state.raceState.countdown;\n  return count > 0 ? count.toString() : \"GO!\";\n};\n","import type { InputMapping, InputState } from \"./types\";\nimport { KEY } from \"./constants\";\n\nexport const DEFAULT_P1_INPUT: InputMapping = {\n  left: [KEY.A],\n  right: [KEY.D],\n  faster: [KEY.W],\n  slower: [KEY.S],\n};\n\nexport const DEFAULT_P2_INPUT: InputMapping = {\n  left: [KEY.LEFT],\n  right: [KEY.RIGHT],\n  faster: [KEY.UP],\n  slower: [KEY.DOWN],\n};\n\nexport const DEFAULT_PLAYER_CONFIGS = [\n  {\n    id: 0,\n    name: \"PLAYER 1\",\n    inputMapping: DEFAULT_P1_INPUT,\n    color: \"#00ff88\",\n    spriteColor: \"#00ff88\",\n  },\n  {\n    id: 1,\n    name: \"PLAYER 2\",\n    inputMapping: DEFAULT_P2_INPUT,\n    color: \"#ff4444\",\n    spriteColor: \"#ff4444\",\n  },\n];\n\nexport const createDefaultInput = (): InputState => ({\n  left: false,\n  right: false,\n  faster: false,\n  slower: false,\n});\n\nexport const createInputArray = (playerCount: number): InputState[] => {\n  return Array(playerCount).fill(null).map(createDefaultInput);\n};\n\nexport class InputManager {\n  private playerConfigs: InputMapping[];\n\n  constructor(playerCount: number = 1) {\n    this.playerConfigs = [\n      DEFAULT_P1_INPUT,\n      ...(playerCount > 1 ? [DEFAULT_P2_INPUT] : []),\n    ];\n  }\n\n  setPlayerConfig(playerIndex: number, config: InputMapping): void {\n    if (playerIndex >= 0 && playerIndex < this.playerConfigs.length) {\n      this.playerConfigs[playerIndex] = config;\n    }\n  }\n\n  getPlayerConfig(playerIndex: number): InputMapping | null {\n    return this.playerConfigs[playerIndex] ?? null;\n  }\n\n  getPlayerForKey(keyCode: number): number {\n    for (let i = 0; i < this.playerConfigs.length; i++) {\n      const config = this.playerConfigs[i];\n      if (!config) continue;\n\n      if (\n        config.left.includes(keyCode) ||\n        config.right.includes(keyCode) ||\n        config.faster.includes(keyCode) ||\n        config.slower.includes(keyCode)\n      ) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  handleKeyDown(inputs: InputState[], keyCode: number): void {\n    for (let i = 0; i < this.playerConfigs.length; i++) {\n      const config = this.playerConfigs[i];\n      const input = inputs[i];\n      if (!config || !input) continue;\n\n      if (config.left.includes(keyCode)) input.left = true;\n      if (config.right.includes(keyCode)) input.right = true;\n      if (config.faster.includes(keyCode)) input.faster = true;\n      if (config.slower.includes(keyCode)) input.slower = true;\n    }\n  }\n\n  handleKeyUp(inputs: InputState[], keyCode: number): void {\n    for (let i = 0; i < this.playerConfigs.length; i++) {\n      const config = this.playerConfigs[i];\n      const input = inputs[i];\n      if (!config || !input) continue;\n\n      if (config.left.includes(keyCode)) input.left = false;\n      if (config.right.includes(keyCode)) input.right = false;\n      if (config.faster.includes(keyCode)) input.faster = false;\n      if (config.slower.includes(keyCode)) input.slower = false;\n    }\n  }\n}\n\nexport const getInputForPlayer = (\n  inputs: InputState[],\n  playerIndex: number,\n): InputState => {\n  return inputs[playerIndex] ?? createDefaultInput();\n};\n\nexport const setInputForPlayer = (\n  inputs: InputState[],\n  playerIndex: number,\n  input: InputState,\n): void => {\n  if (playerIndex >= 0 && playerIndex < inputs.length) {\n    inputs[playerIndex] = input;\n  }\n};\n","import type { PlayerState } from \"./types\";\nimport * as Util from \"./utils/math\";\n\nexport interface PlayerCollision {\n  p1: number;\n  p2: number;\n  distance: number;\n  dx: number;\n  dz: number;\n}\n\n// Player car width for collision detection (similar to traffic cars)\nexport const PLAYER_CAR_WIDTH = 0.5;\n// How close players need to be on the track (in segment lengths)\nexport const PLAYER_COLLISION_Z_DISTANCE = 200; // segmentLength is typically 200\n\nexport const checkPlayerCollision = (\n  p1: PlayerState,\n  p2: PlayerState,\n  segmentLength: number = 200,\n): boolean => {\n  // Check if players are close enough on the Z axis (track position)\n  let dz = p1.position - p2.position;\n\n  // Handle track wrapping\n  if (Math.abs(dz) > segmentLength * 100) {\n    // Wrapped around track\n    return false;\n  }\n\n  // Check Z distance\n  if (Math.abs(dz) > PLAYER_COLLISION_Z_DISTANCE) {\n    return false;\n  }\n\n  // Check lateral overlap using same method as traffic cars\n  // Use 0.8 percent overlap like traffic car collision\n  return Util.overlap(p1.x, PLAYER_CAR_WIDTH, p2.x, PLAYER_CAR_WIDTH, 0.8);\n};\n\nexport const resolvePlayerCollision = (\n  p1: PlayerState,\n  p2: PlayerState,\n): void => {\n  const dx = p1.x - p2.x;\n  const dz = p1.position - p2.position;\n  const distance = Math.sqrt(dx * dx + dz * dz);\n\n  if (distance === 0) return;\n\n  // Push players apart laterally\n  const pushFactor = 0.15;\n  const nx = dx / distance;\n\n  // Push sideways (x direction)\n  p1.x += nx * pushFactor;\n  p2.x -= nx * pushFactor;\n\n  // Speed collision effect - similar to traffic cars\n  // If p1 is behind and faster, slow down\n  if (dz > 0 && p1.speed > p2.speed) {\n    // p1 is behind p2 and trying to overtake - slow p1 down\n    p1.speed = p2.speed * 0.9;\n  } else if (dz < 0 && p2.speed > p1.speed) {\n    // p2 is behind p1 and trying to overtake - slow p2 down\n    p2.speed = p1.speed * 0.9;\n  }\n\n  // Minimum speed reduction on any collision\n  p1.speed = Math.max(0, p1.speed * 0.95);\n  p2.speed = Math.max(0, p2.speed * 0.95);\n};\n\nexport const checkAllPlayerCollisions = (\n  players: PlayerState[],\n  segmentLength: number = 200,\n): PlayerCollision[] => {\n  const collisions: PlayerCollision[] = [];\n\n  for (let i = 0; i < players.length; i++) {\n    for (let j = i + 1; j < players.length; j++) {\n      const p1 = players[i];\n      const p2 = players[j];\n      if (!p1 || !p2) continue;\n\n      if (checkPlayerCollision(p1, p2, segmentLength)) {\n        const dx = p1.x - p2.x;\n        const dz = p1.position - p2.position;\n        const distance = Math.sqrt(dx * dx + dz * dz);\n\n        collisions.push({\n          p1: i,\n          p2: j,\n          distance,\n          dx,\n          dz,\n        });\n      }\n    }\n  }\n\n  return collisions;\n};\n\nexport const resolveAllPlayerCollisions = (\n  players: PlayerState[],\n  segmentLength: number = 200,\n  onCollision?: (intensity: number) => void,\n): void => {\n  const collisions = checkAllPlayerCollisions(players, segmentLength);\n\n  for (const collision of collisions) {\n    const p1 = players[collision.p1];\n    const p2 = players[collision.p2];\n    if (p1 && p2) {\n      resolvePlayerCollision(p1, p2);\n      if (onCollision) {\n        onCollision(0.8);\n      }\n    }\n  }\n};\n\nexport const getPlayerDistance = (p1: PlayerState, p2: PlayerState): number => {\n  const dx = p1.x - p2.x;\n  const dz = p1.position - p2.position;\n  return Math.sqrt(dx * dx + dz * dz);\n};\n\nexport const getPlayerRelativePosition = (\n  p1: PlayerState,\n  p2: PlayerState,\n): { ahead: boolean; distance: number; lateralDistance: number } => {\n  const dz = p2.position - p1.position;\n  const dx = p2.x - p1.x;\n\n  return {\n    ahead: dz > 0,\n    distance: Math.abs(dz),\n    lateralDistance: Math.abs(dx),\n  };\n};\n","import type {\n  TimeChallengeState,\n  GameScreen,\n} from \"../../game/modes/time-challenge\";\nimport { globalSpriteCache } from \"../../assets/svg-loader\";\nimport { isSoundEnabled } from \"../../audio/mod-player\";\n\nexport interface UIScreen {\n  render(ctx: CanvasRenderingContext2D, state: TimeChallengeState): void;\n  handleClick?(x: number, y: number): string | null;\n  handleKeyDown?(keyCode: number): string | null;\n  handleMouseMove?(x: number, y: number): void;\n  getZones?(): MenuZone[];\n}\n\nexport interface Button {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  label: string;\n  action: string;\n}\n\nexport interface MenuZone {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  action: string;\n  row: number;\n  col: number;\n}\n\nconst COLORS = {\n  background: \"#1a1a2e\",\n  panel: \"#16213e\",\n  accent: \"#0f3460\",\n  highlight: \"#e94560\",\n  text: \"#eaeaea\",\n  textDim: \"#888888\",\n  timer: \"#ffcc00\",\n  score: \"#00ff88\",\n  selection: \"#e53935\",\n};\n\nexport const drawPanel = (\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n): void => {\n  ctx.fillStyle = COLORS.panel;\n  ctx.fillRect(x, y, width, height);\n  ctx.strokeStyle = COLORS.accent;\n  ctx.lineWidth = 2;\n  ctx.strokeRect(x, y, width, height);\n};\n\nexport const drawButton = (\n  ctx: CanvasRenderingContext2D,\n  button: Button,\n  isHovered: boolean = false,\n): void => {\n  ctx.fillStyle = isHovered ? COLORS.highlight : COLORS.accent;\n  ctx.fillRect(button.x, button.y, button.width, button.height);\n\n  ctx.strokeStyle = COLORS.text;\n  ctx.lineWidth = 1;\n  ctx.strokeRect(button.x, button.y, button.width, button.height);\n\n  ctx.fillStyle = COLORS.text;\n  ctx.font = \"bold 18px monospace\";\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"middle\";\n  ctx.fillText(\n    button.label,\n    button.x + button.width / 2,\n    button.y + button.height / 2,\n  );\n};\n\nexport const drawText = (\n  ctx: CanvasRenderingContext2D,\n  text: string,\n  x: number,\n  y: number,\n  options: {\n    font?: string;\n    color?: string;\n    align?: CanvasTextAlign;\n    baseline?: CanvasTextBaseline;\n  } = {},\n): void => {\n  const {\n    font = \"16px monospace\",\n    color = COLORS.text,\n    align = \"left\",\n    baseline = \"top\",\n  } = options;\n\n  ctx.font = font;\n  ctx.fillStyle = color;\n  ctx.textAlign = align;\n  ctx.textBaseline = baseline;\n  ctx.fillText(text, x, y);\n};\n\nexport const drawCenteredText = (\n  ctx: CanvasRenderingContext2D,\n  text: string,\n  centerX: number,\n  y: number,\n  options: {\n    font?: string;\n    color?: string;\n  } = {},\n): void => {\n  drawText(ctx, text, centerX, y, { ...options, align: \"center\" });\n};\n\nconst drawSelectionBox = (\n  ctx: CanvasRenderingContext2D,\n  zone: MenuZone,\n): void => {\n  ctx.strokeStyle = COLORS.selection;\n  ctx.lineWidth = 5;\n  ctx.strokeRect(zone.x, zone.y, zone.width, zone.height);\n\n  ctx.shadowColor = COLORS.selection;\n  ctx.shadowBlur = 10;\n  ctx.strokeRect(zone.x, zone.y, zone.width, zone.height);\n  ctx.shadowBlur = 0;\n};\n\nconst MAIN_MENU_ZONES: Array<{\n  svgX: number;\n  svgY: number;\n  svgW: number;\n  svgH: number;\n  action: string;\n  row: number;\n  col: number;\n}> = [\n  {\n    svgX: 30,\n    svgY: 40,\n    svgW: 180,\n    svgH: 80,\n    action: \"player1\",\n    row: 0,\n    col: 0,\n  },\n  { svgX: 230, svgY: 40, svgW: 340, svgH: 80, action: \"start\", row: 0, col: 1 },\n  {\n    svgX: 590,\n    svgY: 40,\n    svgW: 180,\n    svgH: 80,\n    action: \"player2\",\n    row: 0,\n    col: 2,\n  },\n  {\n    svgX: 30,\n    svgY: 140,\n    svgW: 180,\n    svgH: 90,\n    action: \"gears-p1\",\n    row: 1,\n    col: 0,\n  },\n  { svgX: 230, svgY: 140, svgW: 340, svgH: 90, action: \"game\", row: 1, col: 1 },\n  {\n    svgX: 590,\n    svgY: 140,\n    svgW: 180,\n    svgH: 90,\n    action: \"gears-p2\",\n    row: 1,\n    col: 2,\n  },\n  {\n    svgX: 30,\n    svgY: 250,\n    svgW: 180,\n    svgH: 90,\n    action: \"accel-p1\",\n    row: 2,\n    col: 0,\n  },\n  {\n    svgX: 230,\n    svgY: 250,\n    svgW: 340,\n    svgH: 90,\n    action: \"course\",\n    row: 2,\n    col: 1,\n  },\n  {\n    svgX: 590,\n    svgY: 250,\n    svgW: 180,\n    svgH: 90,\n    action: \"accel-p2\",\n    row: 2,\n    col: 2,\n  },\n  {\n    svgX: 30,\n    svgY: 360,\n    svgW: 240,\n    svgH: 80,\n    action: \"control\",\n    row: 3,\n    col: 0,\n  },\n  {\n    svgX: 290,\n    svgY: 360,\n    svgW: 260,\n    svgH: 80,\n    action: \"players\",\n    row: 3,\n    col: 1,\n  },\n  {\n    svgX: 570,\n    svgY: 360,\n    svgW: 200,\n    svgH: 80,\n    action: \"sound\",\n    row: 3,\n    col: 2,\n  },\n  {\n    svgX: 30,\n    svgY: 460,\n    svgW: 240,\n    svgH: 80,\n    action: \"constructor\",\n    row: 4,\n    col: 0,\n  },\n  { svgX: 290, svgY: 460, svgW: 260, svgH: 80, action: \"code\", row: 4, col: 1 },\n  {\n    svgX: 570,\n    svgY: 460,\n    svgW: 200,\n    svgH: 80,\n    action: \"define\",\n    row: 4,\n    col: 2,\n  },\n];\n\nconst NAVIGABLE_ZONES = [\n  \"start\",\n  \"game\",\n  \"course\",\n  \"control\",\n  \"players\",\n  \"sound\",\n  \"constructor\",\n  \"code\",\n  \"define\",\n];\n\nexport class MainMenuScreen implements UIScreen {\n  private buttons: Button[];\n  private zones: MenuZone[];\n  private selectedIndex: number = 0;\n  private playerCount: 1 | 2 = 1;\n  private gameMode: \"time\" | \"race\" = \"time\";\n\n  constructor(\n    private width: number,\n    private height: number,\n  ) {\n    this.buttons = [];\n    this.zones = this.calculateZones();\n    this.selectedIndex = this.zones.findIndex((z) =>\n      NAVIGABLE_ZONES.includes(z.action),\n    );\n    if (this.selectedIndex < 0) this.selectedIndex = 0;\n  }\n\n  getPlayerCount(): 1 | 2 {\n    return this.playerCount;\n  }\n\n  getGameMode(): \"time\" | \"race\" {\n    return this.gameMode;\n  }\n\n  togglePlayerCount(): void {\n    this.playerCount = this.playerCount === 1 ? 2 : 1;\n  }\n\n  toggleGameMode(): void {\n    this.gameMode = this.gameMode === \"time\" ? \"race\" : \"time\";\n  }\n\n  private calculateZones(): MenuZone[] {\n    const scaleX = this.width / 800;\n    const scaleY = this.height / 600;\n\n    return MAIN_MENU_ZONES.map((z) => ({\n      x: z.svgX * scaleX,\n      y: z.svgY * scaleY,\n      width: z.svgW * scaleX,\n      height: z.svgH * scaleY,\n      action: z.action,\n      row: z.row,\n      col: z.col,\n    }));\n  }\n\n  render(ctx: CanvasRenderingContext2D, state: TimeChallengeState): void {\n    const scale = this.width / 800;\n    const menuSvg = globalSpriteCache.get(\"main-menu.svg\", scale);\n    if (menuSvg) {\n      ctx.drawImage(menuSvg.canvas, 0, 0, this.width, this.height);\n    } else {\n      ctx.fillStyle = \"#1a1c20\";\n      ctx.fillRect(0, 0, this.width, this.height);\n      drawCenteredText(ctx, \"LOADING...\", this.width / 2, this.height / 2, {\n        font: \"bold 32px monospace\",\n        color: \"#a0a0a0\",\n      });\n      return;\n    }\n\n    const selectedZone = this.zones[this.selectedIndex];\n    if (selectedZone) {\n      drawSelectionBox(ctx, selectedZone);\n    }\n\n    const playersZone = this.zones.find((z) => z.action === \"players\");\n    if (playersZone) {\n      const text = this.playerCount === 1 ? \"1 PLAYER\" : \"2 PLAYERS\";\n      drawCenteredText(\n        ctx,\n        text,\n        playersZone.x + playersZone.width / 2,\n        playersZone.y + playersZone.height / 2,\n        {\n          font: `bold ${14 * scale}px monospace`,\n          color: \"#ffcc00\",\n        },\n      );\n    }\n\n    // Draw game mode in GAME box\n    const gameZone = this.zones.find((z) => z.action === \"game\");\n    if (gameZone) {\n      const modeText = this.gameMode === \"time\" ? \"TIME MODE\" : \"RACE MODE\";\n      drawCenteredText(\n        ctx,\n        modeText,\n        gameZone.x + gameZone.width / 2,\n        gameZone.y + gameZone.height / 2 + 25 * scale,\n        {\n          font: `bold ${12 * scale}px monospace`,\n          color: \"#4caf50\",\n        },\n      );\n    }\n\n    // Draw speaker icon based on sound state\n    this.drawSpeakerIcon(ctx, scale);\n  }\n\n  private drawSpeakerIcon(ctx: CanvasRenderingContext2D, scale: number): void {\n    const soundZone = this.zones.find((z) => z.action === \"sound\");\n    if (!soundZone) return;\n\n    const centerX = soundZone.x + soundZone.width / 2;\n    const centerY = soundZone.y + soundZone.height / 2 + 10 * scale;\n    const size = 30 * scale;\n\n    ctx.save();\n    ctx.strokeStyle = \"#fdd835\";\n    ctx.fillStyle = \"#fdd835\";\n    ctx.lineWidth = 3 * scale;\n    ctx.lineCap = \"round\";\n    ctx.lineJoin = \"round\";\n\n    // Draw speaker cone (base part)\n    ctx.beginPath();\n    ctx.moveTo(centerX - size * 0.5, centerY + size * 0.4);\n    ctx.lineTo(centerX - size * 0.5, centerY - size * 0.4);\n    ctx.lineTo(centerX + size * 0.2, centerY - size * 0.5);\n    ctx.lineTo(centerX + size * 0.2, centerY + size * 0.5);\n    ctx.closePath();\n    ctx.fill();\n\n    // Draw speaker box (back part)\n    ctx.fillRect(\n      centerX - size * 0.7,\n      centerY - size * 0.25,\n      size * 0.25,\n      size * 0.5,\n    );\n\n    if (isSoundEnabled()) {\n      // Draw sound waves\n      ctx.strokeStyle = \"#fff\";\n      ctx.lineWidth = 2 * scale;\n      ctx.beginPath();\n      ctx.arc(\n        centerX + size * 0.3,\n        centerY,\n        size * 0.25,\n        -Math.PI / 3,\n        Math.PI / 3,\n      );\n      ctx.stroke();\n      ctx.beginPath();\n      ctx.arc(\n        centerX + size * 0.3,\n        centerY,\n        size * 0.45,\n        -Math.PI / 3,\n        Math.PI / 3,\n      );\n      ctx.stroke();\n    } else {\n      // Draw X (muted)\n      ctx.strokeStyle = \"#e53935\";\n      ctx.lineWidth = 4 * scale;\n      ctx.beginPath();\n      ctx.moveTo(centerX + size * 0.1, centerY - size * 0.35);\n      ctx.lineTo(centerX + size * 0.7, centerY + size * 0.35);\n      ctx.moveTo(centerX + size * 0.7, centerY - size * 0.35);\n      ctx.lineTo(centerX + size * 0.1, centerY + size * 0.35);\n      ctx.stroke();\n\n      // Draw \"OFF\" text\n      ctx.fillStyle = \"#e53935\";\n      ctx.font = `bold ${10 * scale}px monospace`;\n      ctx.textAlign = \"center\";\n      ctx.fillText(\"OFF\", centerX + size * 0.5, centerY + size * 0.6);\n    }\n\n    ctx.restore();\n  }\n\n  private findZoneIndex(x: number, y: number): number {\n    return this.zones.findIndex(\n      (z) => x >= z.x && x <= z.x + z.width && y >= z.y && y <= z.y + z.height,\n    );\n  }\n\n  handleClick(x: number, y: number): string | null {\n    const idx = this.findZoneIndex(x, y);\n    if (idx >= 0) {\n      const zone = this.zones[idx];\n      if (zone) {\n        if (zone.action === \"players\") {\n          this.togglePlayerCount();\n          return null;\n        }\n        if (zone.action === \"game\") {\n          this.toggleGameMode();\n          return null;\n        }\n        return zone.action;\n      }\n    }\n    return null;\n  }\n\n  handleMouseMove(x: number, y: number): void {\n    const idx = this.findZoneIndex(x, y);\n    const zone = this.zones[idx];\n    if (idx >= 0 && zone && NAVIGABLE_ZONES.includes(zone.action)) {\n      this.selectedIndex = idx;\n    }\n  }\n\n  handleKeyDown(keyCode: number): string | null {\n    const currentZone = this.zones[this.selectedIndex];\n    if (!currentZone) return null;\n\n    const { UP, DOWN, LEFT, RIGHT, SPACE } = {\n      UP: 38,\n      DOWN: 40,\n      LEFT: 37,\n      RIGHT: 39,\n      SPACE: 32,\n    };\n\n    if (keyCode === SPACE || keyCode === 13) {\n      if (currentZone.action === \"players\") {\n        this.togglePlayerCount();\n        return null;\n      }\n      if (currentZone.action === \"game\") {\n        this.toggleGameMode();\n        return null;\n      }\n      return currentZone.action;\n    }\n\n    let candidates: MenuZone[] = [];\n\n    if (keyCode === UP) {\n      candidates = this.zones.filter(\n        (z) => NAVIGABLE_ZONES.includes(z.action) && z.row < currentZone.row,\n      );\n    } else if (keyCode === DOWN) {\n      candidates = this.zones.filter(\n        (z) => NAVIGABLE_ZONES.includes(z.action) && z.row > currentZone.row,\n      );\n    } else if (keyCode === LEFT) {\n      candidates = this.zones.filter(\n        (z) =>\n          NAVIGABLE_ZONES.includes(z.action) &&\n          z.col < currentZone.col &&\n          z.row === currentZone.row,\n      );\n    } else if (keyCode === RIGHT) {\n      candidates = this.zones.filter(\n        (z) =>\n          NAVIGABLE_ZONES.includes(z.action) &&\n          z.col > currentZone.col &&\n          z.row === currentZone.row,\n      );\n    }\n\n    if (candidates.length > 0) {\n      if (keyCode === UP || keyCode === LEFT) {\n        candidates.sort((a, b) =>\n          keyCode === UP ? b.row - a.row : b.col - a.col,\n        );\n      } else {\n        candidates.sort((a, b) =>\n          keyCode === DOWN ? a.row - b.row : a.col - b.col,\n        );\n      }\n      const firstCandidate = candidates[0];\n      if (firstCandidate) {\n        const newIdx = this.zones.indexOf(firstCandidate);\n        if (newIdx >= 0) {\n          this.selectedIndex = newIdx;\n        }\n      }\n    }\n\n    return null;\n  }\n\n  getZones(): MenuZone[] {\n    return this.zones;\n  }\n\n  getButtons(): Button[] {\n    return this.buttons;\n  }\n}\n\nexport interface MusicTrack {\n  id: string;\n  name: string;\n  file: string;\n}\n\nexport const MUSIC_TRACKS: MusicTrack[] = [\n  { id: \"esprit\", name: \"ESPRIT THEME\", file: \"/sound/Esprit_Theme.mp3\" },\n  {\n    id: \"velocity\",\n    name: \"VELOCITY VORTEX\",\n    file: \"/sound/Velocity_Vortex.mp3\",\n  },\n  {\n    id: \"nebula\",\n    name: \"NEBULA NAVIGATOR\",\n    file: \"/sound/Nebula_Navigator.mp3\",\n  },\n  {\n    id: \"neon\",\n    name: \"NEON DRIVE\",\n    file: \"/sound/Neon_Drive.mp3\",\n  },\n  {\n    id: \"neon2\",\n    name: \"NEON VELOCITY\",\n    file: \"/sound/Neon_Velocity.mp3\",\n  },\n  {\n    id: \"silent\",\n    name: \"NO MUSIC\",\n    file: \"\",\n  },\n];\n\nexport class MusicSelectionScreen implements UIScreen {\n  private selectedIndex: number = 4; // Default to NEON VELOCITY\n\n  constructor(\n    private width: number,\n    private height: number,\n  ) {}\n\n  getSelectedTrack(): MusicTrack {\n    return MUSIC_TRACKS[this.selectedIndex] ?? MUSIC_TRACKS[0]!;\n  }\n\n  getSelectedChannel(): string {\n    return this.getSelectedTrack().id;\n  }\n\n  render(ctx: CanvasRenderingContext2D, state: TimeChallengeState): void {\n    const scale = this.width / 800;\n    const musicSvg = globalSpriteCache.get(\"music-selection.svg\", scale);\n    if (musicSvg) {\n      ctx.drawImage(musicSvg.canvas, 0, 0, this.width, this.height);\n    } else {\n      ctx.fillStyle = \"#d2b48c\";\n      ctx.fillRect(0, 0, this.width, this.height);\n    }\n\n    const centerX = this.width / 2;\n\n    const currentTrack = MUSIC_TRACKS[this.selectedIndex];\n    if (currentTrack) {\n      const displayY = 110 * (this.height / 600);\n\n      ctx.fillStyle = \"rgba(0, 0, 0, 0.6)\";\n      ctx.fillRect(centerX - 200, displayY - 30, 400, 50);\n\n      ctx.font = `bold ${28 * (this.height / 600)}px monospace`;\n      ctx.fillStyle = \"#ff8c00\";\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.shadowColor = \"#ff8c00\";\n      ctx.shadowBlur = 10;\n      ctx.fillText(currentTrack.name, centerX, displayY);\n      ctx.shadowBlur = 0;\n    }\n\n    ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n    ctx.fillRect(this.width / 2 - 160, this.height - 80, 320, 40);\n    ctx.font = `bold ${16 * (this.height / 600)}px monospace`;\n    ctx.fillStyle = \"#ff8c00\";\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillText(\n      \"LEFT/RIGHT: SELECT   SPACE/ENTER: START\",\n      this.width / 2,\n      this.height - 60,\n    );\n  }\n\n  handleClick(_x: number, _y: number): string | null {\n    return \"start_game\";\n  }\n\n  handleKeyDown(keyCode: number): string | null {\n    const { LEFT, RIGHT, SPACE } = {\n      LEFT: 37,\n      RIGHT: 39,\n      SPACE: 32,\n    };\n\n    if (keyCode === SPACE || keyCode === 13) {\n      return \"start_game\";\n    }\n\n    if (keyCode === LEFT) {\n      this.selectedIndex =\n        (this.selectedIndex - 1 + MUSIC_TRACKS.length) % MUSIC_TRACKS.length;\n    } else if (keyCode === RIGHT) {\n      this.selectedIndex = (this.selectedIndex + 1) % MUSIC_TRACKS.length;\n    }\n\n    return null;\n  }\n\n  handleMouseMove(_x: number, _y: number): void {}\n\n  getZones(): MenuZone[] {\n    return [];\n  }\n}\n\nexport interface RECSConfig {\n  themeId: string;\n  curves: number;\n  hills: number;\n  scenery: number;\n  sharpness: number;\n  steepness: number;\n  scatter: number;\n  length: number;\n  difficulty: number;\n  obstacles: number;\n}\n\nconst THEME_LIST = [\n  { id: \"night\", name: \"NIGHT\", icon: \"theme-night.svg\" },\n  { id: \"fog\", name: \"FOG\", icon: \"theme-fog.svg\" },\n  { id: \"snow\", name: \"SNOW\", icon: \"theme-snow.svg\" },\n  { id: \"storm\", name: \"STORM\", icon: \"theme-storm.svg\" },\n  { id: \"desert\", name: \"DESERT\", icon: \"theme-desert.svg\" },\n  { id: \"future\", name: \"FUTURE\", icon: \"theme-future.svg\" },\n  { id: \"marsh\", name: \"MARSH\", icon: \"theme-marsh.svg\" },\n  { id: \"mountains\", name: \"MOUNTAINS\", icon: \"theme-mountains.svg\" },\n  { id: \"lakes\", name: \"LAKES\", icon: \"theme-lakes.svg\" },\n  { id: \"country\", name: \"COUNTRY\", icon: \"theme-country.svg\" },\n  { id: \"city\", name: \"CITY\", icon: \"theme-city.svg\" },\n  { id: \"roadworks\", name: \"ROADWORKS\", icon: \"theme-roadworks.svg\" },\n  { id: \"windy\", name: \"WINDY\", icon: \"theme-windy.svg\" },\n];\n\nconst RECS_SLIDERS = [\n  { id: \"curves\", name: \"CURVES\", row: 0, col: 0 },\n  { id: \"hills\", name: \"HILLS\", row: 0, col: 1 },\n  { id: \"scenery\", name: \"SCENERY\", row: 0, col: 2 },\n  { id: \"sharpness\", name: \"SHARPNESS\", row: 1, col: 0 },\n  { id: \"steepness\", name: \"STEEPNESS\", row: 1, col: 1 },\n  { id: \"scatter\", name: \"SCATTER\", row: 1, col: 2 },\n  { id: \"length\", name: \"LENGTH\", row: 2, col: 0 },\n  { id: \"difficulty\", name: \"DIFFICULTY\", row: 2, col: 1 },\n  { id: \"obstacles\", name: \"OBSTACLES\", row: 2, col: 2 },\n];\n\nconst RECS_TOP_BUTTONS = [\n  { id: \"type\", name: \"TYPE\", x: 30 },\n  { id: \"exit\", name: \"EXIT\", x: 285 },\n  { id: \"start\", name: \"START\", x: 540 },\n];\n\nexport class RECSScreen implements UIScreen {\n  private config: RECSConfig;\n  private selectedRow: number = 0;\n  private selectedCol: number = 0;\n  private mode: \"sliders\" | \"scenario\" | \"top\" = \"top\";\n\n  constructor(\n    private width: number,\n    private height: number,\n  ) {\n    this.config = {\n      themeId: \"night\",\n      curves: 50,\n      hills: 50,\n      scenery: 50,\n      sharpness: 50,\n      steepness: 50,\n      scatter: 50,\n      length: 50,\n      difficulty: 50,\n      obstacles: 50,\n    };\n  }\n\n  getConfig(): RECSConfig {\n    return this.config;\n  }\n\n  getSelectedThemeId(): string {\n    return this.config.themeId;\n  }\n\n  private getSliderValue(id: string): number {\n    const key = id as keyof RECSConfig;\n    const value = this.config[key];\n    return typeof value === \"number\" ? value : 50;\n  }\n\n  private setSliderValue(id: string, value: number): void {\n    const key = id as keyof RECSConfig;\n    if (key in this.config) {\n      (this.config as unknown as Record<string, unknown>)[key] = Math.max(\n        0,\n        Math.min(100, value),\n      );\n    }\n  }\n\n  render(ctx: CanvasRenderingContext2D, _state: TimeChallengeState): void {\n    const scale = this.width / 800;\n    const recsSvg = globalSpriteCache.get(\"track-builder.svg\", scale);\n    if (recsSvg) {\n      ctx.drawImage(recsSvg.canvas, 0, 0, this.width, this.height);\n    } else {\n      ctx.fillStyle = \"#1a1a1a\";\n      ctx.fillRect(0, 0, this.width, this.height);\n    }\n\n    const scaleX = this.width / 800;\n    const scaleY = this.height / 600;\n\n    for (const slider of RECS_SLIDERS) {\n      const x = (30 + slider.col * 255) * scaleX;\n      const y = (120 + slider.row * 100) * scaleY;\n      const value = this.getSliderValue(slider.id);\n\n      const isSelected =\n        this.mode === \"sliders\" &&\n        this.selectedRow === slider.row &&\n        this.selectedCol === slider.col;\n\n      if (isSelected) {\n        ctx.strokeStyle = \"#c1272d\";\n        ctx.lineWidth = 3;\n        ctx.strokeRect(x, y, 230 * scaleX, 85 * scaleY);\n      }\n\n      ctx.fillStyle = \"#ffca28\";\n      ctx.font = `bold ${14 * Math.min(scaleX, scaleY)}px monospace`;\n      ctx.textAlign = \"right\";\n      ctx.fillText(`${value}%`, x + 215 * scaleX, y + 32 * scaleY);\n\n      const trackX = x + 40 * scaleX;\n      const trackY = y + 55 * scaleY;\n      const trackW = 150 * scaleX;\n      const trackH = 12 * scaleY;\n      const fillW = (value / 100) * trackW;\n\n      ctx.fillStyle = \"#c1272d\";\n      ctx.fillRect(trackX + 2, trackY + 2, fillW - 4, 8 * scaleY);\n    }\n\n    const scenarioY = 430 * scaleY;\n    const slotWidth = 46 * scaleX;\n    const slotHeight = 75 * scaleY;\n    const gap = 54 * scaleX;\n    const startX = 53 * scaleX;\n\n    const themeIndex = THEME_LIST.findIndex(\n      (t) => t.id === this.config.themeId,\n    );\n\n    for (let i = 0; i < THEME_LIST.length; i++) {\n      const x = startX + i * gap;\n      const y = scenarioY + 45 * scaleY;\n      const theme = THEME_LIST[i];\n\n      if (theme) {\n        const iconSvg = globalSpriteCache.get(\n          theme.icon,\n          Math.min(scaleX, scaleY),\n        );\n        if (iconSvg) {\n          ctx.drawImage(iconSvg.canvas, x, y, slotWidth, slotHeight);\n        } else {\n          ctx.fillStyle = \"#222222\";\n          ctx.fillRect(x, y, slotWidth, slotHeight);\n        }\n      }\n\n      if (this.mode === \"scenario\" && i === this.selectedCol) {\n        ctx.strokeStyle = \"#c1272d\";\n        ctx.lineWidth = 3;\n        ctx.strokeRect(x - 2, y - 2, slotWidth + 4, slotHeight + 4);\n      } else if (i === themeIndex) {\n        ctx.strokeStyle = \"#00ff88\";\n        ctx.lineWidth = 2;\n        ctx.strokeRect(x - 1, y - 1, slotWidth + 2, slotHeight + 2);\n      }\n    }\n\n    for (let i = 0; i < RECS_TOP_BUTTONS.length; i++) {\n      const btn = RECS_TOP_BUTTONS[i];\n      if (!btn) continue;\n      const x = btn.x * scaleX;\n      const y = 20 * scaleY;\n      const isSelected = this.mode === \"top\" && this.selectedCol === i;\n\n      if (isSelected) {\n        ctx.strokeStyle = \"#c1272d\";\n        ctx.lineWidth = 3;\n        ctx.strokeRect(x, y, 230 * scaleX, 80 * scaleY);\n      }\n    }\n\n    ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n    ctx.fillRect(this.width / 2 - 300, this.height - 35, 600, 30);\n    ctx.font = `bold ${11 * Math.min(scaleX, scaleY)}px monospace`;\n    ctx.fillStyle = \"#ffca28\";\n    ctx.textAlign = \"center\";\n    ctx.fillText(\n      \"TAB: MODE   ARROWS: NAVIGATE   A/D: ADJUST   ENTER: SELECT\",\n      this.width / 2,\n      this.height - 15,\n    );\n  }\n\n  handleClick(x: number, y: number): string | null {\n    const scaleX = this.width / 800;\n    const scaleY = this.height / 600;\n\n    for (let i = 0; i < RECS_TOP_BUTTONS.length; i++) {\n      const btn = RECS_TOP_BUTTONS[i];\n      if (!btn) continue;\n      const btnX = btn.x * scaleX;\n      const btnY = 20 * scaleY;\n      const btnW = 230 * scaleX;\n      const btnH = 80 * scaleY;\n\n      if (x >= btnX && x <= btnX + btnW && y >= btnY && y <= btnY + btnH) {\n        if (btn.id === \"exit\") {\n          return \"back\";\n        } else if (btn.id === \"start\") {\n          return \"start_game\";\n        }\n        return null;\n      }\n    }\n\n    for (const slider of RECS_SLIDERS) {\n      const sliderX = (30 + slider.col * 255) * scaleX;\n      const sliderY = (120 + slider.row * 100) * scaleY;\n      const sliderW = 230 * scaleX;\n      const sliderH = 85 * scaleY;\n\n      if (\n        x >= sliderX &&\n        x <= sliderX + sliderW &&\n        y >= sliderY &&\n        y <= sliderY + sliderH\n      ) {\n        const trackX = sliderX + 40 * scaleX;\n        const trackW = 150 * scaleX;\n        const relativeX = x - trackX;\n        const newValue = Math.round((relativeX / trackW) * 100);\n        this.setSliderValue(slider.id, Math.max(0, Math.min(100, newValue)));\n        return null;\n      }\n    }\n\n    const scenarioY = (430 + 45) * scaleY;\n    const slotWidth = 46 * scaleX;\n    const slotHeight = 75 * scaleY;\n    const gap = 54 * scaleX;\n    const startX = 53 * scaleX;\n\n    for (let i = 0; i < THEME_LIST.length; i++) {\n      const iconX = startX + i * gap;\n\n      if (\n        x >= iconX &&\n        x <= iconX + slotWidth &&\n        y >= scenarioY &&\n        y <= scenarioY + slotHeight\n      ) {\n        const theme = THEME_LIST[i];\n        if (theme) {\n          this.config.themeId = theme.id;\n        }\n        return null;\n      }\n    }\n\n    return null;\n  }\n\n  handleMouseMove(x: number, y: number): void {\n    const scaleX = this.width / 800;\n    const scaleY = this.height / 600;\n\n    for (const btn of RECS_TOP_BUTTONS) {\n      if (!btn) continue;\n      const btnX = btn.x * scaleX;\n      const btnY = 20 * scaleY;\n      const btnW = 230 * scaleX;\n      const btnH = 80 * scaleY;\n\n      if (x >= btnX && x <= btnX + btnW && y >= btnY && y <= btnY + btnH) {\n        this.mode = \"top\";\n        this.selectedCol = RECS_TOP_BUTTONS.indexOf(btn);\n        return;\n      }\n    }\n\n    for (const slider of RECS_SLIDERS) {\n      const sliderX = (30 + slider.col * 255) * scaleX;\n      const sliderY = (120 + slider.row * 100) * scaleY;\n      const sliderW = 230 * scaleX;\n      const sliderH = 85 * scaleY;\n\n      if (\n        x >= sliderX &&\n        x <= sliderX + sliderW &&\n        y >= sliderY &&\n        y <= sliderY + sliderH\n      ) {\n        this.mode = \"sliders\";\n        this.selectedRow = slider.row;\n        this.selectedCol = slider.col;\n        return;\n      }\n    }\n\n    const scenarioY = (430 + 45) * scaleY;\n    const slotWidth = 46 * scaleX;\n    const slotHeight = 75 * scaleY;\n    const gap = 54 * scaleX;\n    const startX = 53 * scaleX;\n\n    for (let i = 0; i < THEME_LIST.length; i++) {\n      const iconX = startX + i * gap;\n\n      if (\n        x >= iconX &&\n        x <= iconX + slotWidth &&\n        y >= scenarioY &&\n        y <= scenarioY + slotHeight\n      ) {\n        this.mode = \"scenario\";\n        this.selectedCol = i;\n        return;\n      }\n    }\n  }\n\n  getZones(): MenuZone[] {\n    const scaleX = this.width / 800;\n    const scaleY = this.height / 600;\n    const zones: MenuZone[] = [];\n\n    for (let i = 0; i < RECS_TOP_BUTTONS.length; i++) {\n      const btn = RECS_TOP_BUTTONS[i];\n      if (!btn) continue;\n      zones.push({\n        x: btn.x * scaleX,\n        y: 20 * scaleY,\n        width: 230 * scaleX,\n        height: 80 * scaleY,\n        action: btn.id,\n        row: 0,\n        col: i,\n      });\n    }\n\n    for (const slider of RECS_SLIDERS) {\n      zones.push({\n        x: (30 + slider.col * 255) * scaleX,\n        y: (120 + slider.row * 100) * scaleY,\n        width: 230 * scaleX,\n        height: 85 * scaleY,\n        action: slider.id,\n        row: slider.row + 1,\n        col: slider.col,\n      });\n    }\n\n    const scenarioY = (430 + 45) * scaleY;\n    const slotWidth = 46 * scaleX;\n    const slotHeight = 75 * scaleY;\n    const gap = 54 * scaleX;\n    const startX = 53 * scaleX;\n\n    for (let i = 0; i < THEME_LIST.length; i++) {\n      zones.push({\n        x: startX + i * gap,\n        y: scenarioY,\n        width: slotWidth,\n        height: slotHeight,\n        action: `theme_${i}`,\n        row: 4,\n        col: i,\n      });\n    }\n\n    return zones;\n  }\n}\n\nexport class ResultsScreen implements UIScreen {\n  constructor(\n    private width: number,\n    private height: number,\n  ) {}\n\n  render(ctx: CanvasRenderingContext2D, state: TimeChallengeState): void {\n    ctx.fillStyle = COLORS.background;\n    ctx.fillRect(0, 0, this.width, this.height);\n\n    const centerX = this.width / 2;\n\n    const titleText = state.isGameOver\n      ? state.gameMode === \"race\"\n        ? \"RACE COMPLETE\"\n        : \"GAME OVER\"\n      : \"RACE COMPLETE\";\n    drawCenteredText(ctx, titleText, centerX, 100, {\n      font: \"bold 36px monospace\",\n      color:\n        state.isGameOver && state.gameMode === \"time\"\n          ? COLORS.highlight\n          : COLORS.score,\n    });\n\n    drawPanel(ctx, centerX - 150, 160, 300, 200);\n\n    drawCenteredText(ctx, state.playerName, centerX, 180, {\n      font: \"bold 24px monospace\",\n    });\n\n    drawCenteredText(\n      ctx,\n      `SCORE: ${state.score.toString().padStart(6, \"0\")}`,\n      centerX,\n      230,\n      {\n        font: \"28px monospace\",\n        color: COLORS.score,\n      },\n    );\n\n    drawCenteredText(\n      ctx,\n      `LAPS: ${state.lap - 1}/${state.totalLaps}`,\n      centerX,\n      280,\n      {\n        font: \"20px monospace\",\n        color: COLORS.textDim,\n      },\n    );\n\n    if (state.bestScore !== null && state.score >= state.bestScore) {\n      drawCenteredText(ctx, \"NEW RECORD!\", centerX, 330, {\n        font: \"bold 24px monospace\",\n        color: COLORS.timer,\n      });\n    }\n\n    drawCenteredText(\n      ctx,\n      \"PRESS SPACE TO CONTINUE\",\n      centerX,\n      this.height - 80,\n      {\n        font: \"18px monospace\",\n        color: COLORS.textDim,\n      },\n    );\n  }\n}\n\nexport const createScreens = (\n  width: number,\n  height: number,\n): Map<GameScreen, UIScreen> => {\n  const screens = new Map<GameScreen, UIScreen>();\n  screens.set(\"main-menu\", new MainMenuScreen(width, height));\n  screens.set(\"music-select\", new MusicSelectionScreen(width, height));\n  screens.set(\"recs\", new RECSScreen(width, height));\n  screens.set(\"results\", new ResultsScreen(width, height));\n  return screens;\n};\n","import type { TimeChallengeState } from \"../../game/modes/time-challenge\";\nimport {\n  formatTimeDisplay,\n  formatScore,\n} from \"../../game/modes/time-challenge\";\n\nconst COLORS = {\n  background: \"rgba(0, 0, 0, 0.75)\",\n  backgroundLight: \"rgba(0, 0, 0, 0.6)\",\n  timer: \"#ffcc00\",\n  timerLow: \"#ff4444\",\n  score: \"#00ff88\",\n  lap: \"#00ccff\",\n  speed: \"#ffffff\",\n  barBg: \"#333333\",\n  barGreen: \"#22c55e\",\n  barRed: \"#ef4444\",\n  barYellow: \"#eab308\",\n  position: \"#ffffff\",\n  boost: \"#06b6d4\",\n  mirrorBg: \"#1a3d1a\",\n  mirrorRoad: \"#444444\",\n  mirrorLine: \"#666666\",\n};\n\nexport interface HudConfig {\n  width: number;\n  height: number;\n}\n\nexport interface MirrorCar {\n  offset: number;\n  distance: number;\n  color: string;\n}\n\nexport interface HudState {\n  speed: number;\n  maxSpeed: number;\n  position: number;\n  totalPositions: number;\n  boostMeter: number;\n  mirrorCars: MirrorCar[];\n}\n\nconst DEFAULT_HUD_STATE: HudState = {\n  speed: 0,\n  maxSpeed: 300,\n  position: 1,\n  totalPositions: 4,\n  boostMeter: 1,\n  mirrorCars: [],\n};\n\nexport const getPositionSuffix = (pos: number): string => {\n  if (pos === 1) return \"ST\";\n  if (pos === 2) return \"ND\";\n  if (pos === 3) return \"RD\";\n  return \"TH\";\n};\n\nconst drawBlockyText = (\n  ctx: CanvasRenderingContext2D,\n  text: string,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  align: CanvasTextAlign = \"left\",\n): void => {\n  ctx.font = `bold ${size}px \"Courier New\", monospace`;\n  ctx.fillStyle = color;\n  ctx.textAlign = align;\n  ctx.textBaseline = \"top\";\n\n  ctx.fillStyle = \"rgba(0, 0, 0, 0.5)\";\n  const offsetX = align === \"right\" ? -2 : 2;\n  ctx.fillText(text, x + offsetX, y + 2);\n\n  ctx.fillStyle = color;\n  ctx.fillText(text, x, y);\n};\n\nconst renderRearViewMirror = (\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  mirrorCars: MirrorCar[],\n): void => {\n  ctx.fillStyle = COLORS.backgroundLight;\n  ctx.fillRect(x - 2, y - 2, width + 4, height + 4);\n\n  ctx.strokeStyle = \"#888888\";\n  ctx.lineWidth = 2;\n  ctx.strokeRect(x - 2, y - 2, width + 4, height + 4);\n\n  ctx.fillStyle = COLORS.mirrorBg;\n  ctx.fillRect(x, y, width, height);\n\n  const roadCenterX = x + width / 2;\n  const roadTop = y + 8;\n  const roadBottom = y + height - 16;\n  const roadWidth = width * 0.85;\n\n  ctx.fillStyle = COLORS.mirrorRoad;\n  ctx.beginPath();\n  ctx.moveTo(roadCenterX - roadWidth * 0.3, roadTop);\n  ctx.lineTo(roadCenterX + roadWidth * 0.3, roadTop);\n  ctx.lineTo(roadCenterX + roadWidth * 0.5, roadBottom);\n  ctx.lineTo(roadCenterX - roadWidth * 0.5, roadBottom);\n  ctx.closePath();\n  ctx.fill();\n\n  ctx.strokeStyle = COLORS.mirrorLine;\n  ctx.lineWidth = 1;\n  ctx.setLineDash([4, 4]);\n  ctx.beginPath();\n  ctx.moveTo(roadCenterX, roadTop);\n  ctx.lineTo(roadCenterX, roadBottom);\n  ctx.stroke();\n  ctx.setLineDash([]);\n\n  const sortedCars = [...mirrorCars].sort((a, b) => b.distance - a.distance);\n\n  for (const car of sortedCars) {\n    const perspectiveScale = 0.4 + (1 - car.distance) * 0.6;\n    const carX = roadCenterX + car.offset * roadWidth * 0.4 * perspectiveScale;\n    const carY = roadTop + (roadBottom - roadTop) * (1 - car.distance * 0.8);\n    const carW = 16 * perspectiveScale;\n    const carH = 10 * perspectiveScale;\n\n    ctx.fillStyle = \"rgba(0, 0, 0, 0.3)\";\n    ctx.fillRect(carX - carW / 2 + 1, carY - carH / 2 + 1, carW, carH);\n\n    ctx.fillStyle = car.color;\n    ctx.fillRect(carX - carW / 2, carY - carH / 2, carW, carH);\n\n    ctx.fillStyle = \"rgba(255, 255, 255, 0.3)\";\n    ctx.fillRect(carX - carW / 2, carY - carH / 2, carW, carH * 0.3);\n  }\n\n  ctx.font = '10px \"Courier New\", monospace';\n  ctx.fillStyle = \"#666666\";\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"bottom\";\n  ctx.fillText(\" REAR VIEW \", x + width / 2, y + height - 2);\n};\n\nconst renderSpeedPanel = (\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  speed: number,\n  maxSpeed: number,\n): void => {\n  const panelWidth = 180;\n  const panelHeight = 80;\n\n  ctx.fillStyle = COLORS.background;\n  ctx.fillRect(x, y, panelWidth, panelHeight);\n  ctx.strokeStyle = \"#555\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(x, y, panelWidth, panelHeight);\n\n  const speedKmh = Math.round(speed);\n  const percent = speed / maxSpeed;\n\n  drawBlockyText(\n    ctx,\n    `${speedKmh.toString().padStart(3, \"0\")} KMH`,\n    x + 15,\n    y + 10,\n    24,\n    COLORS.speed,\n  );\n\n  const barX = x + 15;\n  const barY = y + 45;\n  const barWidth = panelWidth - 30;\n  const barHeight = 14;\n\n  ctx.fillStyle = COLORS.barBg;\n  ctx.fillRect(barX, barY, barWidth, barHeight);\n\n  const fillColor =\n    percent > 0.8\n      ? COLORS.barRed\n      : percent > 0.5\n        ? COLORS.barYellow\n        : COLORS.barGreen;\n  const fillWidth = Math.max(0, Math.min(1, percent)) * barWidth;\n  ctx.fillStyle = fillColor;\n  ctx.fillRect(barX, barY, fillWidth, barHeight);\n\n  ctx.strokeStyle = \"#666\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(barX, barY, barWidth, barHeight);\n\n  for (let i = 1; i < 4; i++) {\n    const lineX = barX + (barWidth / 4) * i;\n    ctx.beginPath();\n    ctx.moveTo(lineX, barY);\n    ctx.lineTo(lineX, barY + barHeight);\n    ctx.strokeStyle = \"rgba(255, 255, 255, 0.2)\";\n    ctx.stroke();\n  }\n};\n\nconst renderPositionPanel = (\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  position: number,\n  totalPositions: number,\n): void => {\n  const panelWidth = 120;\n  const panelHeight = 80;\n\n  ctx.fillStyle = COLORS.background;\n  ctx.fillRect(x, y, panelWidth, panelHeight);\n  ctx.strokeStyle = \"#555\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(x, y, panelWidth, panelHeight);\n\n  const posText = `${position}${getPositionSuffix(position)}`;\n  const posColor = position === 1 ? COLORS.barYellow : COLORS.position;\n\n  ctx.font = `bold 48px \"Courier New\", monospace`;\n  ctx.fillStyle = \"rgba(0, 0, 0, 0.5)\";\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"top\";\n  ctx.fillText(posText, x + panelWidth / 2 + 2, y + 8);\n\n  ctx.fillStyle = posColor;\n  ctx.fillText(posText, x + panelWidth / 2, y + 6);\n\n  ctx.font = '14px \"Courier New\", monospace';\n  ctx.fillStyle = \"#888888\";\n  ctx.fillText(`OF ${totalPositions}`, x + panelWidth / 2, y + 58);\n};\n\nconst renderTimerPanel = (\n  ctx: CanvasRenderingContext2D,\n  state: TimeChallengeState,\n  x: number,\n  y: number,\n): void => {\n  const panelWidth = 160;\n  const panelHeight = 70;\n\n  ctx.fillStyle = COLORS.background;\n  ctx.fillRect(x, y, panelWidth, panelHeight);\n  ctx.strokeStyle = \"#555\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(x, y, panelWidth, panelHeight);\n\n  const isRaceMode = state.gameMode === \"race\";\n  const timerColor =\n    !isRaceMode && state.currentTime < 10 ? COLORS.timerLow : COLORS.timer;\n\n  drawBlockyText(\n    ctx,\n    isRaceMode ? \"RACE TIME\" : \"TIME\",\n    x + 15,\n    y + 8,\n    14,\n    \"#888888\",\n  );\n  drawBlockyText(\n    ctx,\n    formatTimeDisplay(state.currentTime),\n    x + 15,\n    y + 28,\n    28,\n    timerColor,\n  );\n};\n\nconst renderScorePanel = (\n  ctx: CanvasRenderingContext2D,\n  score: number,\n  x: number,\n  y: number,\n): void => {\n  const panelWidth = 180;\n  const panelHeight = 45;\n\n  ctx.fillStyle = COLORS.background;\n  ctx.fillRect(x, y, panelWidth, panelHeight);\n  ctx.strokeStyle = \"#555\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(x, y, panelWidth, panelHeight);\n\n  drawBlockyText(ctx, \"SCORE\", x + 15, y + 8, 14, \"#888888\");\n  drawBlockyText(ctx, formatScore(score), x + 15, y + 24, 18, COLORS.score);\n};\n\nconst renderLapPanel = (\n  ctx: CanvasRenderingContext2D,\n  lap: number,\n  totalLaps: number,\n  x: number,\n  y: number,\n): void => {\n  const panelWidth = 120;\n  const panelHeight = 45;\n\n  ctx.fillStyle = COLORS.background;\n  ctx.fillRect(x, y, panelWidth, panelHeight);\n  ctx.strokeStyle = \"#555\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(x, y, panelWidth, panelHeight);\n\n  drawBlockyText(ctx, \"LAP\", x + 15, y + 8, 14, \"#888888\");\n  drawBlockyText(ctx, `${lap}/${totalLaps}`, x + 15, y + 24, 18, COLORS.lap);\n};\n\nconst renderBoostPanel = (\n  ctx: CanvasRenderingContext2D,\n  boostMeter: number,\n  x: number,\n  y: number,\n): void => {\n  const panelWidth = 100;\n  const panelHeight = 45;\n\n  ctx.fillStyle = COLORS.background;\n  ctx.fillRect(x, y, panelWidth, panelHeight);\n  ctx.strokeStyle = \"#555\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(x, y, panelWidth, panelHeight);\n\n  drawBlockyText(ctx, \"NITRO\", x + 10, y + 8, 12, \"#888888\");\n\n  const barX = x + 10;\n  const barY = y + 26;\n  const barWidth = panelWidth - 20;\n  const barHeight = 10;\n\n  ctx.fillStyle = COLORS.barBg;\n  ctx.fillRect(barX, barY, barWidth, barHeight);\n\n  const fillColor = boostMeter < 0.3 ? COLORS.barRed : COLORS.boost;\n  const fillWidth = Math.max(0, Math.min(1, boostMeter)) * barWidth;\n  ctx.fillStyle = fillColor;\n  ctx.fillRect(barX, barY, fillWidth, barHeight);\n\n  ctx.strokeStyle = \"#666\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(barX, barY, barWidth, barHeight);\n};\n\nexport const renderHud = (\n  ctx: CanvasRenderingContext2D,\n  state: TimeChallengeState,\n  speed: number,\n  config: HudConfig,\n  hudState: Partial<HudState> = {},\n): void => {\n  const { width, height } = config;\n  const hs = { ...DEFAULT_HUD_STATE, ...hudState, speed };\n\n  const padding = 15;\n  const mirrorWidth = 220;\n  const mirrorHeight = 100;\n  const mirrorX = width / 2 - mirrorWidth / 2;\n  const mirrorY = padding;\n\n  renderRearViewMirror(\n    ctx,\n    mirrorX,\n    mirrorY,\n    mirrorWidth,\n    mirrorHeight,\n    hs.mirrorCars,\n  );\n\n  const leftColumnX = padding;\n  const rightColumnX = width - padding;\n  const row1Y = mirrorY + mirrorHeight + 15;\n  const row2Y = row1Y + 90;\n  const row3Y = row2Y + 55;\n\n  renderSpeedPanel(ctx, leftColumnX, row1Y, hs.speed, hs.maxSpeed);\n  renderPositionPanel(ctx, leftColumnX, row2Y, hs.position, hs.totalPositions);\n\n  renderTimerPanel(ctx, state, rightColumnX - 160, row1Y);\n  renderScorePanel(ctx, state.score, rightColumnX - 180, row2Y);\n  renderLapPanel(ctx, state.lap, state.totalLaps, rightColumnX - 120, row3Y);\n  renderBoostPanel(ctx, hs.boostMeter, rightColumnX - 230, row3Y);\n};\n\nexport const renderPauseOverlay = (\n  ctx: CanvasRenderingContext2D,\n  canvasWidth: number,\n  canvasHeight: number,\n): void => {\n  ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n  ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n  ctx.font = 'bold 48px \"Courier New\", monospace';\n  ctx.fillStyle = \"#ffffff\";\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"middle\";\n  ctx.fillText(\"PAUSED\", canvasWidth / 2, canvasHeight / 2 - 40);\n\n  ctx.font = '24px \"Courier New\", monospace';\n  ctx.fillStyle = \"#888888\";\n  ctx.fillText(\"Press P to resume\", canvasWidth / 2, canvasHeight / 2 + 20);\n\n  ctx.fillStyle = \"#666666\";\n  ctx.fillText(\n    \"Press F for fullscreen\",\n    canvasWidth / 2,\n    canvasHeight / 2 + 55,\n  );\n};\n\nexport const renderCountdown = (\n  ctx: CanvasRenderingContext2D,\n  canvasWidth: number,\n  canvasHeight: number,\n  count: number,\n): void => {\n  const text = count > 0 ? count.toString() : \"GO!\";\n  const color = count > 0 ? \"#ffcc00\" : \"#00ff88\";\n\n  ctx.font = 'bold 96px \"Courier New\", monospace';\n  ctx.fillStyle = color;\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"middle\";\n\n  ctx.fillStyle = \"rgba(0, 0, 0, 0.4)\";\n  ctx.fillText(text, canvasWidth / 2 + 4, canvasHeight / 2 + 4);\n\n  ctx.fillStyle = color;\n  ctx.fillText(text, canvasWidth / 2, canvasHeight / 2);\n};\n\nexport const renderCheckpointBonus = (\n  ctx: CanvasRenderingContext2D,\n  canvasWidth: number,\n  y: number,\n  bonus: number,\n): void => {\n  ctx.font = 'bold 32px \"Courier New\", monospace';\n  ctx.fillStyle = \"#00ff88\";\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"middle\";\n  ctx.fillText(`+${bonus} TIME BONUS!`, canvasWidth / 2, y);\n};\n\nexport const renderLapComplete = (\n  ctx: CanvasRenderingContext2D,\n  canvasWidth: number,\n  y: number,\n  lap: number,\n): void => {\n  ctx.font = 'bold 36px \"Courier New\", monospace';\n  ctx.fillStyle = \"#00ccff\";\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"middle\";\n  ctx.fillText(`LAP ${lap} COMPLETE!`, canvasWidth / 2, y);\n};\n\nexport interface SplitScreenHudConfig {\n  width: number;\n  height: number;\n  x: number;\n  y: number;\n  playerIndex: number;\n}\n\nexport const renderSplitScreenHud = (\n  ctx: CanvasRenderingContext2D,\n  state: TimeChallengeState,\n  speed: number,\n  config: SplitScreenHudConfig,\n  hudState: Partial<HudState> = {},\n): void => {\n  const { width, height, x: viewportX, y: viewportY } = config;\n  const hs = { ...DEFAULT_HUD_STATE, ...hudState, speed };\n\n  ctx.save();\n  ctx.translate(viewportX, viewportY);\n\n  const scaleX = width / 1024;\n  const scaleY = height / 768;\n  const scale = Math.min(scaleX, scaleY);\n\n  const padding = Math.max(8, 15 * scale);\n  const mirrorWidth = Math.max(110, 220 * scale);\n  const mirrorHeight = Math.max(50, 100 * scale);\n  const mirrorX = width / 2 - mirrorWidth / 2;\n  const mirrorY = padding;\n\n  renderRearViewMirror(\n    ctx,\n    mirrorX,\n    mirrorY,\n    mirrorWidth,\n    mirrorHeight,\n    hs.mirrorCars,\n  );\n\n  const leftColumnX = padding;\n  const rightColumnX = width - padding;\n  const row1Y = mirrorY + mirrorHeight + padding;\n  const row2Y = row1Y + 90 * scale;\n  const row3Y = row2Y + 55 * scale;\n\n  const speedPanelWidth = Math.max(100, 180 * scale);\n  const speedPanelHeight = Math.max(45, 80 * scale);\n  renderCompactSpeedPanel(\n    ctx,\n    leftColumnX,\n    row1Y,\n    speedPanelWidth,\n    speedPanelHeight,\n    hs.speed,\n    hs.maxSpeed,\n  );\n\n  renderCompactPositionPanel(\n    ctx,\n    leftColumnX,\n    row2Y,\n    Math.max(70, 120 * scale),\n    Math.max(45, 80 * scale),\n    hs.position,\n    hs.totalPositions,\n  );\n\n  renderCompactTimerPanel(\n    ctx,\n    state,\n    rightColumnX - Math.max(80, 160 * scale),\n    row1Y,\n    Math.max(80, 160 * scale),\n    Math.max(40, 70 * scale),\n  );\n\n  renderCompactLapPanel(\n    ctx,\n    state.lap,\n    state.totalLaps,\n    rightColumnX - Math.max(60, 120 * scale),\n    row2Y,\n    Math.max(60, 120 * scale),\n    Math.max(30, 45 * scale),\n  );\n\n  ctx.restore();\n};\n\nconst renderCompactSpeedPanel = (\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  panelWidth: number,\n  panelHeight: number,\n  speed: number,\n  maxSpeed: number,\n): void => {\n  ctx.fillStyle = COLORS.background;\n  ctx.fillRect(x, y, panelWidth, panelHeight);\n  ctx.strokeStyle = \"#555\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(x, y, panelWidth, panelHeight);\n\n  const speedKmh = Math.round(speed);\n  const percent = speed / maxSpeed;\n  const fontSize = Math.max(14, panelHeight * 0.35);\n\n  drawBlockyText(\n    ctx,\n    `${speedKmh.toString().padStart(3, \"0\")}`,\n    x + panelWidth * 0.5,\n    y + panelHeight * 0.25,\n    fontSize,\n    COLORS.speed,\n    \"center\",\n  );\n\n  const barX = x + panelWidth * 0.1;\n  const barY = y + panelHeight * 0.6;\n  const barWidth = panelWidth * 0.8;\n  const barHeight = panelHeight * 0.2;\n\n  ctx.fillStyle = COLORS.barBg;\n  ctx.fillRect(barX, barY, barWidth, barHeight);\n\n  const fillColor =\n    percent > 0.8\n      ? COLORS.barRed\n      : percent > 0.5\n        ? COLORS.barYellow\n        : COLORS.barGreen;\n  const fillWidth = Math.max(0, Math.min(1, percent)) * barWidth;\n  ctx.fillStyle = fillColor;\n  ctx.fillRect(barX, barY, fillWidth, barHeight);\n\n  ctx.strokeStyle = \"#666\";\n  ctx.strokeRect(barX, barY, barWidth, barHeight);\n};\n\nconst renderCompactPositionPanel = (\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  panelWidth: number,\n  panelHeight: number,\n  position: number,\n  totalPositions: number,\n): void => {\n  ctx.fillStyle = COLORS.background;\n  ctx.fillRect(x, y, panelWidth, panelHeight);\n  ctx.strokeStyle = \"#555\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(x, y, panelWidth, panelHeight);\n\n  const posText = `${position}${getPositionSuffix(position)}`;\n  const posColor = position === 1 ? COLORS.barYellow : COLORS.position;\n  const fontSize = Math.max(18, panelHeight * 0.5);\n\n  ctx.font = `bold ${fontSize}px \"Courier New\", monospace`;\n  ctx.fillStyle = \"rgba(0, 0, 0, 0.5)\";\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"top\";\n  ctx.fillText(posText, x + panelWidth / 2 + 2, y + 8);\n\n  ctx.fillStyle = posColor;\n  ctx.fillText(posText, x + panelWidth / 2, y + 6);\n\n  const labelFontSize = Math.max(10, panelHeight * 0.2);\n  ctx.font = `${labelFontSize}px \"Courier New\", monospace`;\n  ctx.fillStyle = \"#888888\";\n  ctx.fillText(\n    `OF ${totalPositions}`,\n    x + panelWidth / 2,\n    y + panelHeight - labelFontSize - 5,\n  );\n};\n\nconst renderCompactTimerPanel = (\n  ctx: CanvasRenderingContext2D,\n  state: TimeChallengeState,\n  x: number,\n  y: number,\n  panelWidth: number,\n  panelHeight: number,\n): void => {\n  ctx.fillStyle = COLORS.background;\n  ctx.fillRect(x, y, panelWidth, panelHeight);\n  ctx.strokeStyle = \"#555\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(x, y, panelWidth, panelHeight);\n\n  const isRaceMode = state.gameMode === \"race\";\n  const timerColor =\n    !isRaceMode && state.currentTime < 10 ? COLORS.timerLow : COLORS.timer;\n  const fontSize = Math.max(12, panelHeight * 0.45);\n\n  drawBlockyText(\n    ctx,\n    isRaceMode ? \"RACE TIME\" : \"TIME\",\n    x + panelWidth * 0.1,\n    y + panelHeight * 0.1,\n    fontSize * 0.5,\n    \"#888888\",\n  );\n  drawBlockyText(\n    ctx,\n    formatTimeDisplay(state.currentTime),\n    x + panelWidth * 0.1,\n    y + panelHeight * 0.4,\n    fontSize,\n    timerColor,\n  );\n};\n\nconst renderCompactLapPanel = (\n  ctx: CanvasRenderingContext2D,\n  lap: number,\n  totalLaps: number,\n  x: number,\n  y: number,\n  panelWidth: number,\n  panelHeight: number,\n): void => {\n  ctx.fillStyle = COLORS.background;\n  ctx.fillRect(x, y, panelWidth, panelHeight);\n  ctx.strokeStyle = \"#555\";\n  ctx.lineWidth = 1;\n  ctx.strokeRect(x, y, panelWidth, panelHeight);\n\n  const fontSize = Math.max(12, panelHeight * 0.5);\n\n  drawBlockyText(\n    ctx,\n    \"LAP\",\n    x + panelWidth * 0.1,\n    y + panelHeight * 0.1,\n    fontSize * 0.5,\n    \"#888888\",\n  );\n  drawBlockyText(\n    ctx,\n    `${lap}/${totalLaps}`,\n    x + panelWidth * 0.1,\n    y + panelHeight * 0.4,\n    fontSize,\n    COLORS.lap,\n  );\n};\n\nexport const createDefaultHudState = (): HudState => ({ ...DEFAULT_HUD_STATE });\n\nexport type { HudState as HudStateType };\n","import { KEY, THEMES, THEME_ORDER, COLORS } from \"./engine/constants\";\nimport type { LevelTheme } from \"./engine/types\";\nimport {\n  createWorld,\n  update,\n  handleKeyDown,\n  handleKeyUp,\n  resetCars,\n  getMirrorCars,\n  setTheme,\n  updateWind,\n  updateJump,\n  updateParticles,\n  updateTumbleweeds,\n  updateLightning,\n  updateSlidePhysics,\n} from \"./engine/world\";\nimport * as Render from \"./engine/renderer/canvas\";\nimport * as SvgRender from \"./engine/renderer/sprite\";\nimport * as Util from \"./engine/utils/math\";\nimport * as Segments from \"./engine/segments\";\nimport {\n  globalSpriteCache,\n  preloadGameSprites,\n  getSpriteByName,\n  type CachedSprite,\n} from \"./assets/svg-loader\";\nimport {\n  setMusicVolume,\n  stopGameMusic,\n  loadAndPlayTrack,\n  isSoundEnabled,\n  toggleSound,\n  startEngineSound,\n  stopEngineSound,\n  updateEngineSound,\n  playCollisionSound,\n} from \"./audio/mod-player\";\nimport {\n  createTimeChallengeState,\n  type TimeChallengeState,\n  updateTimer,\n  startRace,\n  pauseGame,\n  resumeGame,\n  returnToMenu,\n  completeLap,\n  checkCheckpoint,\n  toggleGameMode,\n  DEFAULT_TIME_LIMIT,\n  calculateTimeLimit,\n} from \"./game/modes/time-challenge\";\nimport {\n  createMultiplayerRaceState,\n  type MultiplayerRaceState,\n  startRace as startMultiplayerRace,\n  updateRaceCountdown,\n  checkLapComplete,\n  isCountdownActive,\n  getCountdownDisplay,\n} from \"./game/modes/race\";\nimport {\n  InputManager,\n  DEFAULT_P1_INPUT,\n  DEFAULT_P2_INPUT,\n} from \"./engine/input\";\nimport { resolveAllPlayerCollisions } from \"./engine/collision\";\nimport type { Viewport } from \"./engine/types\";\nimport {\n  createScreens,\n  type Button,\n  type MenuZone,\n  type UIScreen,\n  MusicSelectionScreen,\n  RECSScreen,\n  MainMenuScreen,\n  MUSIC_TRACKS,\n} from \"./ui/screens/screens\";\nimport {\n  renderHud,\n  renderSplitScreenHud,\n  renderPauseOverlay,\n  renderCountdown,\n  createDefaultHudState,\n  type HudStateType,\n} from \"./ui/hud/hud\";\n\nconst canvas = document.getElementById(\"canvas\") as HTMLCanvasElement | null;\n\nif (!canvas) {\n  throw new Error(\"Canvas element not found\");\n}\n\nconst ctx = canvas.getContext(\"2d\");\nif (!ctx) {\n  throw new Error(\"Could not get 2d context\");\n}\n\nconst BASE_WIDTH = 1024;\nconst BASE_HEIGHT = 768;\nconst ASPECT_RATIO = BASE_WIDTH / BASE_HEIGHT;\n\nlet world = createWorld();\nconst step = 1 / world.config.fps;\n\nlet svgBackground: CachedSprite | null = null;\nlet svgPlayerCarStraight: CachedSprite | null = null;\nlet svgPlayerCarLeft: CachedSprite | null = null;\nlet svgPlayerCarRight: CachedSprite | null = null;\nlet last = Util.timestamp();\nlet gdt = 0;\n\nlet gameState = createTimeChallengeState(\n  world.trackLength,\n  world.config.segmentLength,\n);\nlet screens = createScreens(world.config.width, world.config.height);\nlet hudState = createDefaultHudState();\n\nlet playerCount: 1 | 2 = 1;\nlet inputManager = new InputManager(playerCount);\nlet multiRaceState = createMultiplayerRaceState(playerCount);\n\nconst cameraDepth = 1 / Math.tan(((100 / 2) * Math.PI) / 180);\nconst cameraHeight = 1000;\nconst playerZ = world.player.z;\nlet resolution = world.config.height / 480;\n\nlet countdown = 0;\nlet countdownTimer = 0;\n\nlet isFullscreen = false;\nconst TRAFFIC_CAR_COUNT = 20;\nlet selectedThemeId: string = \"night\";\n\nconst getSelectedTheme = (): LevelTheme => {\n  return THEMES[selectedThemeId] ?? THEMES[\"night\"]!;\n};\n\nconst setCanvasSize = (width?: number, height?: number) => {\n  const viewportWidth = width ?? window.innerWidth;\n  const viewportHeight = height ?? window.innerHeight;\n\n  const scale = Math.min(\n    viewportWidth / BASE_WIDTH,\n    viewportHeight / BASE_HEIGHT,\n  );\n  const canvasWidth = Math.floor(BASE_WIDTH * scale);\n  const canvasHeight = Math.floor(BASE_HEIGHT * scale);\n\n  canvas.width = canvasWidth;\n  canvas.height = canvasHeight;\n  canvas.style.width = `${canvasWidth}px`;\n  canvas.style.height = `${canvasHeight}px`;\n\n  world.config.width = canvasWidth;\n  world.config.height = canvasHeight;\n  resolution = canvasHeight / 480;\n  screens = createScreens(world.config.width, world.config.height);\n};\n\nconst toggleFullscreen = async () => {\n  try {\n    if (!document.fullscreenElement) {\n      await document.documentElement.requestFullscreen();\n      isFullscreen = true;\n      const screenWidth = window.screen.width;\n      const screenHeight = window.screen.height;\n      canvas.width = screenWidth;\n      canvas.height = screenHeight;\n      canvas.style.width = `${screenWidth}px`;\n      canvas.style.height = `${screenHeight}px`;\n      world.config.width = screenWidth;\n      world.config.height = screenHeight;\n      resolution = screenHeight / 480;\n      screens = createScreens(world.config.width, world.config.height);\n    } else {\n      await document.exitFullscreen();\n      isFullscreen = false;\n      setCanvasSize();\n    }\n  } catch (err) {\n    console.warn(\"Fullscreen not available:\", err);\n  }\n};\n\nconst exitFullscreen = async () => {\n  if (document.fullscreenElement) {\n    await document.exitFullscreen();\n    isFullscreen = false;\n    setCanvasSize();\n  }\n};\n\ndocument.addEventListener(\"fullscreenchange\", () => {\n  if (!document.fullscreenElement && isFullscreen) {\n    isFullscreen = false;\n    setCanvasSize();\n  }\n});\n\nconst loadSvgSprites = async (): Promise<void> => {\n  await preloadGameSprites();\n  svgBackground = globalSpriteCache.get(\"background-level-1.svg\", 1);\n  svgPlayerCarStraight = globalSpriteCache.get(\"player-car.svg\", 0.5);\n  svgPlayerCarLeft = globalSpriteCache.get(\"player-car-right.svg\", 0.5);\n  svgPlayerCarRight = globalSpriteCache.get(\"player-car-left.svg\", 0.5);\n};\n\nconst SPRITE_NAME_MAP = new Map<string, string>([\n  [\"215_540_5\", \"PALM_TREE\"],\n  [\"385_265_230\", \"BILLBOARD08\"],\n  [\"360_360_625\", \"TREE1\"],\n  [\"135_332_5\", \"DEAD_TREE1\"],\n  [\"328_282_150\", \"BILLBOARD09\"],\n  [\"320_220_230\", \"BOULDER3\"],\n  [\"200_315_995\", \"COLUMN\"],\n  [\"300_170_625\", \"BILLBOARD01\"],\n  [\"298_190_488\", \"BILLBOARD06\"],\n  [\"298_190_5\", \"BILLBOARD05\"],\n  [\"298_190_313\", \"BILLBOARD07\"],\n  [\"298_140_621\", \"BOULDER2\"],\n  [\"282_295_1205\", \"TREE2\"],\n  [\"268_170_1205\", \"BILLBOARD04\"],\n  [\"150_260_1205\", \"DEAD_TREE2\"],\n  [\"168_248_1205\", \"BOULDER1\"],\n  [\"240_155_5\", \"BUSH1\"],\n  [\"235_118_929\", \"CACTUS\"],\n  [\"232_152_255\", \"BUSH2\"],\n  [\"230_220_5\", \"BILLBOARD03\"],\n  [\"215_220_245\", \"BILLBOARD02\"],\n  [\"195_140_995\", \"STUMP\"],\n  [\"122_144_1365\", \"SEMI\"],\n  [\"100_78_1365\", \"TRUCK\"],\n  [\"88_55_1383\", \"CAR03\"],\n  [\"80_59_1383\", \"CAR02\"],\n  [\"80_57_1383\", \"CAR04\"],\n  [\"80_56_1205\", \"CAR01\"],\n]);\n\nconst getSpriteName = (\n  sprite: { x: number; y: number; w: number; h: number },\n  overrides?: Record<string, string>,\n): string | null => {\n  const key = `${sprite.w}_${sprite.h}_${sprite.x}`;\n  const name = SPRITE_NAME_MAP.get(key) ?? null;\n  if (name && overrides && overrides[name]) {\n    return overrides[name];\n  }\n  return name;\n};\n\nconst getPlayerCarSprite = (steer: number): CachedSprite | null => {\n  if (steer < -0.5) return svgPlayerCarLeft;\n  if (steer > 0.5) return svgPlayerCarRight;\n  return svgPlayerCarStraight;\n};\n\nconst adjustColor = (hex: string, amount: number): string => {\n  const num = parseInt(hex.replace(\"#\", \"\"), 16);\n  const r = Math.min(255, Math.max(0, (num >> 16) + amount));\n  const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00ff) + amount));\n  const b = Math.min(255, Math.max(0, (num & 0x0000ff) + amount));\n  return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;\n};\n\nconst renderRacing = () => {\n  const { config, player, skyOffset, currentTheme } = world;\n  const {\n    width,\n    height,\n    lanes,\n    roadWidth,\n    segmentLength,\n    drawDistance,\n    fogDensity,\n  } = config;\n\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n  const theme = currentTheme ?? getSelectedTheme();\n  const fogColor = theme.colors.fog;\n  const skyColor = theme.colors.sky;\n\n  ctx.fillStyle = skyColor;\n  ctx.fillRect(0, 0, width, height / 2);\n\n  const baseSegment = Segments.findSegment(player.position, segmentLength);\n  const basePercent = Util.percentRemaining(player.position, segmentLength);\n  const playerSegment = Segments.findSegment(\n    player.position + playerZ,\n    segmentLength,\n  );\n  const playerPercent = Util.percentRemaining(\n    player.position + playerZ,\n    segmentLength,\n  );\n  const playerY = Util.interpolate(\n    playerSegment.p1.world.y,\n    playerSegment.p2.world.y,\n    playerPercent,\n  );\n  let maxy = height;\n\n  let x = 0;\n  let dx = -(baseSegment.curve * basePercent);\n\n  if (svgBackground) {\n    ctx.save();\n    if (theme.filters.background) {\n      ctx.filter = theme.filters.background;\n    }\n    SvgRender.svgBackground(\n      ctx,\n      svgBackground,\n      width,\n      height,\n      skyOffset,\n      resolution * 0.001 * playerY,\n    );\n    ctx.restore();\n  }\n\n  const themeColors = {\n    light: theme.colors.road,\n    dark: {\n      ...theme.colors.road,\n      road: adjustColor(theme.colors.road.road, -15),\n      grass: adjustColor(theme.colors.road.grass, -15),\n      rumble: adjustColor(theme.colors.road.rumble, -15),\n    },\n  };\n\n  for (let n = 0; n < drawDistance; n++) {\n    const segmentIndex = (baseSegment.index + n) % world.segments.length;\n    const segment = world.segments[segmentIndex];\n    if (!segment) continue;\n\n    segment.looped = segment.index < baseSegment.index;\n    segment.fog = Util.exponentialFog(\n      n / drawDistance,\n      theme.effects.fogDensity,\n    );\n    segment.clip = maxy;\n\n    Util.project(\n      segment.p1,\n      player.x * roadWidth - x,\n      playerY + cameraHeight - (world.jumpState.peakHeight || 0) * 50,\n      player.position - (segment.looped ? world.trackLength : 0),\n      cameraDepth,\n      width,\n      height,\n      roadWidth,\n    );\n    Util.project(\n      segment.p2,\n      player.x * roadWidth - x - dx,\n      playerY + cameraHeight - (world.jumpState.peakHeight || 0) * 50,\n      player.position - (segment.looped ? world.trackLength : 0),\n      cameraDepth,\n      width,\n      height,\n      roadWidth,\n    );\n\n    x += dx;\n    dx += segment.curve;\n\n    if (\n      segment.p1.camera.z <= cameraDepth ||\n      segment.p2.screen.y >= segment.p1.screen.y ||\n      segment.p2.screen.y >= maxy\n    ) {\n      continue;\n    }\n\n    const segmentColor =\n      Math.floor(segment.index / config.rumbleLength) % 2\n        ? themeColors.light\n        : themeColors.dark;\n\n    Render.segment(\n      ctx,\n      width,\n      lanes,\n      segment.p1.screen.x,\n      segment.p1.screen.y,\n      segment.p1.screen.w ?? 0,\n      segment.p2.screen.x,\n      segment.p2.screen.y,\n      segment.p2.screen.w ?? 0,\n      segment.fog ?? 0,\n      segmentColor,\n    );\n\n    Render.fogLayer(\n      ctx,\n      0,\n      segment.p2.screen.y,\n      width,\n      segment.p1.screen.y - segment.p2.screen.y,\n      segment.fog ?? 0,\n      fogColor,\n    );\n\n    maxy = segment.p1.screen.y;\n  }\n\n  for (let n = drawDistance - 1; n > 0; n--) {\n    const segmentIndex = (baseSegment.index + n) % world.segments.length;\n    const segment = world.segments[segmentIndex];\n    if (!segment) continue;\n\n    for (const car of segment.cars) {\n      const spriteScale = Util.interpolate(\n        segment.p1.screen.scale,\n        segment.p2.screen.scale,\n        car.percent ?? 0,\n      );\n      const spriteX =\n        Util.interpolate(\n          segment.p1.screen.x,\n          segment.p2.screen.x,\n          car.percent ?? 0,\n        ) +\n        (spriteScale * car.offset * roadWidth * width) / 2;\n      const spriteY = Util.interpolate(\n        segment.p1.screen.y,\n        segment.p2.screen.y,\n        car.percent ?? 0,\n      );\n\n      const spriteName = getSpriteName(\n        car.sprite,\n        world.currentTheme?.spriteOverrides,\n      );\n      if (spriteName) {\n        const cachedSprite = getSpriteByName(spriteName, spriteScale);\n        if (cachedSprite) {\n          SvgRender.svgSprite(\n            ctx,\n            cachedSprite,\n            width,\n            roadWidth,\n            spriteScale,\n            spriteX,\n            spriteY,\n            -0.5,\n            -1,\n            segment.clip ?? 0,\n            car.sprite.w,\n            car.sprite.h,\n          );\n        }\n      }\n    }\n\n    for (const sprite of segment.sprites) {\n      const spriteScale = segment.p1.screen.scale;\n      const spriteX =\n        segment.p1.screen.x +\n        (spriteScale * sprite.offset * roadWidth * width) / 2;\n      const spriteY = segment.p1.screen.y;\n\n      const spriteName = getSpriteName(\n        sprite.source,\n        world.currentTheme?.spriteOverrides,\n      );\n      if (spriteName) {\n        const cachedSprite = getSpriteByName(spriteName, spriteScale);\n        if (cachedSprite) {\n          SvgRender.svgSprite(\n            ctx,\n            cachedSprite,\n            width,\n            roadWidth,\n            spriteScale,\n            spriteX,\n            spriteY,\n            sprite.offset < 0 ? -1 : 0,\n            -1,\n            segment.clip ?? 0,\n            sprite.source.w,\n            sprite.source.h,\n          );\n        }\n      }\n    }\n\n    if (segment === playerSegment) {\n      const playerScale = cameraDepth / playerZ;\n      const playerScreenY =\n        height / 2 -\n        (playerScale *\n          Util.interpolate(\n            playerSegment.p1.camera.y,\n            playerSegment.p2.camera.y,\n            playerPercent,\n          ) *\n          height) /\n          2;\n      const speedPercent = player.speed / config.maxSpeed;\n      const bounce =\n        1.5 *\n        Math.random() *\n        speedPercent *\n        resolution *\n        (Math.random() > 0.5 ? 1 : -1);\n      const steer =\n        player.speed * (world.input.left ? -1 : world.input.right ? 1 : 0);\n\n      const playerSprite = getPlayerCarSprite(steer);\n\n      if (playerSprite) {\n        SvgRender.svgPlayer(\n          ctx,\n          playerSprite,\n          width,\n          height,\n          roadWidth,\n          speedPercent,\n          playerScale,\n          width / 2,\n          playerScreenY,\n          steer,\n          bounce,\n        );\n      }\n    }\n  }\n\n  const mirrorRange = world.trackLength * 0.08;\n  const mirrorCars = getMirrorCars(\n    world.cars,\n    player.position,\n    world.trackLength,\n    mirrorRange,\n    3,\n  );\n\n  const speed = (player.speed / config.maxSpeed) * 300;\n\n  let playerPosition = 1;\n  for (const car of world.cars) {\n    if (car.z > player.position) {\n      playerPosition++;\n    }\n  }\n\n  Render.renderParticles(ctx, world.particles, new Map());\n\n  for (const weed of world.tumbleweeds) {\n    const relZ = weed.z - player.position;\n    if (relZ > 0 && relZ < 8000) {\n      const distanceScale = 1 - relZ / 8000;\n      const scale = 0.5 + distanceScale * 0.8;\n      const screenY = height * 0.75 + distanceScale * 100;\n      const screenX = width / 2 + weed.x * width * 0.25;\n      const cachedWeed = globalSpriteCache.get(\"tumbleweed.svg\", scale);\n      if (cachedWeed) {\n        Render.renderTumbleweed(\n          ctx,\n          { x: screenX, y: screenY, rotation: weed.rotation, scale },\n          cachedWeed,\n        );\n      }\n    }\n  }\n\n  if (world.lightningActive && theme.effects.lightning) {\n    Render.lightningFlash(\n      ctx,\n      width,\n      height,\n      theme.effects.lightning.flashIntensity,\n    );\n  }\n\n  hudState = {\n    ...hudState,\n    speed,\n    maxSpeed: 300,\n    position: Math.min(playerPosition, TRAFFIC_CAR_COUNT + 1),\n    totalPositions: TRAFFIC_CAR_COUNT + 1,\n    mirrorCars: mirrorCars.slice(0, 3),\n    boostMeter: Math.min(1, gameState.currentTime / DEFAULT_TIME_LIMIT),\n  };\n\n  renderHud(\n    ctx,\n    gameState,\n    speed,\n    {\n      width,\n      height,\n    },\n    hudState,\n  );\n\n  if (countdown > 0) {\n    renderCountdown(ctx, width, height, countdown);\n  }\n\n  if (gameState.isPaused) {\n    renderPauseOverlay(ctx, width, height);\n  }\n};\n\nconst renderSplitScreen = () => {\n  const { width, height } = world.config;\n  const viewportWidth = width / 2;\n  const viewportHeight = height;\n\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n  // Draw divider\n  Render.drawSplitScreenDivider(ctx, width / 2, 0, height);\n\n  // Render each player's viewport\n  for (let i = 0; i < playerCount; i++) {\n    const player = world.players[i];\n    if (!player) continue;\n\n    const viewportX = i === 0 ? 0 : width / 2;\n\n    ctx.save();\n    ctx.beginPath();\n    ctx.rect(viewportX, 0, viewportWidth, viewportHeight);\n    ctx.clip();\n\n    // Store original player\n    const originalPlayer = world.player;\n    world.player = player;\n\n    // Render the world from this player's perspective\n    renderRacingForViewport(viewportX, viewportWidth, viewportHeight, i);\n\n    // Restore original player\n    world.player = originalPlayer;\n\n    ctx.restore();\n  }\n};\n\nconst renderRacingForViewport = (\n  viewportX: number,\n  viewportWidth: number,\n  viewportHeight: number,\n  playerIndex: number,\n) => {\n  const { config, player, skyOffset, currentTheme } = world;\n  const { lanes, roadWidth, segmentLength, drawDistance, fogDensity } = config;\n\n  const theme = currentTheme ?? getSelectedTheme();\n  const fogColor = theme.colors.fog;\n  const skyColor = theme.colors.sky;\n\n  // Scale everything to fit the viewport\n  const scaleX = viewportWidth / 1024;\n  const scaleY = viewportHeight / 768;\n  const scale = Math.min(scaleX, scaleY);\n\n  // Translate context so all rendering is relative to this viewport\n  ctx.save();\n  ctx.translate(viewportX, 0);\n\n  ctx.fillStyle = skyColor;\n  ctx.fillRect(0, 0, viewportWidth, viewportHeight / 2);\n\n  const baseSegment = Segments.findSegment(player.position, segmentLength);\n  const basePercent = Util.percentRemaining(player.position, segmentLength);\n  const playerSegment = Segments.findSegment(\n    player.position + playerZ,\n    segmentLength,\n  );\n  const playerPercent = Util.percentRemaining(\n    player.position + playerZ,\n    segmentLength,\n  );\n  const playerY = Util.interpolate(\n    playerSegment.p1.world.y,\n    playerSegment.p2.world.y,\n    playerPercent,\n  );\n  let maxy = viewportHeight;\n\n  let x = 0;\n  let dx = -(baseSegment.curve * basePercent);\n\n  if (svgBackground) {\n    ctx.save();\n    if (theme.filters.background) {\n      ctx.filter = theme.filters.background;\n    }\n    SvgRender.svgBackground(\n      ctx,\n      svgBackground,\n      viewportWidth,\n      viewportHeight,\n      skyOffset,\n      resolution * 0.001 * playerY,\n    );\n    ctx.restore();\n  }\n\n  const themeColors = {\n    light: theme.colors.road,\n    dark: {\n      ...theme.colors.road,\n      road: adjustColor(theme.colors.road.road, -15),\n      grass: adjustColor(theme.colors.road.grass, -15),\n      rumble: adjustColor(theme.colors.road.rumble, -15),\n    },\n  };\n\n  // Render road segments\n  for (let n = 0; n < drawDistance; n++) {\n    const segmentIndex = (baseSegment.index + n) % world.segments.length;\n    const segment = world.segments[segmentIndex];\n    if (!segment) continue;\n\n    segment.looped = segment.index < baseSegment.index;\n    segment.fog = Util.exponentialFog(\n      n / drawDistance,\n      theme.effects.fogDensity,\n    );\n    segment.clip = maxy;\n\n    Util.project(\n      segment.p1,\n      player.x * roadWidth - x,\n      playerY + cameraHeight - (world.jumpState.peakHeight || 0) * 50,\n      player.position - (segment.looped ? world.trackLength : 0),\n      cameraDepth,\n      viewportWidth,\n      viewportHeight,\n      roadWidth,\n    );\n    Util.project(\n      segment.p2,\n      player.x * roadWidth - x - dx,\n      playerY + cameraHeight - (world.jumpState.peakHeight || 0) * 50,\n      player.position - (segment.looped ? world.trackLength : 0),\n      cameraDepth,\n      viewportWidth,\n      viewportHeight,\n      roadWidth,\n    );\n\n    x += dx;\n    dx += segment.curve;\n\n    if (\n      segment.p1.camera.z <= cameraDepth ||\n      segment.p2.screen.y >= segment.p1.screen.y ||\n      segment.p2.screen.y >= maxy\n    ) {\n      continue;\n    }\n\n    const segmentColor =\n      Math.floor(segment.index / config.rumbleLength) % 2\n        ? themeColors.light\n        : themeColors.dark;\n\n    Render.segment(\n      ctx,\n      viewportWidth,\n      lanes,\n      segment.p1.screen.x,\n      segment.p1.screen.y,\n      segment.p1.screen.w ?? 0,\n      segment.p2.screen.x,\n      segment.p2.screen.y,\n      segment.p2.screen.w ?? 0,\n      segment.fog ?? 0,\n      segmentColor,\n    );\n\n    maxy = segment.p1.screen.y;\n  }\n\n  // Render sprites and cars\n  for (let n = drawDistance - 1; n > 0; n--) {\n    const segmentIndex = (baseSegment.index + n) % world.segments.length;\n    const segment = world.segments[segmentIndex];\n    if (!segment) continue;\n\n    // Render traffic cars\n    for (const car of segment.cars) {\n      const spriteScale = Util.interpolate(\n        segment.p1.screen.scale,\n        segment.p2.screen.scale,\n        car.percent ?? 0,\n      );\n      const spriteX =\n        Util.interpolate(\n          segment.p1.screen.x,\n          segment.p2.screen.x,\n          car.percent ?? 0,\n        ) +\n        (spriteScale * car.offset * roadWidth * viewportWidth) / 2;\n      const spriteY = Util.interpolate(\n        segment.p1.screen.y,\n        segment.p2.screen.y,\n        car.percent ?? 0,\n      );\n\n      const spriteName = getSpriteName(\n        car.sprite,\n        world.currentTheme?.spriteOverrides,\n      );\n      if (spriteName) {\n        const cachedSprite = getSpriteByName(spriteName, spriteScale);\n        if (cachedSprite) {\n          SvgRender.svgSprite(\n            ctx,\n            cachedSprite,\n            viewportWidth,\n            roadWidth,\n            spriteScale,\n            spriteX,\n            spriteY,\n            -0.5,\n            -1,\n            segment.clip ?? 0,\n            car.sprite.w,\n            car.sprite.h,\n          );\n        }\n      }\n    }\n\n    // Render scenery sprites\n    for (const sprite of segment.sprites) {\n      const spriteScale = segment.p1.screen.scale;\n      const spriteX =\n        segment.p1.screen.x +\n        (spriteScale * sprite.offset * roadWidth * viewportWidth) / 2;\n      const spriteY = segment.p1.screen.y;\n\n      const spriteName = getSpriteName(\n        sprite.source,\n        world.currentTheme?.spriteOverrides,\n      );\n      if (spriteName) {\n        const cachedSprite = getSpriteByName(spriteName, spriteScale);\n        if (cachedSprite) {\n          SvgRender.svgSprite(\n            ctx,\n            cachedSprite,\n            viewportWidth,\n            roadWidth,\n            spriteScale,\n            spriteX,\n            spriteY,\n            sprite.offset < 0 ? -1 : 0,\n            -1,\n            segment.clip ?? 0,\n            sprite.source.w,\n            sprite.source.h,\n          );\n        }\n      }\n    }\n\n    // Render current player car if on this segment\n    if (segment === playerSegment) {\n      const playerScale = cameraDepth / playerZ;\n      const playerScreenY =\n        viewportHeight / 2 -\n        (playerScale *\n          Util.interpolate(\n            playerSegment.p1.camera.y,\n            playerSegment.p2.camera.y,\n            playerPercent,\n          ) *\n          viewportHeight) /\n          2;\n      const speedPercent = player.speed / config.maxSpeed;\n      const bounce =\n        1.5 *\n        Math.random() *\n        speedPercent *\n        resolution *\n        (Math.random() > 0.5 ? 1 : -1);\n      const input = world.inputs[playerIndex] ?? world.input;\n      const steer = player.speed * (input.left ? -1 : input.right ? 1 : 0);\n\n      const playerSprite = getPlayerCarSprite(steer);\n\n      if (playerSprite) {\n        SvgRender.svgPlayer(\n          ctx,\n          playerSprite,\n          viewportWidth,\n          viewportHeight,\n          roadWidth,\n          speedPercent,\n          playerScale,\n          viewportWidth / 2,\n          playerScreenY,\n          steer,\n          bounce,\n        );\n      }\n    }\n\n    // Render other players' cars if they are on this segment\n    if (playerCount > 1) {\n      for (let otherIndex = 0; otherIndex < playerCount; otherIndex++) {\n        if (otherIndex === playerIndex) continue;\n\n        const otherPlayer = world.players[otherIndex];\n        const otherInput = world.inputs[otherIndex];\n        if (!otherPlayer || !otherInput) continue;\n\n        // Calculate which segment the other player is on\n        const otherPlayerZ = otherPlayer.position + playerZ;\n        const otherPlayerSegmentIndex =\n          Math.floor(otherPlayerZ / segmentLength) % world.segments.length;\n\n        if (segment.index === otherPlayerSegmentIndex) {\n          const otherPlayerPercent = Util.percentRemaining(\n            otherPlayerZ,\n            segmentLength,\n          );\n\n          // Use the segment's scale which accounts for distance from camera\n          const otherPlayerScale = Util.interpolate(\n            segment.p1.screen.scale,\n            segment.p2.screen.scale,\n            otherPlayerPercent,\n          );\n\n          // Calculate Y position based on the segment's projected coordinates\n          const otherPlayerScreenY =\n            viewportHeight / 2 -\n            (otherPlayerScale *\n              Util.interpolate(\n                segment.p1.camera.y,\n                segment.p2.camera.y,\n                otherPlayerPercent,\n              ) *\n              viewportHeight) /\n              2;\n\n          const otherSpeedPercent = otherPlayer.speed / config.maxSpeed;\n          const otherBounce =\n            1.5 *\n            Math.random() *\n            otherSpeedPercent *\n            resolution *\n            (Math.random() > 0.5 ? 1 : -1);\n          const otherSteer =\n            otherPlayer.speed *\n            (otherInput.left ? -1 : otherInput.right ? 1 : 0);\n\n          const otherPlayerSprite = getPlayerCarSprite(otherSteer);\n\n          if (otherPlayerSprite) {\n            // Calculate lateral position based on the difference in x positions\n            // Scale by viewport width and road width to get screen coordinates\n            const xOffset =\n              (otherPlayer.x - player.x) *\n              roadWidth *\n              viewportWidth *\n              otherPlayerScale *\n              0.5;\n            SvgRender.svgPlayer(\n              ctx,\n              otherPlayerSprite,\n              viewportWidth,\n              viewportHeight,\n              roadWidth,\n              otherSpeedPercent,\n              otherPlayerScale,\n              viewportWidth / 2 + xOffset,\n              otherPlayerScreenY,\n              otherSteer,\n              otherBounce,\n            );\n          }\n        }\n      }\n    }\n  }\n\n  // Render HUD for this player\n  const speed = (player.speed / config.maxSpeed) * 300;\n  const mirrorRange = world.trackLength * 0.08;\n  const mirrorCars = getMirrorCars(\n    world.cars,\n    player.position,\n    world.trackLength,\n    mirrorRange,\n    3,\n  );\n\n  let playerPosition = 1;\n\n  // Count traffic cars ahead\n  for (const car of world.cars) {\n    if (car.z > player.position) {\n      playerPosition++;\n    }\n  }\n\n  // Count other human players ahead\n  for (let i = 0; i < playerCount; i++) {\n    if (i === playerIndex) continue;\n    const otherPlayer = world.players[i];\n    if (otherPlayer && otherPlayer.position > player.position) {\n      playerPosition++;\n    }\n  }\n\n  // Calculate total positions (traffic cars + all human players)\n  const totalPositions = TRAFFIC_CAR_COUNT + playerCount;\n\n  renderSplitScreenHud(\n    ctx,\n    gameState,\n    speed,\n    {\n      width: viewportWidth,\n      height: viewportHeight,\n      x: 0,\n      y: 0,\n      playerIndex,\n    },\n    {\n      speed,\n      maxSpeed: 300,\n      position: Math.min(playerPosition, totalPositions),\n      totalPositions,\n      mirrorCars: mirrorCars.slice(0, 3),\n      boostMeter: Math.min(1, gameState.currentTime / DEFAULT_TIME_LIMIT),\n    },\n  );\n\n  ctx.restore();\n};\n\nconst render = () => {\n  const { width, height } = world.config;\n\n  if (gameState.screen === \"racing\") {\n    if (playerCount === 1) {\n      renderRacing();\n    } else {\n      renderSplitScreen();\n    }\n  } else {\n    const screen = screens.get(gameState.screen);\n    if (screen) {\n      ctx.fillStyle = \"#1a1a2e\";\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n      screen.render(ctx, gameState);\n    }\n  }\n};\n\nconst updateGame = (dt: number) => {\n  if (gameState.screen !== \"racing\" || gameState.isPaused || countdown > 0) {\n    return;\n  }\n\n  gameState = updateTimer(gameState, dt);\n\n  if (playerCount === 1) {\n    const prevLap = world.currentLapTime;\n    update(world, dt);\n    const speedPercent = world.player.speed / world.config.maxSpeed;\n    updateWind(world, dt, speedPercent);\n    updateJump(world, dt);\n    updateParticles(world, dt);\n    updateTumbleweeds(world, dt);\n    updateLightning(world, dt);\n    updateSlidePhysics(world, dt);\n    updateEngineSound(speedPercent);\n\n    const checkpointResult = checkCheckpoint(\n      gameState,\n      world.player.position,\n      world.trackLength,\n      world.config.segmentLength,\n    );\n    if (checkpointResult.bonusAwarded > 0) {\n      gameState = checkpointResult.state;\n    }\n\n    if (\n      prevLap > 0 &&\n      world.currentLapTime === 0 &&\n      world.lastLapTime !== null\n    ) {\n      gameState = completeLap(gameState, world);\n    }\n  } else {\n    // Multiplayer mode - update each player\n    for (let i = 0; i < playerCount; i++) {\n      const player = world.players[i];\n      const input = world.inputs[i];\n      if (!player || !input) continue;\n\n      // Temporarily set the main player/input for the update function\n      world.player = player;\n      world.input = input;\n\n      const prevLap = world.currentLapTime;\n      update(world, dt);\n\n      const speedPercent = player.speed / world.config.maxSpeed;\n      updateWind(world, dt, speedPercent);\n      updateJump(world, dt);\n      updateParticles(world, dt);\n      updateTumbleweeds(world, dt);\n      updateLightning(world, dt);\n      updateSlidePhysics(world, dt);\n\n      // Update engine sound for player 1 only\n      if (i === 0) {\n        updateEngineSound(speedPercent);\n      }\n\n      // Check lap completion for each player\n      if (\n        prevLap > 0 &&\n        world.currentLapTime === 0 &&\n        world.lastLapTime !== null\n      ) {\n        multiRaceState = checkLapComplete(multiRaceState, i, world);\n      }\n    }\n\n    // Handle player-player collisions\n    resolveAllPlayerCollisions(\n      world.players,\n      world.config.segmentLength,\n      playCollisionSound,\n    );\n\n    // Restore first player as default\n    world.player = world.players[0]!;\n    world.input = world.inputs[0]!;\n\n    // Update race countdown\n    multiRaceState = updateRaceCountdown(multiRaceState, dt);\n  }\n};\n\nconst frame = () => {\n  const now = Util.timestamp();\n  const dt = Math.min(1, (now - last) / 1000);\n  gdt += dt;\n\n  if (countdown > 0) {\n    countdownTimer += dt;\n    if (countdownTimer >= 1) {\n      countdown--;\n      countdownTimer = 0;\n    }\n  }\n\n  while (gdt > step) {\n    gdt -= step;\n    updateGame(step);\n  }\n\n  render();\n  last = now;\n  requestAnimationFrame(frame);\n};\n\nconst goToMusicSelection = async () => {\n  gameState = { ...gameState, screen: \"music-select\" };\n  const musicScreen = screens.get(\"music-select\") as\n    | MusicSelectionScreen\n    | undefined;\n  const selectedTrack = musicScreen?.getSelectedTrack();\n  if (selectedTrack && selectedTrack.file) {\n    await loadAndPlayTrack(selectedTrack.file);\n    setMusicVolume(0.3);\n  } else {\n    stopGameMusic();\n  }\n};\n\nconst startGame = async (themeId?: string) => {\n  world = createWorld(playerCount);\n  world.onCollision = playCollisionSound;\n\n  const musicScreen = screens.get(\"music-select\") as\n    | MusicSelectionScreen\n    | undefined;\n\n  selectedThemeId = themeId ?? \"night\";\n\n  const theme = getSelectedTheme();\n  setTheme(world, theme);\n  canvas.style.filter = theme.filters.global;\n  resetCars(world, TRAFFIC_CAR_COUNT);\n\n  // Position players for multiplayer\n  if (playerCount > 1) {\n    // Position players side by side\n    if (world.players[0]) world.players[0].x = -0.5;\n    if (world.players[1]) world.players[1].x = 0.5;\n\n    // Initialize input manager\n    inputManager = new InputManager(playerCount);\n    multiRaceState = startMultiplayerRace(multiRaceState, playerCount);\n  }\n\n  gameState = startRace(gameState);\n  countdown = 3;\n  countdownTimer = 0;\n  hudState = createDefaultHudState();\n\n  const selectedTrack = musicScreen?.getSelectedTrack();\n  if (selectedTrack && selectedTrack.file) {\n    stopGameMusic();\n    await loadAndPlayTrack(selectedTrack.file);\n    setMusicVolume(0.3);\n  } else {\n    stopGameMusic();\n  }\n\n  // Start engine sound\n  startEngineSound();\n};\n\nconst goToRECS = () => {\n  gameState = { ...gameState, screen: \"recs\" };\n};\n\nconst handleMenuKeyDown = async (keyCode: number) => {\n  const screen = screens.get(gameState.screen) as UIScreen | undefined;\n\n  if (gameState.screen === \"main-menu\") {\n    const mainMenuScreen = screen as MainMenuScreen | undefined;\n\n    // Get current player count before handling the action\n    if (mainMenuScreen) {\n      playerCount = mainMenuScreen.getPlayerCount();\n    }\n\n    const action = screen?.handleKeyDown?.(keyCode);\n\n    // Check if player count was toggled (action will be null if toggle happened)\n    if (mainMenuScreen) {\n      playerCount = mainMenuScreen.getPlayerCount();\n      // Sync game mode from main menu to game state\n      const menuGameMode = mainMenuScreen.getGameMode();\n      if (gameState.gameMode !== menuGameMode) {\n        gameState = toggleGameMode(gameState);\n      }\n    }\n\n    if (action === \"start\") {\n      await goToMusicSelection();\n    } else if (action === \"constructor\") {\n      goToRECS();\n    } else if (action === \"sound\") {\n      const isEnabled = toggleSound();\n      console.log(`Sound ${isEnabled ? \"enabled\" : \"disabled\"}`);\n    }\n  } else if (gameState.screen === \"recs\") {\n    const recsScreen = screen as RECSScreen | undefined;\n    const action = screen?.handleKeyDown?.(keyCode);\n\n    if (action === \"start_game\") {\n      const themeId = recsScreen?.getSelectedThemeId() ?? \"night\";\n      await startGame(themeId);\n    } else if (action === \"back\") {\n      gameState = { ...gameState, screen: \"main-menu\" };\n    }\n  } else if (gameState.screen === \"music-select\") {\n    const musicScreen = screen as MusicSelectionScreen | undefined;\n    const prevTrack = musicScreen?.getSelectedTrack();\n    const action = screen?.handleKeyDown?.(keyCode);\n    const newTrack = musicScreen?.getSelectedTrack();\n\n    if (action === \"start_game\") {\n      startGame();\n    } else if (prevTrack?.id !== newTrack?.id && newTrack) {\n      if (newTrack.file) {\n        await loadAndPlayTrack(newTrack.file);\n        setMusicVolume(0.3);\n      } else {\n        stopGameMusic();\n      }\n    }\n  } else if (gameState.screen === \"results\") {\n    if (keyCode === KEY.SPACE) {\n      gameState = returnToMenu(gameState);\n      stopEngineSound();\n      const titleTrack = MUSIC_TRACKS[0];\n      if (titleTrack && titleTrack.file) {\n        await loadAndPlayTrack(titleTrack.file);\n        setMusicVolume(0.3);\n      }\n    }\n  } else if (gameState.screen === \"racing\") {\n    if (keyCode === KEY.P || keyCode === 27) {\n      if (gameState.isPaused) {\n        gameState = resumeGame(gameState);\n      } else {\n        gameState = pauseGame(gameState);\n      }\n    }\n    if (keyCode === KEY.F || keyCode === 122) {\n      toggleFullscreen();\n    }\n  }\n};\n\ndocument.addEventListener(\"keydown\", (ev) => {\n  if (ev.keyCode === 122) {\n    ev.preventDefault();\n  }\n\n  if (gameState.screen === \"racing\" && !gameState.isPaused && countdown === 0) {\n    if (playerCount === 1) {\n      handleKeyDown(world, ev.keyCode);\n    } else {\n      inputManager.handleKeyDown(world.inputs, ev.keyCode);\n    }\n  }\n  handleMenuKeyDown(ev.keyCode);\n});\n\ndocument.addEventListener(\"keyup\", (ev) => {\n  if (gameState.screen === \"racing\") {\n    if (playerCount === 1) {\n      handleKeyUp(world, ev.keyCode);\n    } else {\n      inputManager.handleKeyUp(world.inputs, ev.keyCode);\n    }\n  }\n});\n\ncanvas.addEventListener(\"click\", async (ev) => {\n  const rect = canvas.getBoundingClientRect();\n  const x = (ev.clientX - rect.left) * (world.config.width / rect.width);\n  const y = (ev.clientY - rect.top) * (world.config.height / rect.height);\n\n  const screen = screens.get(gameState.screen) as UIScreen | undefined;\n\n  if (gameState.screen === \"main-menu\") {\n    const mainMenuScreen = screen as MainMenuScreen | undefined;\n\n    // Get current player count before handling the action\n    if (mainMenuScreen) {\n      playerCount = mainMenuScreen.getPlayerCount();\n    }\n\n    const action = screen?.handleClick?.(x, y);\n\n    // Check if player count was toggled (action will be null if toggle happened)\n    if (mainMenuScreen) {\n      playerCount = mainMenuScreen.getPlayerCount();\n      // Sync game mode from main menu to game state\n      const menuGameMode = mainMenuScreen.getGameMode();\n      if (gameState.gameMode !== menuGameMode) {\n        gameState = toggleGameMode(gameState);\n      }\n    }\n\n    if (action === \"start\") {\n      await goToMusicSelection();\n    } else if (action === \"constructor\") {\n      goToRECS();\n    } else if (action === \"sound\") {\n      const isEnabled = toggleSound();\n      console.log(`Sound ${isEnabled ? \"enabled\" : \"disabled\"}`);\n    }\n  } else if (gameState.screen === \"music-select\") {\n    const action = screen?.handleClick?.(x, y);\n    if (action === \"start_game\") {\n      await startGame();\n    }\n  } else if (gameState.screen === \"recs\") {\n    const recsScreen = screen as RECSScreen | undefined;\n    const action = screen?.handleClick?.(x, y);\n    if (action === \"start_game\") {\n      const themeId = recsScreen?.getSelectedThemeId() ?? \"night\";\n      await startGame(themeId);\n    } else if (action === \"back\") {\n      gameState = { ...gameState, screen: \"main-menu\" };\n    }\n  }\n});\n\ncanvas.addEventListener(\"mousemove\", (ev) => {\n  const rect = canvas.getBoundingClientRect();\n  const x = (ev.clientX - rect.left) * (world.config.width / rect.width);\n  const y = (ev.clientY - rect.top) * (world.config.height / rect.height);\n\n  const screen = screens.get(gameState.screen) as UIScreen | undefined;\n  screen?.handleMouseMove?.(x, y);\n\n  if (\n    gameState.screen === \"main-menu\" ||\n    gameState.screen === \"music-select\" ||\n    gameState.screen === \"recs\"\n  ) {\n    const zones = screen?.getZones?.() ?? [];\n    for (const zone of zones) {\n      if (\n        x >= zone.x &&\n        x <= zone.x + zone.width &&\n        y >= zone.y &&\n        y <= zone.y + zone.height\n      ) {\n        canvas.style.cursor = \"pointer\";\n        return;\n      }\n    }\n  }\n  canvas.style.cursor = \"default\";\n});\n\nsetCanvasSize();\n\nwindow.addEventListener(\"resize\", () => {\n  if (!isFullscreen) {\n    setCanvasSize();\n  }\n});\n\nconst init = async () => {\n  try {\n    await loadSvgSprites();\n    console.log(\"SVG sprites loaded successfully\");\n  } catch (err) {\n    console.error(\"Failed to load SVG sprites:\", err);\n  }\n\n  setMusicVolume(0.3);\n  frame();\n};\n\nlet menuMusicStarted = false;\n\nconst startMenuMusic = async () => {\n  if (menuMusicStarted) return;\n  menuMusicStarted = true;\n\n  const titleTrack = MUSIC_TRACKS[0];\n  if (titleTrack) {\n    await loadAndPlayTrack(titleTrack.file);\n    setMusicVolume(0.3);\n  }\n};\n\ndocument.addEventListener(\"click\", startMenuMusic, { once: true });\ndocument.addEventListener(\"keydown\", startMenuMusic, { once: true });\n\ninit();\n"],"names":["KEY","COLORS","SPRITES","SPRITE_SCALE","SPRITE_GROUPS","ROAD","THEMES","timestamp","toInt","obj","def","x","limit","value","min","max","randomInt","interpolate","randomChoice","options","percentRemaining","n","total","accelerate","v","accel","dt","a","b","percent","easeIn","easeInOut","exponentialFog","distance","density","increase","start","increment","result","project","p","cameraX","cameraY","cameraZ","cameraDepth","width","height","roadWidth","overlap","x1","w1","x2","w2","half","min1","max1","min2","max2","segments","getSegments","findSegment","z","segmentLength","index","getLastY","addSegment","curve","y","rumbleLength","addSprite","sprite","offset","addRoad","enter","hold","leave","startY","endY","Util.toInt","Util.easeIn","Util.easeInOut","addStraight","num","addHill","addCurve","c","h","addLowRollingHills","addSCurves","addBumps","addDownhillToEnd","resetSprites","Util.randomInt","Util.randomChoice","side","i","CHECKPOINTS_PER_LAP","resetRoad","playerZ","playerSegment","totalSegments","segmentsPerCheckpoint","checkpointIndex","getPlayerZ","cameraHeight","createDefaultConfig","createDefaultPlayer","applyThemePhysics","baseConfig","physics","setTheme","world","theme","createDefaultWindState","createDefaultJumpState","updateWind","speedPercent","wind","config","updateJump","jump","progress","spawnWaterSplash","updateParticles","windX","updateTumbleweeds","weed","w","direction","updateLightning","updateSlidePhysics","input","player","Util.limit","createDefaultInput","createWorld","playerCount","Camera.getPlayerZ","trackLength","Segments.resetRoad","Segments.getSegments","players","inputs","resetCars","totalCars","maxSpeed","speed","car","Segments.findSegment","updateCarOffset","carSegment","playerX","playerW","drawDistance","carW","segmentIndex","segment","Util.overlap","otherCar","otherCarW","updateCars","oldSegment","Util.increase","Util.percentRemaining","newSegment","update","braking","decel","offRoadDecel","offRoadLimit","centrifugal","lanes","dx","startPosition","Util.accelerate","spriteW","spriteOffset","positionDelta","handleKeyDown","keyCode","handleKeyUp","getMirrorCars","cars","playerPosition","mirrorRange","maxCars","carColors","mirrorCars","distanceBehind","colorIndex","normalizedDistance","polygon","ctx","y1","y2","x3","y3","x4","y4","color","rumbleWidth","projectedRoadWidth","laneMarkerWidth","fog","r1","r2","l1","l2","lanew1","lanew2","lanex1","lanex2","lane","fogLayer","fogColor","lightningFlash","intensity","renderParticles","particles","cachedSprites","cached","renderTumbleweed","tumbleweed","cachedSprite","size","drawSplitScreenDivider","svgSprite","canvasWidth","scale","destX","destY","offsetX","offsetY","clipY","spriteH","destW","destH","finalX","finalY","clipH","srcH","svgPlayer","_canvasHeight","_speedPercent","_steer","bounce","svgBackground","canvasHeight","rotation","yOffset","sourceX","sourceW","remainingW","remainingDestW","SPRITE_SVG_MAP","DEFAULT_CONFIG","SpriteCacheImpl","path","response","svgText","resolve","reject","img","svgBlob","url","canvas","svgPath","scales","fullPath","scaleMap","exactMatch","closestScale","closestDiff","cachedScale","diff","createSpriteCache","globalSpriteCache","getSpriteByName","name","preloadGameSprites","baseScales","largeScales","particleScales","sprites","s","ModPlayerImpl","arrayBuffer","volume","globalModPlayer","loadAndPlayTrack","file","stopGameMusic","setMusicVolume","soundEnabled","engineAudioContext","engineOscillator","engineGainNode","noiseBuffer","noiseNode","noiseGainNode","isSoundEnabled","toggleSound","stopEngineSound","createEngineAudioContext","createEngineNoiseBuffer","bufferSize","buffer","data","startEngineSound","noiseFilter","err","updateEngineSound","baseFreq","noiseVol","playCollisionSound","decay","source","filter","gain","DEFAULT_TIME_LIMIT","DEFAULT_LAPS","CHECKPOINT_TIME_BONUS","LAP_TIME_BONUS","CHECKPOINT_SCORE_BONUS","LAP_SCORE_BONUS","BASE_TIME_PER_SEGMENT","MIN_TIME_LIMIT","calculateTimeLimit","calculatedTime","createTimeChallengeState","timeLimit","updateTimer","state","newFlash","newTime","checkCheckpoint","currentSegment","currentCheckpointIndex","bonus","completeLap","newLap","isNewBest","finalScore","startRace","pauseGame","resumeGame","returnToMenu","formatTimeDisplay","seconds","mins","secs","tenths","formatScore","score","toggleGameMode","RACE_START_COUNTDOWN","createPlayerRaceState","playerId","createRaceState","_","createMultiplayerRaceState","updateRaceCountdown","raceState","checkLapComplete","playerIndex","playerState","prevPosition","finishedPlayers","DEFAULT_P1_INPUT","DEFAULT_P2_INPUT","InputManager","PLAYER_CAR_WIDTH","PLAYER_COLLISION_Z_DISTANCE","checkPlayerCollision","p1","p2","dz","resolvePlayerCollision","pushFactor","nx","checkAllPlayerCollisions","collisions","j","resolveAllPlayerCollisions","onCollision","collision","drawPanel","drawText","text","font","align","baseline","drawCenteredText","centerX","drawSelectionBox","zone","MAIN_MENU_ZONES","NAVIGABLE_ZONES","MainMenuScreen","scaleX","scaleY","menuSvg","selectedZone","playersZone","gameZone","modeText","soundZone","centerY","idx","currentZone","UP","DOWN","LEFT","RIGHT","SPACE","candidates","firstCandidate","newIdx","MUSIC_TRACKS","MusicSelectionScreen","musicSvg","currentTrack","displayY","_x","_y","THEME_LIST","RECS_SLIDERS","RECS_TOP_BUTTONS","RECSScreen","id","key","_state","recsSvg","slider","trackX","trackY","trackW","fillW","scenarioY","slotWidth","slotHeight","gap","startX","themeIndex","t","iconSvg","btn","btnX","btnY","btnW","btnH","sliderX","sliderY","sliderW","sliderH","relativeX","newValue","iconX","zones","ResultsScreen","titleText","createScreens","screens","DEFAULT_HUD_STATE","getPositionSuffix","pos","drawBlockyText","renderRearViewMirror","roadCenterX","roadTop","roadBottom","sortedCars","perspectiveScale","carX","carY","carH","renderSpeedPanel","speedKmh","barX","barY","barWidth","barHeight","fillColor","fillWidth","lineX","renderPositionPanel","position","totalPositions","posText","posColor","renderTimerPanel","isRaceMode","timerColor","renderScorePanel","renderLapPanel","lap","totalLaps","renderBoostPanel","boostMeter","renderHud","hudState","hs","padding","mirrorWidth","mirrorHeight","mirrorX","mirrorY","leftColumnX","rightColumnX","row1Y","row2Y","row3Y","renderPauseOverlay","renderCountdown","count","renderSplitScreenHud","viewportX","viewportY","speedPanelWidth","speedPanelHeight","renderCompactSpeedPanel","renderCompactPositionPanel","renderCompactTimerPanel","renderCompactLapPanel","panelWidth","panelHeight","fontSize","labelFontSize","createDefaultHudState","BASE_WIDTH","BASE_HEIGHT","step","svgPlayerCarStraight","svgPlayerCarLeft","svgPlayerCarRight","last","Util.timestamp","gdt","gameState","inputManager","multiRaceState","resolution","countdown","countdownTimer","isFullscreen","TRAFFIC_CAR_COUNT","selectedThemeId","getSelectedTheme","setCanvasSize","viewportWidth","viewportHeight","toggleFullscreen","screenWidth","screenHeight","loadSvgSprites","SPRITE_NAME_MAP","getSpriteName","overrides","getPlayerCarSprite","steer","adjustColor","hex","amount","r","g","renderRacing","skyOffset","currentTheme","fogDensity","skyColor","baseSegment","basePercent","playerPercent","playerY","Util.interpolate","maxy","SvgRender.svgBackground","themeColors","Util.exponentialFog","Util.project","segmentColor","Render.segment","Render.fogLayer","spriteScale","spriteX","spriteY","spriteName","SvgRender.svgSprite","playerScale","playerScreenY","playerSprite","SvgRender.svgPlayer","Render.renderParticles","relZ","distanceScale","screenY","screenX","cachedWeed","Render.renderTumbleweed","Render.lightningFlash","renderSplitScreen","Render.drawSplitScreenDivider","originalPlayer","renderRacingForViewport","otherIndex","otherPlayer","otherInput","otherPlayerZ","otherPlayerSegmentIndex","otherPlayerPercent","otherPlayerScale","otherPlayerScreenY","otherSpeedPercent","otherBounce","otherSteer","otherPlayerSprite","xOffset","render","screen","updateGame","prevLap","checkpointResult","frame","now","goToMusicSelection","selectedTrack","startGame","themeId","musicScreen","startMultiplayerRace","goToRECS","handleMenuKeyDown","mainMenuScreen","action","menuGameMode","isEnabled","recsScreen","prevTrack","newTrack","titleTrack","ev","rect","init","menuMusicStarted","startMenuMusic"],"mappings":"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"}